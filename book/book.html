<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="陳鍾誠" />
  <title>C# 程式設計</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../css/book.css" type="text/css" />
</head>
<body>
<div id="header_wrap">
  <h1><a href="course.html">電子書：C# 程式設計</a></h1>
  <table id="bar" border="0" style="border:0;"><tr style="border:0;">
    <td style="text-align:left;border:0;"><a href="book.html">目錄</a> | <a href="download.html">下載</a> | <a href="course.html">課程</a> | <a href="forum.html">討論</a> | <a href="exam.html">測驗</a></td>
    <td style="text-align:right;border:0;"><a href="http://ccckmit.wikidot.com/">陳鍾誠</a> 於 <a href="http://www.nqu.edu.tw/">金門大學</a></td>
  </tr></table>
</div>
<div id="content">
<div id="header">
<h1 class="title">C# 程式設計</h1>
<h2 class="author">陳鍾誠</h2>
<h3 class="date">2013 年 8 月</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#c-程式基礎簡介與開發環境">C# 程式基礎：簡介與開發環境</a><ul>
<li><a href="#visual-studio-安裝">Visual Studio 安裝</a></li>
<li><a href="#命令列工具">命令列工具</a></li>
<li><a href="#視窗程式設計">視窗程式設計</a></li>
<li><a href="#資料庫">資料庫</a></li>
<li><a href="#網路">網路</a></li>
<li><a href="#網頁">網頁</a></li>
<li><a href="#手機">手機</a></li>
<li><a href="#遊戲">遊戲</a></li>
<li><a href="#跨平台的考量">跨平台的考量</a></li>
<li><a href="#最新的發展">最新的發展</a></li>
<li><a href="#結語">結語</a></li>
<li><a href="#參考文獻">參考文獻</a></li>
</ul></li>
<li><a href="#c-程式基礎變數與運算式">C# 程式基礎：變數與運算式</a><ul>
<li><a href="#簡介">簡介</a></li>
<li><a href="#變數與型態">變數與型態</a></li>
<li><a href="#測驗">測驗</a></li>
<li><a href="#結語-1">結語</a></li>
<li><a href="#參考文獻-1">參考文獻</a></li>
</ul></li>
<li><a href="#c-程式基礎流程控制">C# 程式基礎：流程控制</a><ul>
<li><a href="#if-語法">if 語法</a></li>
<li><a href="#for-語法">for 語法</a></li>
<li><a href="#while-語法">while 語法</a></li>
<li><a href="#結語-2">結語</a></li>
<li><a href="#練習if-範例">練習：if 範例</a></li>
<li><a href="#練習while-範例">練習：while 範例</a></li>
</ul></li>
<li><a href="#c-程式基礎陣列">C# 程式基礎：陣列</a><ul>
<li><a href="#一維陣列">一維陣列</a></li>
<li><a href="#二維陣列">二維陣列</a></li>
<li><a href="#參考文獻-2">參考文獻</a></li>
</ul></li>
<li><a href="#c-程式基礎函數">C# 程式基礎：函數</a><ul>
<li><a href="#簡介-1">簡介</a></li>
<li><a href="#函數的參數">函數的參數</a></li>
<li><a href="#練習">練習</a></li>
</ul></li>
<li><a href="#c-程式基礎物件">C# 程式基礎：物件</a><ul>
<li><a href="#封裝">封裝</a></li>
<li><a href="#繼承">繼承</a></li>
<li><a href="#多型">多型</a></li>
<li><a href="#參考文獻-3">參考文獻</a></li>
</ul></li>
<li><a href="#c-程式基礎例外處理">C# 程式基礎：例外處理</a><ul>
<li><a href="#範例引發例外">範例：引發例外</a></li>
<li><a href="#範例捕捉例外">範例：捕捉例外</a></li>
<li><a href="#視窗版的例外處理">視窗版的例外處理</a></li>
</ul></li>
<li><a href="#c-程式基礎資料結構">C# 程式基礎：資料結構</a><ul>
<li><a href="#容器函式庫">容器函式庫</a></li>
<li><a href="#容器的使用">容器的使用</a></li>
</ul></li>
<li><a href="#c-程式基礎檔案處理">C# 程式基礎：檔案處理</a><ul>
<li><a href="#讀取檔案">讀取檔案</a></li>
<li><a href="#寫入檔案">寫入檔案</a></li>
<li><a href="#物件導向的寫法">物件導向的寫法</a></li>
<li><a href="#更物件導向的寫法">更物件導向的寫法</a></li>
</ul></li>
<li><a href="#c-程式進階正規表達式">C# 程式進階：正規表達式</a><ul>
<li><a href="#程式範例">程式範例</a></li>
</ul></li>
<li><a href="#c-程式進階作業系統與-thread">C# 程式進階：作業系統與 Thread</a><ul>
<li><a href="#process-與-thread">Process 與 Thread</a></li>
<li><a href="#c-中的-thread-概念">C# 中的 Thread 概念</a></li>
<li><a href="#以-c-體驗死結-deadlock">以 C# 體驗死結 (Deadlock)</a></li>
<li><a href="#競爭情況-race-condition">競爭情況 (Race Condition)</a></li>
<li><a href="#號誌-semaphore-與生產者消費者問題">號誌 (Semaphore) 與生產者/消費者問題</a></li>
<li><a href="#參考文獻-4">參考文獻</a></li>
</ul></li>
<li><a href="#c-視窗程式簡介">C# 視窗程式：簡介</a><ul>
<li><a href="#視窗與-c-程式">視窗與 C# 程式</a></li>
<li><a href="#按鈕測試">按鈕測試</a></li>
<li><a href="#文字型計算機">文字型計算機</a></li>
<li><a href="#小字典">小字典</a></li>
</ul></li>
<li><a href="#c-視窗程式時間驅動">C# 視窗程式：時間驅動</a><ul>
<li><a href="#碼表">碼表</a></li>
<li><a href="#小時鐘">小時鐘</a></li>
<li><a href="#用-timer-控制動畫">用 Timer 控制動畫</a></li>
</ul></li>
<li><a href="#c-視窗程式設計文字編輯器">C# 視窗程式：設計文字編輯器</a></li>
<li><a href="#c-視窗程式datagridview-與-listview-元件">C# 視窗程式：DataGridView 與 ListView 元件</a><ul>
<li><a href="#datagridview-的使用">DataGridView 的使用</a></li>
<li><a href="#賣泡沫紅茶的系統-point-of-sale-pos">賣泡沫紅茶的系統 (Point of Sale, POS)</a></li>
<li><a href="#參考文獻-5">參考文獻</a></li>
</ul></li>
<li><a href="#c-視窗程式繪圖功能">C# 視窗程式：繪圖功能</a><ul>
<li><a href="#畫圖功能示範">畫圖功能示範</a></li>
<li><a href="#小畫板">小畫板</a></li>
</ul></li>
<li><a href="#c-網路程式簡介ip-與-url">C# 網路程式：簡介、IP 與 URL</a><ul>
<li><a href="#簡介-2">簡介</a></li>
<li><a href="#ip-層的程式設計">IP 層的程式設計</a></li>
<li><a href="#url-dns-與網址剖析">URL 、DNS 與網址剖析</a></li>
<li><a href="#結語-3">結語</a></li>
</ul></li>
<li><a href="#c-網路程式udp-程式設計">C# 網路程式：UDP 程式設計</a><ul>
<li><a href="#udp-簡介">UDP 簡介</a></li>
<li><a href="#單向-udp-訊息傳遞程式">單向 UDP 訊息傳遞程式</a></li>
<li><a href="#參考文獻-6">參考文獻</a></li>
</ul></li>
<li><a href="#c-網路程式tcp-程式設計">C# 網路程式：TCP 程式設計</a><ul>
<li><a href="#tcp-簡介">TCP 簡介</a></li>
<li><a href="#tcp-的程式架構">TCP 的程式架構</a></li>
<li><a href="#tcp-單向的訊息傳遞程式">TCP 單向的訊息傳遞程式</a></li>
<li><a href="#tcp-雙向聊天程式">TCP 雙向聊天程式</a></li>
<li><a href="#tcp-多人聊天室-視窗版">TCP 多人聊天室 (視窗版)</a></li>
</ul></li>
<li><a href="#c-網路程式http-程式設計-1----server">C# 網路程式：HTTP 程式設計 (1) -- Server</a><ul>
<li><a href="#http-協定簡介">HTTP 協定簡介</a></li>
<li><a href="#helloserver-永遠傳回-hello-的-webserver">HelloServer: 永遠傳回 Hello 的 WebServer</a></li>
<li><a href="#完整的-web-server">完整的 Web Server</a></li>
<li><a href="#參考文獻-7">參考文獻</a></li>
</ul></li>
<li><a href="#c-網路程式http-程式設計-2----client">C# 網路程式：HTTP 程式設計 (2) -- Client</a><ul>
<li><a href="#http-client-端程式簡介">HTTP Client 端程式簡介</a></li>
<li><a href="#單一網頁下載">單一網頁下載</a></li>
<li><a href="#網路爬蟲-webcrawler-的設計">網路爬蟲 WebCrawler 的設計</a></li>
<li><a href="#browser-的控制">Browser 的控制</a></li>
</ul></li>
<li><a href="#c-遊戲程式xna-遊戲引擎">C# 遊戲程式：XNA 遊戲引擎</a><ul>
<li><a href="#xna-遊戲程式架構">XNA 遊戲程式架構</a></li>
<li><a href="#xna-的-2d-打飛碟遊戲">XNA 的 2D 打飛碟遊戲</a></li>
<li><a href="#xna-的-3d-遊戲架構">XNA 的 3D 遊戲架構</a></li>
<li><a href="#xna-的-3d-打飛碟遊戲">XNA 的 3D 打飛碟遊戲</a></li>
<li><a href="#從-xna-到-unity3d">從 XNA 到 Unity3D</a></li>
<li><a href="#參考文獻-8">參考文獻</a></li>
</ul></li>
<li><a href="#c-程式設計結語">C# 程式設計：結語</a></li>
<li><a href="#附錄教學錄影">附錄：教學錄影</a></li>
</ul>
</div>
<h1 id="c-程式基礎簡介與開發環境"><a href="#c-程式基礎簡介與開發環境">C# 程式基礎：簡介與開發環境</a></h1>
<p>C# 是微軟所設計的一種物件導向語言，其設計理念受到 C 與 Java 語言的影響，採用類似 C 語言的語法，並使用類似 Java 語言的虛擬機架構，具備物件導向的能力，是微軟在其主力平台 .NET 上最重要的開發語言。</p>
<h2 id="visual-studio-安裝"><a href="#visual-studio-安裝">Visual Studio 安裝</a></h2>
<p>要使用 C# 開發程式，必須安裝 Visual C# Express 或是 Visual Studio，其中 Visual C# Express 是免費的，您可以下列網址當中下載其安裝程式。</p>
<ul>
<li>Visual C# express 中文版 -- <a href="http://www.microsoft.com/visualstudio/cht/downloads">http://www.microsoft.com/visualstudio/cht/downloads</a></li>
</ul>
<p>Visual C# Express 的安裝相當簡單，筆者在此不加以說明，但若您希望能在安裝前先預習一遍，可以參考下列網頁的安裝過程。</p>
<ul>
<li>佳新的部落格 - 下載並安裝Visual C# 2008 Express中文版 -- <a href="http://jarsing.blogspot.com/2009/01/visual-c-2008-express.html">http://jarsing.blogspot.com/2009/01/visual-c-2008-express.html</a></li>
</ul>
<p>Visual Studio 是一個功能很強大的整合開發環境，包含視覺化設計模式、整合除錯環境、方便的程式編輯環境等等。因此，大部分人都會使用 Visual Studio 作為 C# 的開發工具。</p>
<p>目前 Visual Studio 可分為三個版本，企業版 (Enterprise Edition)、專業版 (Professional Edition) 以及簡潔版 (Express Edition)，其中企業版與專業版是需要付費購買的，而簡潔版則是免費的。通常一般的學習者使用簡潔版就綽綽有餘了，簡潔版的功能其實已經相當強大，除了缺少一些系統分析、團隊合作、以及企業報表等工具之外，其他的部分，像是視覺化設計模式、整合除錯環境、方便的程式編輯環境等，都已經包括在內，因此相當適合學生學習使用。</p>
<ul>
<li>Visual Studio 2012 Express for Windows Desktop -- <a href="http://www.microsoft.com/visualstudio/cht/downloads">http://www.microsoft.com/visualstudio/cht/downloads</a></li>
</ul>
<p>當您下載並安裝完畢後，可以直接從微軟視窗系統中的「開始/所有程式/Microsoft Visual 2010 Express」這個路徑啟動簡潔版的開發環境。在這個環境中，使用編輯程式、除錯或使用視覺化設計模式，這是相當方便的一個工具。</p>
<h2 id="命令列工具"><a href="#命令列工具">命令列工具</a></h2>
<p>微軟的 C# 語言的編譯器是 csc.exe 這個執行檔，這個檔案通常被安裝在 .NET的路徑下。舉例而言，在我的電腦中，就可以在下列路徑中找到這個檔案。</p>
<pre><code>C:\WINDOWS\Microsoft.NET\Framework\v3.5</code></pre>
<p>如果您安裝的是專業版，您可以在「開始/所有程式/Microsoft Visual Studio 2008/Visual Studio Tools/Visual Studio 2008 命令提示字元」這個功能表選項中，啟動 Visual Studio 的命令列工具。如此您可以使用命令列的方式，對程式進行編譯與執行的動作。</p>
<p>舉例而言，您可以使用「csc 檔案名稱」的指令，編譯特定的 C# 程式，像是下列指令就可以將 Hello.cs 編譯為 Hello.exe。</p>
<pre><code>csc Hello.cs</code></pre>
<p>在某些時候，特別是開發網路程式的時候，命令列會比整合開發環境更方便使用，因此您可以自行決定何時應該用哪一種方式進行編譯。</p>
<p>由於微軟是目前軟體界最大的公司，並且極力推廣 C# 與 .NET 平台，這使得 C# 所支援的程式領域特別廣泛，除了命令列程式之外，C# 還常用在視窗、資料庫、網路、網頁、手機、遊戲等領域，其應用的廣泛性是其他語言所難以趕上的。</p>
<p>以下，我們分別就這些領域，逐一進行介紹。</p>
<h2 id="視窗程式設計"><a href="#視窗程式設計">視窗程式設計</a></h2>
<p>C# 可用來撰寫 MS. Windows 作業系統上的視窗程式。微軟目前的視窗開發套件有兩種，比較舊但卻很成熟的一種稱為 Window Forms，比較新但卻較少人用的一種稱為 WPF (Windows Presentation Foundation)。</p>
<p>Window Forms 採用的是物件導向的視覺化設計元件，您可以用拖拉的方式，輕易的設計出視窗介面，然後利用事件驅動的方式，撰寫該事件的處理程式，像是滑鼠被按下，鍵盤被按下等都會觸發視窗系統中的事件。</p>
<p>WPF 的設計雖然也是物件導向式的，但是為了網路化的考量，微軟創造了一個稱為 XAML 的 XML 規格，讓使用者可以撰寫 XAML 語法以創建使用者介面。這種做法與 Google 在 Android 平台上的做法有點類似，但是直到目前為止，這些規格仍然沒有受到瀏覽器的支援，因此用 XAML 設計使用者介面的必要性並不強烈，筆者仍建議採用 Window Forms 撰寫程式。</p>
<h2 id="資料庫"><a href="#資料庫">資料庫</a></h2>
<p>微軟設計的開發工具，通常都會極力支援自家的產品，因此在 C# 當中最容易使用的是MS. SQL 與 Access 資料庫。但是由於這兩個資料庫都是要收費的，因此對於經費有限的個人而言，並不適當。但是如果您有 MS. SQL 或 Access 等軟體，就會感覺到微軟在資料庫上的用心，因為這是微軟主要的獲利來源。</p>
<h2 id="網路"><a href="#網路">網路</a></h2>
<p>微軟的 .NET 平台除了支援傳統的 TCP/IP 網路基礎函式庫 Socket 之外，還設計了許多新的網路物件，像是 HTTP 的 WebRequest 等，這些物件可以讓程式設計者更省力的設計出網路程式。但是以筆者觀點，Socket 函式庫仍然是最重要的，因為使用 Socket 函式庫可以讓你清楚的理解網路程式的運作原理，直接透過 TCP/IP 掌握通訊程式的精隨。</p>
<h2 id="網頁"><a href="#網頁">網頁</a></h2>
<p>微軟的網頁伺服器 IIS (Internet Information Server) 當中，所使用的開發環境稱為 ASP.NET，這是從過去的 ASP (Active Server Pages) 所延伸而來的。在 ASP.NET 當中支援了 C# 與 VB 等兩種開發語言，您可以輕易的使用 Visual Studio 進行 ASP.NET 的程式開發。</p>
<h2 id="手機"><a href="#手機">手機</a></h2>
<p>微軟的手機從 Smart Phone 開始，經過 Windows Mobile、Windows Phone 一直到現在的 Windows 8，一開始帶出了智慧型手機的概念，但是卻受到 iPhone 與 Android 的夾殺，目前仍然無法成為智慧型手機與平版的主流。</p>
<p>不過微軟最強的部份是在桌上型電腦，如果能將手機、平板、遊戲機 XBox、筆電與桌上型電腦的生態系建構好，或許還有機會在市場上與 Apple, Google 等公司一爭長短。</p>
<h2 id="遊戲"><a href="#遊戲">遊戲</a></h2>
<p>微軟在 2007 年推出了 XNA 遊戲開發平台，讓程式設計者可以利用 C# 語言開發遊戲程式，並且可以將這些遊戲放到 PC、XBOX 與 Zune 等裝置上執行，這對想要學習遊戲程式設計的人而言，是一個很好的開發平台。在 XNA 出現之前，遊戲公司都必須購買昂貴的遊戲設計軟體，以便開發遊戲程式。因此遊戲程式成了遊戲公司人員的商業秘密，但是在 XNA 出現之後，個人或者工作室都可以利用 C# 語言，直接開發出遊戲程式，而不需要購買那些昂貴的設計軟體。這對想學習遊戲程式設計的人而言是一個很好的消息，遊戲的開發因 XNA 而變得普及了。</p>
<p>要撰寫 XNA 遊戲程式，您必須安裝 XNA Game Studio 套件於 Visual C# Express 當中，您可以從下列 MSDN 網址中取得該套件。</p>
<ul>
<li><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=80782277-d584-42d2-8024-893fcd9d3e82&amp;displaylang=en">http://www.microsoft.com/downloads/details.aspx?FamilyID=80782277-d584-42d2-8024-893fcd9d3e82&amp;displaylang=en</a></li>
</ul>
<h2 id="跨平台的考量"><a href="#跨平台的考量">跨平台的考量</a></h2>
<p>假如您希望讓 C# 程式在 UNIX/Linux/FreeBSD/MAC OS X 等平台上執行，也可以採用 Novell 公司所主導的 Mono 計畫，該計畫已經發展出一套跨平台的函式庫，讓您可以輕易的將 C# 程式放到非微軟的平台執行，Mono 計畫的網址如下。</p>
<ul>
<li><a href="http://www.mono-project.com/">http://www.mono-project.com/</a></li>
</ul>
<h2 id="最新的發展"><a href="#最新的發展">最新的發展</a></h2>
<p>C# 語言在 3.0 版當中，加入了許多方便的新語法，像是匿名函數、資料查詢語言 Linq 等等，這些新功能讓 C# 語言超越了 Java ，成為簡單又強大的語言，有興趣的讀者可以觀看下列網頁當中的說明，該文章對 C# 3.0 的功能有簡單且扼要的介紹。</p>
<ul>
<li>搖擺天秤的程式開發日誌： <a href="http://richielin-programer.blogspot.com/2008/02/visual-c-30.html">http://richielin-programer.blogspot.com/2008/02/visual-c-30.html</a></li>
</ul>
<h2 id="結語"><a href="#結語">結語</a></h2>
<p>雖然我並不是微軟的擁護者，甚至還有點反微軟的傾向，但是我仍然選擇了用 C# 為主要的開發語言。原因是 C# 的用途相當廣泛，支援的體系很完整，Visual C# Express 也很好用，而且我是個實用主義者。</p>
<p>我需要撰寫 Windows 當中的視窗程式、網路程式與遊戲程式，因此我使用 C# 與 Visual C# Express。</p>
<p>在本文中，我們簡單介紹了 C# 程式語言開發環境 - Visual C# Express 與 Visual Studio 等工具的安裝與使用方式。當然，我們無法完整的介紹這些工具的所有功能，只能將最常用的幾種方式簡要的說明一下，以幫助初學者能順利的進入 C# 程式開發的領域。</p>
<h2 id="參考文獻"><a href="#參考文獻">參考文獻</a></h2>
<ul>
<li>賴榮樞 的軟體資訊誌: Hello C# 編譯執行 console 程式, 2008/01 -- <a href="http://www.goodman-lai.idv.tw/2008/01/hello-c-console_3469.html">http://www.goodman-lai.idv.tw/2008/01/hello-c-console_3469.html</a></li>
</ul>
<h1 id="c-程式基礎變數與運算式"><a href="#c-程式基礎變數與運算式">C# 程式基礎：變數與運算式</a></h1>
<h2 id="簡介"><a href="#簡介">簡介</a></h2>
<p>以下是一個完整的 C# 程式 (Hello.cs)，可以印出 Hello !。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;                           <span class="co">// 引用 System 函式庫</span>

<span class="kw">public</span> <span class="kw">class</span> Hello                      <span class="co">// 宣告類別 Hello</span>
{
   <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()            <span class="co">// 類別 Hello 的主程式</span>
   {
      Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Hello !&quot;</span>);     <span class="co">// 印出 Hello !</span>
   }
}</code></pre>
<p>如果您將上述程式加入到 Visual C# Express 的空專案中，就可以直接執行之。如果您會使用命令列的 csc 編譯器，就可以用下列指令將該程式編譯成執行檔 Hello.exe，然後您就可以在命令列中輸入 Hello 指令執行該程式。</p>
<pre><code>    C:\&gt;csc Hello.cs
    C:\&gt;Hello
    Hello!</code></pre>
<p>對於初學程式設計的人而言，我們還需要很長的一段時間才能完全理解上述程式中每個指令的意義，先讓我們從最基本的變數與型態開始熟悉 C# 語言。</p>
<h2 id="變數與型態"><a href="#變數與型態">變數與型態</a></h2>
<p>變數是程式用來儲存資料的地方，程式透過變數存取資料，並透過指定敘述 (Assign) 搬移資料。舉例而言，假如我們希望設定變數 X 為 3，可以用 X=3 的運算式，若我們希望將 Y 的內容複製給 X ，則可以用 X=Y 這個指定敘述。</p>
<p>C# 是一個強型態的語言，每個變數都必須要指定型態，C# 中常用的基本型態包含字元 (char)、整數 (int)、實數 (float)、字串(string) 、布林 (bool) 等，以下是這些基本型態的一些範例。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> a = <span class="dv">3</span>, b = a;          <span class="co">// 整數</span>
    <span class="dt">double</span> pi = <span class="fl">3.14</span>;          <span class="co">// 浮點數</span>
    <span class="dt">char</span> c = &#39;H&#39;;              <span class="co">// 字元</span>
    <span class="dt">string</span> msg = <span class="st">&quot;Hello!&quot;</span>;     <span class="co">// 字串</span>
    <span class="dt">bool</span> x = <span class="kw">true</span>, y = <span class="kw">false</span>;  <span class="co">// 布林 (邏輯)</span>
    <span class="dt">string</span> str = <span class="st">&quot;a=&quot;</span> + a + <span class="st">&quot; b=&quot;</span> + b;
    Console.<span class="fu">Write</span>(str);</code></pre>
<ul>
<li>運算式 程式語言當中的指定運算式，通常用 = 符號代表，其意義與數學當中的等號不同，請看下列範例。</li>
</ul>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> x = <span class="dv">3</span>, y = <span class="dv">5</span>;
    x = y;</code></pre>
<p>在上述範例中，x, y 分別被設定為 3 與 5，因此若以數學式的看法, x=y 是不成立的，但是在 C# 當中，若我們想判斷 X 與 Y 是否相等，應該用兩個等號的 x==y 表達。與此不同的是，上述範例中的 x=y 是指定的意思，也就是將 y 當中的 5 複製一份給 x，於是 x 的值也就變成 5 了。</p>
<p>C# 語言中的加減乘除等運算，基本上與數學的定義類似，因此，您可以寫出下列的運算式，該運算是依照先乘除後加減的順序，結果會設定 x 的值為 19。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> x = <span class="dv">3</span> * <span class="dv">5</span> + <span class="dv">8</span> / <span class="dv">2</span>;</code></pre>
<p>C# 語言承襲了 C 語言的許多語法，遞增運算 (x++), 移位運算 (x &lt; &lt; 2), 邏輯運算 (&amp;&amp; , | |, !) 等，其語法都與 C 語言一致。</p>
<p>遞增運算 ++ 的意義，是將該變數加上 1，而遞減運算 -- 的意義，則是將該變數減去 1，所以 x++ 代表將變數 x 加上 1，等同於 x=x+1 的結果，而 x-- 代表將變數 x 減去 1，等同於 x = x - 1 的結果。</p>
<p>移位運算 &lt; &lt; 的意義，代表左移，而 &gt; &gt; 則是右移的意思。舉例而言，x &lt; &lt; 2 代表將 x 視為位元串，並且向左移兩位。因此若 x 是一個值為 2 的整數 (int) ，由於其二進位表達式為 00000010。所以當我們執行運算式 x = x&lt; &lt;2 後，x 將會變成 00001000，也就是十進位的 8，請看下列範例。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> x = <span class="dv">2</span>;    <span class="co">// x = 00000010 = 2</span>
    x = x &lt;&lt; <span class="dv">2</span>;   <span class="co">// x = 00001000 = 8</span></code></pre>
<p>邏輯運算 ! 是邏輯反閘 (not) 的意思，此運算會將真假值顛倒，也就是 !true = false, !false = true。</p>
<p>邏輯運算 &amp;&amp; 是邏輯且 (AND) 的意思，只有當 X 與 Y 兩者均為真 (true) 時， X &amp;&amp; Y 才會為真，否則 X&amp;&amp;Y 將會是假 (false) 值。</p>
<p>邏輯運算 | | 是邏輯或 (OR) 的意思，只要 X 與 Y 兩者當中有一個為真 (true) 時， X || Y 就會為真。</p>
<p>下列範例顯示了 C# 當中的邏輯運算式用法。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">bool</span> x = <span class="kw">true</span>, y = <span class="kw">false</span>;
    <span class="dt">bool</span> a = x &amp;&amp; y;   <span class="co">// a = true and false = false</span>
    <span class="dt">bool</span> b = x || y;   <span class="co">// b = true or false = true</span>
    <span class="dt">bool</span> c = !x;       <span class="co">// c = !true = false </span></code></pre>
<p>C# 由於繼承了 C 語言的運算式語法，因此在位元邏輯上也採用 &amp; 代表逐位元的 AND 運算，而 | 代表 逐位元的 OR 運算。舉例而言，下列範例中的 x &amp; y 之結果為 1， x | y 的結果為 7。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> x = <span class="dv">3</span>, y = <span class="dv">5</span>;
    <span class="dt">int</span> a = x &amp; y;      <span class="co">// a=00000011 AND 00000101 = 00000001 = 1</span>
    <span class="dt">int</span> b = x | y;      <span class="co">// b=00000011 OR 00000101 = 00000111 = 7</span></code></pre>
<h2 id="測驗"><a href="#測驗">測驗</a></h2>
<p>請寫出以下程式的輸出：</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="dt">int</span> x = <span class="dv">3</span>, y = <span class="dv">5</span>;
    x = y;
    x = x &lt;&lt; <span class="dv">2</span>;

    <span class="dt">bool</span> t = <span class="kw">true</span>, u = <span class="kw">false</span>;
    <span class="dt">bool</span> a = t &amp;&amp; u;   <span class="co">// a = true and false = false</span>
    <span class="dt">bool</span> b = t || u;   <span class="co">// b = true or false = true</span>
    <span class="dt">bool</span> c = !u;       <span class="co">// c = !false = true</span>

    <span class="dt">int</span> d = x &amp; y;      <span class="co">// d=00010100 AND 00000101 = 00000100 = 4</span>
    <span class="dt">int</span> e = x | y;      <span class="co">// e=00010100 OR  00000101 = 00010101 = 21</span></code></pre>
<h2 id="結語-1"><a href="#結語-1">結語</a></h2>
<p>萬事起頭難，學習程式設計尤其是如此。雖然到目前為止我們只學習了 C# 當中的基本運算與變數宣告，但這兩個主題卻是所有程式語言都必須要具備的。有了這些基礎，我們才能開始學習 if 判斷語句和 for, while 等迴圈語法。</p>
<h2 id="參考文獻-1"><a href="#參考文獻-1">參考文獻</a></h2>
<ul>
<li>C# 程式設計人員參考
<ul>
<li>C# 教學課程：http://msdn.microsoft.com/zh-tw/library/aa288436(VS.71).aspx</li>
<li>Hello World 教學課程：http://msdn.microsoft.com/zh-tw/library/aa288463(VS.71).aspx</li>
<li>命令列參數教學課程：http://msdn.microsoft.com/zh-tw/library/aa288457(VS.71).aspx</li>
</ul></li>
</ul>
<h1 id="c-程式基礎流程控制"><a href="#c-程式基礎流程控制">C# 程式基礎：流程控制</a></h1>
<p>在結構化的程式語言中，流程控制是以判斷 (if, switch) 與迴圈 (for, while) 為主的。C# 也不例外，我們將在本文中介紹 C# 的流程控制語法，包含如何利用條件判斷語法控制程式的分支情況，以及用迴圈語法重複運行某些程式碼。</p>
<h2 id="if-語法"><a href="#if-語法">if 語法</a></h2>
<p>C# 的條件判斷以 if 為主，語法完全繼承 C 語言的語法，其語法如下：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">if</span> EXP <span class="dv">1</span>
  BLOCK <span class="dv">1</span>
<span class="kw">else</span> <span class="kw">if</span> EXP <span class="dv">2</span>
  BLOCK <span class="dv">2</span>
...
<span class="kw">else</span> EXP K
  BLOCK K</code></pre>
<p>舉例而言，假如我們想要判斷成績變數 score 是否及格，也就是 score 是否到達 60 分以上，則可以用下列語法。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">if</span> (score &gt;= <span class="dv">60</span>)
  Console.<span class="fu">WriteLine</span>(<span class="st">&quot;及格&quot;</span>);
<span class="kw">else</span>
  Console.<span class="fu">WriteLine</span>(<span class="st">&quot;不及格&quot;</span>);</code></pre>
<p>更進一步的，假如我們想用程式判斷等第，其中 90 分以上為 A，80-90 之間為 B，70-80 之間為 C，70 以下為 D，那麼就可以用下列語法進行判斷。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">if</span> (score &gt;=<span class="dv">90</span>)
  degree = <span class="st">&quot;A&quot;</span>;
<span class="kw">else</span> <span class="kw">if</span> (score &gt;= <span class="dv">80</span>)
  degree = <span class="st">&quot;B&quot;</span>;
<span class="kw">else</span> <span class="kw">if</span> (score &gt;= <span class="dv">70</span>)
  degree = <span class="st">&quot;C&quot;</span>;
<span class="kw">else</span>
  degree = <span class="st">&quot;D&quot;</span>;</code></pre>
<p>如果我們將上述範例與 if 語句的語法對照起來，可以很清楚的看到 if 語句的語法結構，如以下範例所示。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">if</span> (score &gt;=<span class="dv">90</span>)            <span class="co">// if EXP 1</span>
  degree = <span class="st">&quot;A&quot;</span>;            <span class="co">//   BLOCK 1</span>
<span class="kw">else</span> <span class="kw">if</span> (score &gt;= <span class="dv">80</span>)      <span class="co">// else if EXP 2</span>
  degree = <span class="st">&quot;B&quot;</span>;            <span class="co">//   BLOCK 2</span>
<span class="kw">else</span> <span class="kw">if</span> (score &gt;= <span class="dv">70</span>)      <span class="co">// else if (EXP 3</span>
  degree = <span class="st">&quot;C&quot;</span>;            <span class="co">//   BLOCK 3</span>
<span class="kw">else</span>                       <span class="co">// else EXP 4</span>
  degree = <span class="st">&quot;D&quot;</span>;            <span class="co">//   BLOCK 4  </span></code></pre>
<h2 id="for-語法"><a href="#for-語法">for 語法</a></h2>
<p>C# 當中的迴圈語法，包含 for, while, foreach 等，其中的 for 與 while 是由 C 繼承而來的，語法與 C 語言一致。而 foreach 的語法則是新創造的，其使用上比 for 語法更方便。</p>
<p>for 迴圈的語法如下所示，其中的 EXP1 是指定敘述，可以用來設定索引變數的初值，EXP2 是一個判斷條件，用來判斷是否應跳出迴圈，EXP3 則是累加條件，通常用來對索引變數進行累加 (++) 的動作。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">for</span> (EXP1; EXP2; EXP3)
  BLOCK;</code></pre>
<p>舉例而言，假如我們想計算從 1 加到 100 的結果，就可以利用下列程式，不斷的將索引變數值 i 加入到總和變數 sum 當中，最後 sum 當中所儲存的就會是 1+2+...+100 的結果 5050。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span> sum = <span class="dv">0</span>;
<span class="kw">for</span> (<span class="dt">int</span> i=<span class="dv">1</span>; i&lt;=<span class="dv">100</span>; i++)
  sum += i;</code></pre>
<h2 id="while-語法"><a href="#while-語法">while 語法</a></h2>
<p>while 迴圈的語法比 for 迴圈更簡單，其語法如下範例所示，其中的 EXP 是一個邏輯判斷式，用來判斷是否應該離開迴圈。在還沒離開之前，會不斷的重複執行 BLOCK 區塊。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">while</span> (EXP)
  BLOCK</code></pre>
<p>同樣的，我們也可以利用 while 迴圈計算從 1 加到 100 的結果，其程式如以下範例所示。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span> sum=<span class="dv">0</span>;
<span class="dt">int</span> i = <span class="dv">1</span>;
<span class="kw">while</span> (i&lt;=<span class="dv">100</span>) 
{
  sum = sum + i;
  i++;
}</code></pre>
<p>至於 foreach 迴圈，則是針對某個容器結構 (例如陣列) 當中的每個元素都巡迴執行一次，其語法我們將留待未來討論陣列的主題時再行說明。</p>
<h2 id="結語-2"><a href="#結語-2">結語</a></h2>
<p>判斷與迴圈是結構化程式設計的兩大流程控制方法，有效的結合判斷與迴圈，就能產生變化無窮的程式，這正是程式設計精妙的地方，也是程式設計師必須要會的基本能力。</p>
<h2 id="練習if-範例"><a href="#練習if-範例">練習：if 範例</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> ConsoleApplication1
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="co">// int score = 55;</span>
            Console.<span class="fu">Write</span>(<span class="st">&quot;請輸入分數：&quot;</span>);
            String scoreStr = Console.<span class="fu">ReadLine</span>();
            <span class="dt">int</span> score = <span class="dt">int</span>.<span class="fu">Parse</span>(scoreStr);
            <span class="kw">if</span> (score &gt;= <span class="dv">60</span>)
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;及格&quot;</span>);
            <span class="kw">else</span>
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;不及格&quot;</span>);
        }
    }
}</code></pre>
<h2 id="練習while-範例"><a href="#練習while-範例">練習：while 範例</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> ConsoleApplication1
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="dt">int</span> score = <span class="dv">55</span>;
            <span class="kw">if</span> (score &gt;= <span class="dv">60</span>)
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;及格！&quot;</span>);
            <span class="kw">else</span>
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;不及格！&quot;</span>);

            <span class="kw">while</span> (score &lt; <span class="dv">60</span>)
            {
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;score=&quot;</span> + score + <span class="st">&quot;=&gt; 不及格！&quot;</span>);
                score++;
            }
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;score=&quot;</span> + score + <span class="st">&quot;=&gt; 恭喜你！及格了！&quot;</span>);
<span class="co">/*</span>
<span class="co">            int i = 1;</span>
<span class="co">            while (i &lt;= 10)</span>
<span class="co">            {</span>
<span class="co">                Console.WriteLine(&quot;i=&quot; + i);</span>
<span class="co">                i++; // i = i + 1; // i++</span>
<span class="co">            }</span>
<span class="co">*/</span>
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= <span class="dv">10</span>; i+=<span class="dv">2</span>) <span class="co">// i+=2 =&gt; i=i+2</span>
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;i=&quot;</span> + i);


        }
    }
}</code></pre>
<h1 id="c-程式基礎陣列"><a href="#c-程式基礎陣列">C# 程式基礎：陣列</a></h1>
<p>陣列是傳統程式設計上用來儲存很多個元素的資料結構。有了陣列，我們就可以將無數的資料放入程式當中以供存取、排序或搜尋。雖然在現代的語言當中都會有其他更方便的容器存在，像是字典 (Dictionary)，但這些容器也通常是利用陣列所實作出來的。</p>
<h2 id="一維陣列"><a href="#一維陣列">一維陣列</a></h2>
<p>C# 當中的陣列是用中括號的方式宣告的。舉例而言，假如我們想宣告一個陣列可以儲存一年當中每個月的天數，我們可以用下列程式表示。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span>[] days;
days = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">12</span>];
days[<span class="dv">0</span>]=<span class="dv">31</span>; days[<span class="dv">1</span>]=<span class="dv">28</span>; days[<span class="dv">2</span>] =<span class="dv">31</span>; days[<span class="dv">3</span>]=<span class="dv">30</span>;
days[<span class="dv">4</span>]=<span class="dv">31</span>; days[<span class="dv">5</span>]=<span class="dv">30</span>; days[<span class="dv">6</span>] =<span class="dv">31</span>; days[<span class="dv">7</span>]=<span class="dv">31</span>;
days[<span class="dv">8</span>]=<span class="dv">30</span>; days[<span class="dv">9</span>]=<span class="dv">31</span>; days[<span class="dv">10</span>]=<span class="dv">30</span>; days[<span class="dv">11</span>]=<span class="dv">31</span>;</code></pre>
<p>請注意，由於 C# 繼承了 C 語言的習慣，陣列都是從 0 開始算起的。所以在上述程式中，我們用 days[0] 代表 1 月的天數，days[1] 代表 2 月的天數，以此類推，...。</p>
<p>然而，僅僅宣告每個月的天數，就需要這莫多指令，未免也太複雜了。因此，C# 語言允許我們直接設定陣列的初值，以下是我們用很簡潔的語法做到與上述範例相同的功能，但卻只要用一行就夠了。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span>[] days = { <span class="dv">31</span>, <span class="dv">28</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span> };</code></pre>
<p>有了陣列之後，我們就可以透過迴圈的方式，逐一存取陣列的內容。舉例而言，我們可以利用下列程式計算一年當中所有月份的天數總和。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span> count = <span class="dv">0</span>;
<span class="kw">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;<span class="dv">12</span>; i++)
   count += days[i];</code></pre>
<p>如果您經常寫程式，就會覺得上述範例中的 for 迴圈語法仍然不夠簡潔，因為我們總是要寫 (i=0; i&lt; ...; i++)。所以 C# 當中設計了一種更簡潔的迴圈語法，用來巡訪陣列或容器當中的每個元素，這個語法稱為 foreach。</p>
<p>我們可以用 foreach 寫出計算天數總和的程式如以下範例所示，在本範例中我們用 d 變數取出每個月的天數後，將之加入 count 變數以便計算總和。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="dt">int</span> count = <span class="dv">0</span>;
<span class="kw">foreach</span> (<span class="dt">int</span> d <span class="kw">in</span> days)
  count += d;</code></pre>
<h3 id="作業請寫出內積的版本-int-c-innerproductab"><a href="#作業請寫出內積的版本-int-c-innerproductab">作業：請寫出內積的版本 int c = innerProduct(a,b)</a></h3>
<p>解答：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> ArrayTest
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="dt">int</span>[,] a1 = { { <span class="dv">1</span>, <span class="dv">2</span> }, { <span class="dv">3</span>, <span class="dv">4</span> } };
            <span class="dt">int</span>[,] b1 = { { <span class="dv">3</span>, <span class="dv">4</span> }, { <span class="dv">5</span>, <span class="dv">6</span> } };
            <span class="dt">int</span>[,] c1 = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">2</span>, <span class="dv">2</span>];

            <span class="dt">int</span>[] a = { <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span> };
            <span class="dt">int</span>[] b = { <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span> };
            <span class="dt">int</span>[] c = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">5</span>];

            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; a.<span class="fu">Length</span>; i++)
            {
                c[i] = a[i] + b[i];
            }

            <span class="dt">int</span>[] d = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">5</span>];
            <span class="fu">arrayAdd2</span>(a, b, d);

            <span class="dt">int</span>[] e = <span class="fu">arrayAdd</span>(a, b);

            <span class="fu">printArray</span>(a);
            <span class="fu">printArray</span>(b);
            <span class="fu">printArray</span>(c);
            <span class="fu">printArray</span>(d);
            <span class="fu">printArray</span>(e);
        }

        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">printArray</span>(<span class="dt">int</span>[] x)
        {
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
                Console.<span class="fu">Write</span>(x[i] + <span class="st">&quot; &quot;</span>);
            Console.<span class="fu">WriteLine</span>();
        }

        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">arrayAdd2</span>(<span class="dt">int</span>[] x, <span class="dt">int</span>[] y, <span class="dt">int</span>[] z)
        {
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
            {
                z[i] = x[i] + y[i];
            }
        }

        <span class="kw">static</span> <span class="dt">int</span>[] <span class="fu">arrayAdd</span>(<span class="dt">int</span>[] x, <span class="dt">int</span>[] y)
        {
            <span class="dt">int</span>[] z= <span class="kw">new</span> <span class="dt">int</span>[x.<span class="fu">Length</span>];
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
            {
                z[i] = x[i] + y[i];
            }
            <span class="kw">return</span> z;
        }
    }
}</code></pre>
<h2 id="二維陣列"><a href="#二維陣列">二維陣列</a></h2>
<p>以下我們用「矩陣加法」作為範例，以說明 C# 二維陣列的用法。</p>
<p>範例：請寫出矩陣的加法 int[,] c = matrixAdd(a,b)</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> ArrayTest
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="dt">int</span>[] a = { <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span> };
            <span class="dt">int</span>[] b = { <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span> };
            <span class="dt">int</span>[] c = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">5</span>];

            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; a.<span class="fu">Length</span>; i++)
            {
                c[i] = a[i] + b[i];
            }

            <span class="dt">int</span>[] d = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">5</span>];
            <span class="fu">arrayAdd2</span>(a, b, d);

            <span class="dt">int</span>[] e = <span class="fu">arrayAdd</span>(a, b);

            <span class="fu">printArray</span>(a);
            <span class="fu">printArray</span>(b);
            <span class="fu">printArray</span>(c);
            <span class="fu">printArray</span>(d);
            <span class="fu">printArray</span>(e);
        }

        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">printArray</span>(<span class="dt">int</span>[] x)
        {
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
                Console.<span class="fu">Write</span>(x[i] + <span class="st">&quot; &quot;</span>);
            Console.<span class="fu">WriteLine</span>();
        }

        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">arrayAdd2</span>(<span class="dt">int</span>[] x, <span class="dt">int</span>[] y, <span class="dt">int</span>[] z)
        {
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
            {
                z[i] = x[i] + y[i];
            }
        }

        <span class="kw">static</span> <span class="dt">int</span>[] <span class="fu">arrayAdd</span>(<span class="dt">int</span>[] x, <span class="dt">int</span>[] y)
        {
            <span class="dt">int</span>[] z= <span class="kw">new</span> <span class="dt">int</span>[x.<span class="fu">Length</span>];
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">Length</span>; i++)
            {
                z[i] = x[i] + y[i];
            }
            <span class="kw">return</span> z;
        }
    }
}</code></pre>
<h3 id="進階題矩陣的轉置"><a href="#進階題矩陣的轉置">進階題：矩陣的轉置</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> ConsoleApplication1
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="dt">double</span>[,] a = { { <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span> }, { <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span> } };
            <span class="dt">double</span>[,] b = { { <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span> }, { <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span> } };
            <span class="dt">double</span>[,] at = <span class="fu">transpose</span>(a);

            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;a.GetLength(0)=&quot;</span> + a.<span class="fu">GetLength</span>(<span class="dv">0</span>));
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;a.GetLength(1)=&quot;</span> + a.<span class="fu">GetLength</span>(<span class="dv">1</span>));
            <span class="fu">printMatrix</span>(<span class="st">&quot;a&quot;</span>, a);
            <span class="fu">printMatrix</span>(<span class="st">&quot;b&quot;</span>, b);
            <span class="fu">printMatrix</span>(<span class="st">&quot;at&quot;</span>, at);
        }

        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">printMatrix</span>(String name, <span class="dt">double</span>[,] x)
        {
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;==========&quot;</span> + name + <span class="st">&quot;==============&quot;</span>);
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
            {
                <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; x.<span class="fu">GetLength</span>(<span class="dv">1</span>); j++)
                {
                    Console.<span class="fu">Write</span>(x[i,j]+<span class="st">&quot; &quot;</span>);
                }
                Console.<span class="fu">WriteLine</span>();
            }
        }

        <span class="kw">static</span> <span class="dt">double</span>[,] <span class="fu">transpose</span>(<span class="dt">double</span> [,] x)
        {
            <span class="dt">double</span>[,] t = <span class="kw">new</span> <span class="dt">double</span>[x.<span class="fu">GetLength</span>(<span class="dv">1</span>), x.<span class="fu">GetLength</span>(<span class="dv">0</span>)];
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; x.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
            {
                <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; x.<span class="fu">GetLength</span>(<span class="dv">1</span>); j++)
                {
                    t[j, i] = x[i, j];
                }
            }
            <span class="kw">return</span> t;
        }

    }
}</code></pre>
<h3 id="加分題請寫出矩陣的乘法-int-c-matrixmulab"><a href="#加分題請寫出矩陣的乘法-int-c-matrixmulab">加分題：請寫出矩陣的乘法 int[,] c = matrixMul(a,b)</a></h3>
<h2 id="參考文獻-2"><a href="#參考文獻-2">參考文獻</a></h2>
<ul>
<li>C# 教學課程
<ul>
<li>陣列教學課程 - http://msdn.microsoft.com/zh-tw/library/aa288453(VS.71).aspx</li>
<li>索引子教學課程 - http://msdn.microsoft.com/zh-tw/library/aa288465(VS.71).aspx</li>
<li>索引屬性教學課程 - http://msdn.microsoft.com/zh-tw/library/aa288464(VS.71).aspx</li>
</ul></li>
</ul>
<h1 id="c-程式基礎函數"><a href="#c-程式基礎函數">C# 程式基礎：函數</a></h1>
<h2 id="簡介-1"><a href="#簡介-1">簡介</a></h2>
<p>C# 分為靜態函數與成員函數兩類，靜態函數附屬於類別，呼叫時可以直接指定類別名稱即可。成員函數附屬於物件，呼叫時必須透過物件變數進行呼叫。</p>
<p>通常函數會接收到一些呼叫端傳入的參數。C# 的參數有數種傳遞方式，包含傳值參數 (call by value)，傳址參數 (call by reference) 等，基本型態的參數，像是 int, double, char, ... 等，預設都使用傳值的方式，而物件形態的參數，像是 StringBuilder，陣列等，預設則是使用傳址的方式。</p>
<p>以下是一個 C# 的靜態函數範例，其中的 square 就是靜態函數，其功能是將傳入的數值進行平方動作後傳回，這是一個傳值參數的範例。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Func1
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        <span class="dt">int</span> x = <span class="fu">square</span>(<span class="dv">5</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;x=&quot;</span>+x);
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">int</span> <span class="fu">square</span>(<span class="dt">int</span> n) 
    {
        <span class="kw">return</span> n*n;
    }
}</code></pre>
<h2 id="函數的參數"><a href="#函數的參數">函數的參數</a></h2>
<p>陣列也可以用來作為函數的參數，由於陣列的傳遞採用傳址的方式，因此在函數中對陣列的修改將會是永久性的修改，離開函數後並不會恢復成原先的數值。以下範例中的 add 函數用來將兩個二維陣列 (x,y) 相加，然後將結果放入 z 當中，print 函數則是將傳入的陣列 x 印出來。必須注意的是，對於二維陣列而言，要取得陣列的第一維元素個數 (列數)，可用 GetLength(0)，要取得陣列的第二維元素個數 (行數)，必須使用 GetLength(1)。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System; 

<span class="kw">class</span> Func2
{ 
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        <span class="dt">int</span>[,] a = {{<span class="dv">1</span>,<span class="dv">2</span>}, {<span class="dv">3</span>,<span class="dv">4</span>}};
        <span class="dt">int</span>[,] b = {{<span class="dv">5</span>,<span class="dv">6</span>}, {<span class="dv">7</span>,<span class="dv">8</span>}};
        <span class="dt">int</span>[,] c = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">2</span>,<span class="dv">2</span>];
        <span class="fu">add</span>(a, b, c);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;=======a=======&quot;</span>);
        <span class="fu">print</span>(a);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;=======b=======&quot;</span>);
        <span class="fu">print</span>(b);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;=======c=======&quot;</span>);
        <span class="fu">print</span>(c);
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">add</span>(<span class="dt">int</span>[,] x, <span class="dt">int</span>[,] y, <span class="dt">int</span>[,] z)
    {
        <span class="kw">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;z.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
        <span class="kw">for</span> (<span class="dt">int</span> j=<span class="dv">0</span>; j&lt;z.<span class="fu">GetLength</span>(<span class="dv">1</span>); j++)
        {
         z[i,j] = x[i,j] + y[i,j];
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">print</span>(<span class="dt">int</span>[,] x)
    {
        <span class="kw">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;x.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
        {
        <span class="kw">for</span> (<span class="dt">int</span> j=<span class="dv">0</span>; j&lt;x.<span class="fu">GetLength</span>(<span class="dv">1</span>); j++)
         Console.<span class="fu">Write</span>(x[i,j]+<span class="st">&quot; &quot;</span>);
        Console.<span class="fu">WriteLine</span>();
    }
    }
}</code></pre>
<h2 id="練習"><a href="#練習">練習</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">namespace</span> ConsoleApplication1
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="fu">sum</span>(<span class="dv">10</span>);
            <span class="fu">sum</span>(<span class="dv">20</span>);
            <span class="fu">sum</span>(<span class="dv">30</span>);
        }
        
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">sum</span>(<span class="dt">int</span> n) 
        {
            <span class="dt">int</span> s = <span class="dv">0</span>;
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; i++)
            {
                s = s + i;
            }
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;s = &quot;</span> + s);
        }
    }
}</code></pre>
<h1 id="c-程式基礎物件"><a href="#c-程式基礎物件">C# 程式基礎：物件</a></h1>
<p>C# 是很好的物件導向語言，而且微軟的 .NET Framework 函式庫設計得相當優美，這使得 C# 的魅力相當大。</p>
<p>傳統的程式設計會將資料與程式分開，但是在物件導向的概念當中，資料與程式被合併成一個結構，這個結構就稱為物件。</p>
<p>一個物件可以包含資料部分 (資料成員) 與函數部分 (函數成員)，函數成員可以對資料成員進行操作，以下是一個 C# 的物件範例，該範例中定義了一個人員 (Person1) 的結構，該結構包含兩個資料成員 (name, weight) 與一個成員函數 (checkWeight)，該函數會檢查人員結構的體重 (weight) 看看是重還是輕。另外，還包含了一個建構函數 Person1() ，這個建構函數可以讓使用者在建立物件時順便將參數傳入，這是物件導向的一種常見手法。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Object1 {
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args) {
        Person1 p1, p2;
        p1 = <span class="kw">new</span> <span class="fu">Person1</span>(<span class="st">&quot;大雄&quot;</span>, <span class="dv">50</span>);
        p2 = <span class="kw">new</span> <span class="fu">Person1</span>(<span class="st">&quot;胖虎&quot;</span>, <span class="dv">80</span>);
        p1.<span class="fu">checkWeight</span>();
        p2.<span class="fu">checkWeight</span>();
        p2.<span class="fu">weight</span> = <span class="dv">68</span>;
        p1.<span class="fu">checkWeight</span>();
        p2.<span class="fu">checkWeight</span>();
    }
}

<span class="kw">class</span> Person1 {
    <span class="kw">public</span> <span class="dt">string</span> name;
    <span class="kw">public</span> <span class="dt">int</span> weight;
    
    <span class="kw">public</span> <span class="fu">Person1</span>(<span class="dt">string</span> pName, <span class="dt">int</span> pWeight) {
        name   = pName;
        weight = pWeight;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">checkWeight</span>()
    {
        Console.<span class="fu">Write</span>(name+<span class="st">&quot;體重 &quot;</span>+weight+<span class="st">&quot; 公斤,&quot;</span>);
        <span class="kw">if</span> (weight &lt; <span class="dv">70</span>) 
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;很苗條!&quot;</span>);
        <span class="kw">else</span>
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;很穩重!&quot;</span>);
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\myweb\teach\CSharpProgramming&gt;csc Object1.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.


D:\myweb\teach\CSharpProgramming&gt;Object1
大雄體重 50 公斤,很苗條!
胖虎體重 80 公斤,很穩重!
大雄體重 50 公斤,很苗條!
胖虎體重 68 公斤,很苗條!</code></pre>
<h2 id="封裝"><a href="#封裝">封裝</a></h2>
<p>在傳統的結構化程式設計 (像是 C, Fortran, Pascal) 當中，我們用函數來處理資料，但是函數與資料是完全區隔開來的兩個世界。然而，在物件導向當中，函數與資料被合為一體，形成一種稱為物件的結構，我們稱這種將函數與資料放在一起的特性為「封裝」。</p>
<p>以下我們將以矩形物件為範例，說明 C# 當中的封裝語法，以及物件導向中的封裝概念。</p>
<h3 id="範例一封裝----將函數與資料裝入物件當中"><a href="#範例一封裝----將函數與資料裝入物件當中">範例一：封裝 -- 將函數與資料裝入物件當中</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Rectangle
{
    <span class="dt">double</span> width, height;

    <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>();
        r.<span class="fu">width</span> = <span class="fl">5.0</span>;
        r.<span class="fu">height</span> = <span class="fl">8.0</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());
    }
}</code></pre>
<p>執行結果</p>
<pre><code>r.area() = 40</code></pre>
<h3 id="修改進化版"><a href="#修改進化版">修改進化版</a></h3>
<p>由於上述物件與主程式混在一起，可能容易造成誤解，因此我們將主程式獨立出來，並且新增了一個 r2 的矩形物件，此時程式如下所示。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Rectangle
{
    <span class="kw">public</span> <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>();
        r.<span class="fu">width</span> = <span class="fl">5.0</span>;
        r.<span class="fu">height</span> = <span class="fl">8.0</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Rectangle r2 = <span class="kw">new</span> <span class="fu">Rectangle</span>();
        r2.<span class="fu">width</span> = <span class="fl">7.0</span>;
        r2.<span class="fu">height</span> = <span class="fl">4.0</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r2.area() = &quot;</span> + r2.<span class="fu">area</span>());
    }
}</code></pre>
<p>執行結果：</p>
<pre><code>r.area() = 40
r2.area() = 28</code></pre>
<h3 id="範例二加上建構函數"><a href="#範例二加上建構函數">範例二：加上建構函數</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Rectangle
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());
    }
}</code></pre>
<p>執行結果</p>
<pre><code>r.area() = 40</code></pre>
<h3 id="範例二加上建構函數----同時有-0-個與兩個引數"><a href="#範例二加上建構函數----同時有-0-個與兩個引數">範例二：加上建構函數 -- 同時有 0 個與兩個引數</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Rectangle
{
    <span class="kw">public</span> <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>() { }

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Rectangle r2 = <span class="kw">new</span> <span class="fu">Rectangle</span>();
        r2.<span class="fu">width</span> = <span class="fl">7.0</span>;
        r2.<span class="fu">height</span> = <span class="fl">4.0</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r2.area() = &quot;</span> + r2.<span class="fu">area</span>());
    }
}</code></pre>
<h3 id="習題向量物件"><a href="#習題向量物件">習題：向量物件</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Vector
{
    <span class="dt">double</span>[] a;

    <span class="kw">public</span> <span class="fu">Vector</span>(<span class="dt">double</span>[] array)
    {
        a = <span class="kw">new</span> <span class="dt">double</span>[array.<span class="fu">GetLength</span>(<span class="dv">0</span>)];
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; a.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
        {
            a[i] = array[i];
        }
    }

    <span class="kw">public</span> Vector <span class="fu">add</span>(Vector v2)
    {
        Vector rv = <span class="kw">new</span> <span class="fu">Vector</span>(v2.<span class="fu">a</span>);
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; rv.<span class="fu">a</span>.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
        {
            rv.<span class="fu">a</span>[i] = <span class="kw">this</span>.<span class="fu">a</span>[i] + v2.<span class="fu">a</span>[i];
        }
        <span class="kw">return</span> rv;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">print</span>()
    {
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; a.<span class="fu">GetLength</span>(<span class="dv">0</span>); i++)
        {
            Console.<span class="fu">Write</span>(a[i] + <span class="st">&quot; &quot;</span>);
        }
        Console.<span class="fu">WriteLine</span>();
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Vector v1 = <span class="kw">new</span> <span class="fu">Vector</span>(<span class="kw">new</span> <span class="dt">double</span>[] { <span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span> });
        Vector v2 = <span class="kw">new</span> <span class="fu">Vector</span>(<span class="kw">new</span> <span class="dt">double</span>[] { <span class="fl">4.0</span>, <span class="fl">5.0</span>, <span class="fl">6.0</span> });
        Vector v3 = v1.<span class="fu">add</span>(v2);

        v1.<span class="fu">print</span>();
        v2.<span class="fu">print</span>();
        v3.<span class="fu">print</span>();
    }
}</code></pre>
<p>進階練習 1：加上內積的函數，並寫出呼叫範例。 進階練習 2：寫出矩陣物件 (有加法、乘法) (方法一：用二維陣列、方法二：用 Vector)。</p>
<h3 id="習題矩陣物件"><a href="#習題矩陣物件">習題：矩陣物件</a></h3>
<h2 id="繼承"><a href="#繼承">繼承</a></h2>
<h3 id="範例一矩形圓形繼承形狀-shape"><a href="#範例一矩形圓形繼承形狀-shape">範例一：矩形、圓形繼承形狀 (Shape)</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">double</span> <span class="fu">area</span>() { <span class="kw">return</span> <span class="fl">0.0</span>; }
}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Shape s = <span class="kw">new</span> <span class="fu">Shape</span>();
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;s.area() = &quot;</span> + s.<span class="fu">area</span>());

        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">2</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());
    }
}</code></pre>
<p>執行結果：</p>
<pre><code>s.area() = 0
r.area() = 40
c.area() = 12.5664</code></pre>
<h3 id="範例二加入厚度與體積函數-在子物件使用父物件的欄位"><a href="#範例二加入厚度與體積函數-在子物件使用父物件的欄位">範例二：加入厚度與體積函數 (在子物件使用父物件的欄位)</a></h3>
<p>執行結果</p>
<pre><code>s.area() = 0
r.area() = 40
r.volume() = 80
c.area() = 12.5664
c.volume() = 37.6992
c.volume() = 62.832</code></pre>
<p>程式碼</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="dt">double</span> thick;
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">double</span> <span class="fu">area</span>() { <span class="kw">return</span> <span class="fl">0.0</span>; }
}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
        thick = <span class="fl">2.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">volume</span>()
    {
        <span class="kw">return</span> width * height * thick;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
        thick = <span class="fl">3.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">volume</span>()
    {
        <span class="kw">return</span> <span class="fu">area</span>() * thick;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Shape s = <span class="kw">new</span> <span class="fu">Shape</span>();
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;s.area() = &quot;</span> + s.<span class="fu">area</span>());

        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.volume() = &quot;</span> + r.<span class="fu">volume</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">2</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());
        c.<span class="fu">thick</span> = <span class="dv">5</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());
    }
}</code></pre>
<h3 id="範例三將-volume-函數提到-shape-物件中"><a href="#範例三將-volume-函數提到-shape-物件中">範例三：將 volume() 函數提到 Shape 物件中</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="dt">double</span> thick;
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">double</span> <span class="fu">area</span>() { <span class="kw">return</span> <span class="fl">0.0</span>; }
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">volume</span>()
    {
        <span class="kw">return</span> <span class="fu">area</span>() * thick;
    }
}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
        thick = <span class="fl">2.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
        thick = <span class="fl">3.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Shape s = <span class="kw">new</span> <span class="fu">Shape</span>();
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;s.area() = &quot;</span> + s.<span class="fu">area</span>());

        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.volume() = &quot;</span> + r.<span class="fu">volume</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">2</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());
        c.<span class="fu">thick</span> = <span class="dv">5</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());
    }
}</code></pre>
<h3 id="習題人學生與老師"><a href="#習題人學生與老師">習題：人、學生與老師</a></h3>
<p>請定義「人、學生與老師」等三個類別，其中的人有「姓名、性別、年齡」三個欄位，學生另外有「學號、年級」等兩個欄位，老師另外有「職等」的欄位，所有物件都有 print() 函數，可以將該物件的所有欄位印出。</p>
<p>請建立一個具有 3 個學生與兩個老師的陣列，利用多型機制，呼叫 print 函數以便印出這 5 個人的基本資料，如下所示。</p>
<pre><code>學生 --  姓名：王小明，性別：男，年齡：20，學號：R773122456，年級：一年級
學生 --  姓名：李小華，性別：女，年齡：19，學號：R773122432，年級：一年級
教師 --  姓名：陳福氣，性別：男，年齡：40，職等：教授
學生 --  姓名：黃大虎，性別：男，年齡：22，學號：R773122721，年級：四年級
教師 --  姓名：李美女，性別：女，年齡：35，職等：助理教授</code></pre>
<p>解答：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">namespace</span> Person
{
<span class="co">/*</span>
<span class="co"> * 請定義「人、學生與老師」等三個類別，其中的人有「姓名、性別、年齡」三個欄位，</span>
<span class="co"> * 學生另外有「學號、年級」等兩個欄位，老師另外有「職等」的欄位，所有物件都有 </span>
<span class="co"> * print() 函數，可以將該物件的所有欄位印出。</span>
<span class="co"> * </span>
<span class="co"> * 請建立一個具有 3 個學生與兩個老師的陣列，利用多型機制，呼叫 print 函數以便</span>
<span class="co"> * 印出這 5 個人的基本資料，如下所示。    </span>
<span class="co"> * </span>
<span class="co"> * 學生 --  姓名：王小明，性別：男，年齡：20，學號：R773122456，年級：一年級</span>
<span class="co"> * 學生 --  姓名：李小華，性別：女，年齡：19，學號：R773122432，年級：一年級</span>
<span class="co"> * 教師 --  姓名：陳福氣，性別：男，年齡：40，職等：教授</span>
<span class="co"> * 學生 --  姓名：黃大虎，性別：男，年齡：22，學號：R773122721，年級：四年級</span>
<span class="co"> * 教師 --  姓名：李美女，性別：女，年齡：35，職等：助理教授</span>
<span class="co">*/</span>
        <span class="kw">class</span> Program
        {
            <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
            {
                Student s1 = <span class="kw">new</span> <span class="fu">Student</span>(<span class="st">&quot;王小明&quot;</span>, <span class="st">&quot;男&quot;</span>, <span class="dv">20</span>, <span class="st">&quot;R773122456&quot;</span>, <span class="dv">1</span>);
                Student s2 = <span class="kw">new</span> <span class="fu">Student</span>(<span class="st">&quot;李小華&quot;</span>, <span class="st">&quot;女&quot;</span>, <span class="dv">19</span>, <span class="st">&quot;R773122432&quot;</span>, <span class="dv">1</span>);
                Student s3 = <span class="kw">new</span> <span class="fu">Student</span>(<span class="st">&quot;黃大虎&quot;</span>, <span class="st">&quot;男&quot;</span>, <span class="dv">22</span>, <span class="st">&quot;R773122721&quot;</span>, <span class="dv">4</span>);
                Person t1 = <span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;陳福氣&quot;</span>, <span class="st">&quot;男&quot;</span>, <span class="dv">40</span>);
                Person t2 = <span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;李美女&quot;</span>, <span class="st">&quot;女&quot;</span>, <span class="dv">35</span>);

                Person[] list = { s1, s2, t1, s3, t2 };
                <span class="kw">foreach</span> (Person p <span class="kw">in</span> list)
                {
                    p.<span class="fu">print</span>();
                    Console.<span class="fu">WriteLine</span>();
                }
            }
        }

        <span class="kw">class</span> Person
        {
            String name;
            String sex;
            <span class="dt">int</span> age;

            <span class="kw">public</span> <span class="fu">Person</span>(String name, String sex, <span class="dt">int</span> age)
            {
                <span class="kw">this</span>.<span class="fu">name</span> = name;
                <span class="kw">this</span>.<span class="fu">sex</span> = sex;
                <span class="kw">this</span>.<span class="fu">age</span> = age;
            }

            <span class="kw">public</span> <span class="kw">virtual</span> Person <span class="fu">print</span>()
            {
                Console.<span class="fu">Write</span>(<span class="st">&quot;姓名：&quot;</span>+name+<span class="st">&quot; 性別：&quot;</span>+sex+<span class="st">&quot; 年齡：&quot;</span>+age);
                <span class="kw">return</span> <span class="kw">this</span>;
            }
        }

        <span class="kw">class</span> Student : Person
        {
            String id;
            <span class="dt">int</span> degree;

            <span class="kw">public</span> <span class="fu">Student</span>(String name, String sex, <span class="dt">int</span> age, String id, <span class="dt">int</span> degree)
                : <span class="kw">base</span>(name, sex, age)
            {
                <span class="kw">this</span>.<span class="fu">id</span> = id;
                <span class="kw">this</span>.<span class="fu">degree</span> = degree;
            }

            <span class="kw">public</span> <span class="kw">override</span> Person <span class="fu">print</span>()
            {
                Console.<span class="fu">Write</span>(<span class="st">&quot;學生 -- &quot;</span>);
                <span class="kw">base</span>.<span class="fu">print</span>();
                Console.<span class="fu">Write</span>(<span class="st">&quot; 學號：&quot;</span> + id + <span class="st">&quot; 年級：&quot;</span> + degree);
                <span class="kw">return</span> <span class="kw">this</span>;
            }
        }
}</code></pre>
<h2 id="多型"><a href="#多型">多型</a></h2>
<p>物件導向的多型機制，是指當兩個以上的類別繼承同一種父類別時，我們可以用父類別型態容納子類別的物件，真正進行函數呼叫時會呼叫到子類別的函數，此種特性稱之為多型。</p>
<p>以下是我們用 C# 實作的一個多型範例，在範例中，我們宣告了一個形狀類別，該類別具有一個 area() 函數可以計算該形狀的面積，然後我們又宣告了兩個子類別 Rectangle (矩形) 與 Circle (圓形)。我們將兩者放入到 shapes 陣列中，以便展示多型技巧，用父類別容器呼叫子類別的實體。</p>
<h3 id="範例形狀矩形與圓形"><a href="#範例形狀矩形與圓形">範例：形狀、矩形與圓形</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">double</span> <span class="fu">area</span>() { <span class="kw">return</span> <span class="fl">0.0</span>; }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="fl">3.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());

        Shape[] shapes = { r, c };
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; shapes.<span class="fu">Length</span>; i++)
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;shapes[&quot;</span> + i + <span class="st">&quot;].area()=&quot;</span> + shapes[i].<span class="fu">area</span>());
    }
}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}</code></pre>
<p>執行結果</p>
<pre><code>r.area() = 40
c.area() = 28.2744
shapes[0].area()=40
shapes[1].area()=28.2744</code></pre>
<h3 id="範例使用抽象父型態"><a href="#範例使用抽象父型態">範例：使用抽象父型態</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> ShapeTest
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="fl">3.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());

        Shape[] shapes = { r, c };
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; shapes.<span class="fu">Length</span>; i++)
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;shapes[&quot;</span> + i + <span class="st">&quot;].area()=&quot;</span> + shapes[i].<span class="fu">area</span>());
    }
}

<span class="kw">abstract</span> <span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="dt">double</span> <span class="fu">area</span>();

}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}</code></pre>
<p>執行結果： <code>r.area() = 40 c.area() = 28.2744 shapes[0].area()=40 shapes[1].area()=28.2744</code></p>
<h3 id="範例使用介面"><a href="#範例使用介面">範例：使用介面</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> ShapeTest
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="fl">3.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());

        Shape[] shapes = { r, c };
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; shapes.<span class="fu">Length</span>; i++)
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;shapes[&quot;</span> + i + <span class="st">&quot;].area()=&quot;</span> + shapes[i].<span class="fu">area</span>());
    }
}

<span class="kw">interface</span> Shape
{
    <span class="dt">double</span> <span class="fu">area</span>();

}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
    }

    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}</code></pre>
<p>執行結果：</p>
<pre><code>r.area() = 40
c.area() = 28.2744
shapes[0].area()=40
shapes[1].area()=28.2744</code></pre>
<h3 id="範例較完整複雜的版本"><a href="#範例較完整複雜的版本">範例：較完整複雜的版本</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Shape
{
    <span class="kw">public</span> <span class="dt">double</span> thick = <span class="fl">0.0</span>;
    <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">double</span> <span class="fu">area</span>() { <span class="kw">return</span> <span class="fl">0.0</span>; }
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">volume</span>()
    {
        <span class="kw">return</span> <span class="fu">area</span>() * thick;
    }

    <span class="kw">public</span> <span class="kw">override</span> String <span class="fu">ToString</span>()
    {
        <span class="kw">return</span> <span class="st">&quot;Shape: thick=&quot;</span> + thick+<span class="st">&quot; area=&quot;</span>+<span class="fu">area</span>()+<span class="st">&quot; volume=&quot;</span>+<span class="fu">volume</span>();
    }
}

<span class="kw">class</span> Rectangle : Shape
{
    <span class="dt">double</span> width, height;

    <span class="kw">public</span> <span class="fu">Rectangle</span>(<span class="dt">double</span> w, <span class="dt">double</span> h)
    {
        width = w;
        height = h;
        thick = <span class="fl">2.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> String <span class="fu">ToString</span>()
    {
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fu">ToString</span>()+<span class="st">&quot; Rectangle:width=&quot;</span> + width + <span class="st">&quot; height=&quot;</span> + height;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> width * height;
    }
}

<span class="kw">class</span> Circle : Shape
{
    <span class="dt">double</span> r;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> r)
    {
        <span class="kw">this</span>.<span class="fu">r</span> = r;
        thick = <span class="fl">3.0</span>;
    }

    <span class="kw">public</span> <span class="kw">override</span> String <span class="fu">ToString</span>()
    {
        <span class="kw">return</span> <span class="kw">base</span>.<span class="fu">ToString</span>() + <span class="st">&quot; Circle:r=&quot;</span> + r + <span class="st">&quot; thick=&quot;</span> + thick;
    }

    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">area</span>()
    {
        <span class="kw">return</span> <span class="fl">3.1416</span> * r * r;
    }
}

<span class="kw">class</span> Test
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Shape s = <span class="kw">new</span> <span class="fu">Shape</span>();
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;s.area() = &quot;</span> + s.<span class="fu">area</span>());

        Rectangle r = <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.area() = &quot;</span> + r.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;r.volume() = &quot;</span> + r.<span class="fu">volume</span>());

        Circle c = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">2</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.area() = &quot;</span> + c.<span class="fu">area</span>());
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());
        c.<span class="fu">thick</span> = <span class="dv">5</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;c.volume() = &quot;</span> + c.<span class="fu">volume</span>());

        Shape[] array = <span class="kw">new</span> Shape[] { s, r, c, r };
        <span class="kw">foreach</span> (Shape o <span class="kw">in</span> array)
        {
<span class="co">//            Console.WriteLine(&quot;o.area()=&quot; + o.area() +&quot; o.volume()=&quot;+o.volume());</span>
            Console.<span class="fu">WriteLine</span>(o.<span class="fu">ToString</span>());
        }
    }
}</code></pre>
<h2 id="參考文獻-3"><a href="#參考文獻-3">參考文獻</a></h2>
<ul>
<li>C# 教學課程
<ul>
<li>結構教學課程 - <a href="http://msdn.microsoft.com/zh-tw/library/aa288471(VS.71).aspx">http://msdn.microsoft.com/zh-tw/library/aa288471(VS.71).aspx</a></li>
<li>使用者定義轉換教學課程 - <a href="http://msdn.microsoft.com/zh-tw/library/aa288476(VS.71).aspx">http://msdn.microsoft.com/zh-tw/library/aa288476(VS.71).aspx</a></li>
<li>運算子多載化教學課程 - <a href="http://msdn.microsoft.com/zh-tw/library/aa288467(VS.71).aspx">http://msdn.microsoft.com/zh-tw/library/aa288467(VS.71).aspx</a></li>
</ul></li>
</ul>
<h1 id="c-程式基礎例外處理"><a href="#c-程式基礎例外處理">C# 程式基礎：例外處理</a></h1>
<p>C# 支援例外處理機制，當有任何的例外錯誤發生時，程式會立刻中斷，然後跳出到外層。此時，如果有任何例外處理的程式 (try ... catch) 位於外層，就會接到這個例外，並可以即時處理之。否則，該例外會一直被往外丟，假如都沒有被處理，則程式將被迫中斷，系統會自行輸出例外訊息。</p>
<h2 id="範例引發例外"><a href="#範例引發例外">範例：引發例外</a></h2>
<p>以下是一個會引發例外的程式，由於 a/b = 3/0 會導致嘗試以零除 (System.DivideByZeroException) 的例外，但這個例外又沒有被任何的 try ... catch 段落所處理，因此整個程式會中斷並輸出錯誤訊息。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Try1
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        <span class="dt">int</span> a = <span class="dv">3</span>, b = <span class="dv">0</span>;
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;a/b=&quot;</span> + a/b);
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\myweb\teach\CSharpProgramming&gt;csc Try1.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.


D:\myweb\teach\CSharpProgramming&gt;Try1

未處理的例外狀況: System.DivideByZeroException: 嘗試以零除。
   於 Try1.Main(String[] args)</code></pre>
<h2 id="範例捕捉例外"><a href="#範例捕捉例外">範例：捕捉例外</a></h2>
<p>要處理例外可以用 try...catch 語句，以下範例就利用 try { ... } catch (DivideByZeroException ex) 捕捉了上述的除以零之例外，您可以在 catch 段落中進行例外處理後，再決定要如何繼續執行程式。(本範例中只單純的提示被除數不可為零)。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">class</span> Try2
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        <span class="kw">try</span>
        {
         <span class="dt">int</span> a = <span class="dv">3</span>, b = <span class="dv">0</span>;
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;a/b=&quot;</span> + a / b);
        }
        <span class="kw">catch</span> (DivideByZeroException ex)
        {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;被除數不可為 0 !</span><span class="ch">\n</span><span class="st">&quot;</span>+ex);
        }
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\myweb\teach\CSharpProgramming&gt;csc Try2.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.


D:\myweb\teach\CSharpProgramming&gt;Try2
被除數不可為 0 !
System.DivideByZeroException: 嘗試以零除。
   於 Try2.Main(String[] args)</code></pre>
<h2 id="視窗版的例外處理"><a href="#視窗版的例外處理">視窗版的例外處理</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> WError
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">button1_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="kw">try</span>
            {
                <span class="dt">double</span> x = <span class="dt">double</span>.<span class="fu">Parse</span>(textBox1.<span class="fu">Text</span>);
                <span class="dt">double</span> y = <span class="dt">double</span>.<span class="fu">Parse</span>(textBox2.<span class="fu">Text</span>);
                String op = comboBox1.<span class="fu">Text</span>;
                <span class="dt">double</span> result = <span class="fl">0.0</span>;
                <span class="kw">switch</span> (op)
                {
                    <span class="kw">case</span> <span class="st">&quot;+&quot;</span>: result = x + y; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;-&quot;</span>: result = x - y; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;*&quot;</span>: result = x * y; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;/&quot;</span>: result = x / y; <span class="kw">break</span>;
                    <span class="kw">default</span>: <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>(<span class="st">&quot;出現錯誤!&quot;</span>);
                }
                textBox3.<span class="fu">Text</span> = result.<span class="fu">ToString</span>();
            }
            <span class="kw">catch</span>
            {
                textBox3.<span class="fu">Text</span> = <span class="st">&quot;錯誤&quot;</span>;
            }
        }
    }
}</code></pre>
<p>執行結果：</p>
<div class="figure">
<img src="../img/WinErrorRun.png" alt="圖、視窗版的例外處理" /><p class="caption">圖、視窗版的例外處理</p>
</div>
<h1 id="c-程式基礎資料結構"><a href="#c-程式基礎資料結構">C# 程式基礎：資料結構</a></h1>
<h2 id="容器函式庫"><a href="#容器函式庫">容器函式庫</a></h2>
<table>
<thead>
<tr class="header">
<th align="left">一般型別</th>
<th align="left">泛型型別</th>
<th align="left">說明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ArrayList</td>
<td align="left"><code>List&lt; &gt;</code></td>
<td align="left">串列，以陣列實作的串列結構</td>
</tr>
<tr class="even">
<td align="left">Queue</td>
<td align="left"><code>Queue&lt; &gt;</code></td>
<td align="left">佇列，先進先出的結構</td>
</tr>
<tr class="odd">
<td align="left">Stack</td>
<td align="left"><code>Stack&lt; &gt;</code></td>
<td align="left">堆疊，後進先出的結構</td>
</tr>
<tr class="even">
<td align="left">Hashtable</td>
<td align="left"><code>Dictionary&lt; &gt;</code></td>
<td align="left">雜湊表格，快速用 key 查找 value</td>
</tr>
<tr class="odd">
<td align="left">SortedList</td>
<td align="left"><code>SortedList&lt; &gt;</code></td>
<td align="left">排序串列，使用排序與二分搜尋法的結構</td>
</tr>
<tr class="even">
<td align="left">ListDictionary</td>
<td align="left"><code>Dictionary&lt; &gt;</code></td>
<td align="left">字典，快速用 key 查找 value</td>
</tr>
<tr class="odd">
<td align="left">HybridDictionary</td>
<td align="left"><code>Dictionary&lt; &gt;</code></td>
<td align="left">小集合採用 ListDictionary，集合變大時，會自動改用 Hashtable 的一種字典</td>
</tr>
<tr class="even">
<td align="left">OrderedDictionary</td>
<td align="left"><code>Dictionary&lt; &gt;</code></td>
<td align="left">比SortedList類別多了一些功能的類別</td>
</tr>
<tr class="odd">
<td align="left">SortedDictionary</td>
<td align="left"><code>SortedDictionary&lt; &gt;</code></td>
<td align="left">鍵值一定是字串，用法跟 Hashtable 相似</td>
</tr>
<tr class="even">
<td align="left">NameValueCollection</td>
<td align="left"><code>Dictionary&lt; &gt;</code></td>
<td align="left">NameValueCollection可以單一索引鍵對應多重值</td>
</tr>
<tr class="odd">
<td align="left">DictionaryEntry</td>
<td align="left"><code>KeyValPair&lt; &gt;</code></td>
<td align="left">字典中的一個項目，(Key, Value) 的結構</td>
</tr>
<tr class="even">
<td align="left">StringCollection</td>
<td align="left"><code>List&lt;String&gt;</code></td>
<td align="left">用法跟ArrayList相似</td>
</tr>
<tr class="odd">
<td align="left">StringDictionary</td>
<td align="left"><code>Dictionary&lt;String&gt;</code></td>
<td align="left">字串字典</td>
</tr>
</tbody>
</table>
<ul>
<li>上層結構：Collection</li>
<li>容器物件：Array, ArrayList, HashTable, SortedList</li>
<li>位元容器：BitArray, BitVector32,</li>
<li>泛型容器：NameValueCollection, Dictionary</li>
</ul>
<h2 id="容器的使用"><a href="#容器的使用">容器的使用</a></h2>
<p>範例：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;

<span class="kw">namespace</span> ConsoleApplication1
{
    <span class="kw">class</span> Program
    {
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            ArrayList a = <span class="kw">new</span> <span class="fu">ArrayList</span>();
            a.<span class="fu">Add</span>(<span class="st">&quot;John&quot;</span>);
            a.<span class="fu">Add</span>(<span class="dv">1</span>);
            a.<span class="fu">Add</span>(<span class="fl">3.1416</span>);
            a.<span class="fu">RemoveAt</span>(<span class="dv">2</span>);

            Object[] array = a.<span class="fu">ToArray</span>();
            Console.<span class="fu">WriteLine</span>(array);

            List&lt;Object&gt; list = <span class="kw">new</span> List&lt;Object&gt;();
            list.<span class="fu">Add</span>(<span class="st">&quot;John&quot;</span>);
            list.<span class="fu">Add</span>(<span class="st">&quot;Mary&quot;</span>);
            list.<span class="fu">Add</span>(<span class="st">&quot;George&quot;</span>);
            list.<span class="fu">Add</span>(<span class="st">&quot;3.14159&quot;</span>);
            list.<span class="fu">Add</span>(<span class="fl">3.14159</span>);

            <span class="kw">foreach</span> (Object o <span class="kw">in</span> list)
                Console.<span class="fu">Write</span>(o+<span class="st">&quot; &quot;</span>);
            Console.<span class="fu">WriteLine</span>();
            <span class="dt">char</span> c = &#39;A&#39;;
<span class="co">//            Console.Write(&quot;{0:X}&quot;, (int) c);</span>

            Hashtable h = <span class="kw">new</span> <span class="fu">Hashtable</span>();
            h.<span class="fu">Add</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;0977332415&quot;</span>);
            h.<span class="fu">Add</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;0977342415&quot;</span>);
            h.<span class="fu">Add</span>(<span class="st">&quot;George&quot;</span>, <span class="st">&quot;0977372416&quot;</span>);
            h.<span class="fu">Add</span>(<span class="st">&quot;Peter&quot;</span>, <span class="st">&quot;0977332425&quot;</span>);
            String gtel = (String) h[<span class="st">&quot;George&quot;</span>];
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;George Tel : &quot;</span>+gtel);

            Dictionary&lt;String, String&gt; d = <span class="kw">new</span> Dictionary&lt;<span class="dt">string</span>, <span class="dt">string</span>&gt;();
            d.<span class="fu">Add</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;0977332415&quot;</span>);
            d.<span class="fu">Add</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;0977342415&quot;</span>);
            d.<span class="fu">Add</span>(<span class="st">&quot;George&quot;</span>, <span class="st">&quot;0977372416&quot;</span>);
            d.<span class="fu">Add</span>(<span class="st">&quot;Peter&quot;</span>, <span class="st">&quot;0977332425&quot;</span>);
            gtel = d[<span class="st">&quot;George&quot;</span>];
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;George Tel : &quot;</span> + gtel);

        }

    }
}</code></pre>
<h1 id="c-程式基礎檔案處理"><a href="#c-程式基礎檔案處理">C# 程式基礎：檔案處理</a></h1>
<p>C# 當中的檔案主要以串流 (Stream) 的形式呈現，串流讀取器 (StreamReader) 與串流寫入器 (StreamWriter) 是兩個主要的檔案處理類別。另外像 File，FileInfo, DirectoryInfo 等，則是用來存取檔案屬性與資料夾的類別。而BufferedStream、FileStream、MemoryStream、NetworkStream 則是分別對應到緩衝、檔案、記憶體、網路等類型的串流物件。因此串流可以說是檔案與網路的共同介面。</p>
<h2 id="讀取檔案"><a href="#讀取檔案">讀取檔案</a></h2>
<p>以下範例中的 fileToText() 函數，會將一個文字檔讀入放到字串中傳回，其方法是利用 StreamReader 物件，指定所要讀取的檔案，然後利用 readToEnd() 函數讀取整個文字檔，再用 Close() 函數關閉該檔案。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">IO</span>;

<span class="kw">class</span> FileTest 
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        String text = <span class="fu">fileToText</span>(args[<span class="dv">0</span>]);
        Console.<span class="fu">WriteLine</span>(text);
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">fileToText</span>(String filePath)
    {
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(filePath);
        String text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> text;
    }
}</code></pre>
<p>上述範例的執行結果如下所示，必須注意的是，Hello.txt 檔案必須存在，而且儲存成 Unicode 的 UTF8 格式，這是因為 C# 內部預設使用 Unicode 的編碼格式。如果希望讀取 Big5 (或 GB2312) 格式的檔案，必須在 StreamReader() 建構函數當中，指定StreamReader file = new StreamReader(filePath, System.Text.Encoding.GetEncoding(&quot;Big5&quot;)) ，如此 StreamReader 才會以 Big5 的編碼方式對檔案進行讀取，結果才不會變成亂碼。</p>
<pre><code>D:\&gt;csc FileTest.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

D:\&gt;FileTest Hello.txt
Hello !
你好 !</code></pre>
<h2 id="寫入檔案"><a href="#寫入檔案">寫入檔案</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">IO</span>;

<span class="kw">class</span> FileTest
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        String text1 = <span class="st">&quot;Hello, C#!&quot;</span>;
        String file = <span class="st">&quot;Hello.txt&quot;</span>;
        <span class="fu">textToFile</span>(file, text1);
        String text2 = <span class="fu">fileToText</span>(file);
        Console.<span class="fu">WriteLine</span>(text2);
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">fileToText</span>(String filePath)
    {
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(filePath);
        String text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> text;
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">textToFile</span>(String filePath, String text)
    {
        StreamWriter file = <span class="kw">new</span> <span class="fu">StreamWriter</span>(filePath);
        file.<span class="fu">Write</span>(text);
        file.<span class="fu">Close</span>();
    }
}</code></pre>
<p>執行結果</p>
<pre><code>C:\ccc&gt;csc File.cs
Microsoft (R) Visual C# 2005 Compiler version 8.00.50727.3053
for Microsoft (R) Windows (R) 2005 Framework version 2.0.50727
Copyright (C) Microsoft Corporation 2001-2005. All rights reserved.


C:\ccc&gt;File Hello.txt
Hello, C#!</code></pre>
<h2 id="物件導向的寫法"><a href="#物件導向的寫法">物件導向的寫法</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">IO</span>;

<span class="kw">class</span> File
{
    String path;

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        File file = <span class="kw">new</span> <span class="fu">File</span>(<span class="st">&quot;Hello.txt&quot;</span>);
        file.<span class="fu">save</span>(<span class="st">&quot;Hello, C#!&quot;</span>);
        String text2 = file.<span class="fu">load</span>();
        Console.<span class="fu">WriteLine</span>(text2);
    }

    <span class="kw">public</span> <span class="fu">File</span>(String path)
    {
        <span class="kw">this</span>.<span class="fu">path</span> = path;
    }

    <span class="kw">public</span> String <span class="fu">load</span>()
    {
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(path);
        String text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> text;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">save</span>(String text)
    {
        StreamWriter file = <span class="kw">new</span> <span class="fu">StreamWriter</span>(path);
        file.<span class="fu">Write</span>(text);
        file.<span class="fu">Close</span>();
    }
}</code></pre>
<p>執行結果</p>
<pre><code>C:\ccc&gt;csc FileTest.cs
Microsoft (R) Visual C# 2005 Compiler version 8.00.50727.3053
for Microsoft (R) Windows (R) 2005 Framework version 2.0.50727
Copyright (C) Microsoft Corporation 2001-2005. All rights reserved.


C:\ccc&gt;FileTest Hello.txt
Hello, C#!</code></pre>
<h2 id="更物件導向的寫法"><a href="#更物件導向的寫法">更物件導向的寫法</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">IO</span>;

<span class="kw">class</span> TextFile
{
    String path;
    String text;

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        TextFile file = <span class="kw">new</span> <span class="fu">TextFile</span>();
        file.<span class="fu">load</span>(args[<span class="dv">0</span>]).<span class="fu">print</span>();
    }

    <span class="kw">public</span> <span class="fu">TextFile</span>() {}

    <span class="kw">public</span> TextFile <span class="fu">load</span>(String path)
    {
        <span class="kw">this</span>.<span class="fu">path</span> = path;
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(path);
        text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> <span class="kw">this</span>;
    }

    <span class="kw">public</span> TextFile <span class="fu">save</span>()
    {
        StreamWriter file = <span class="kw">new</span> <span class="fu">StreamWriter</span>(path);
        file.<span class="fu">Write</span>(text);
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> <span class="kw">this</span>;
    }

    <span class="kw">public</span> TextFile <span class="fu">print</span>()
    {
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;file: path=&quot;</span>+path);
        Console.<span class="fu">WriteLine</span>(text);
        <span class="kw">return</span> <span class="kw">this</span>;
    }
}</code></pre>
<p>執行結果</p>
<pre><code>C:\ccc&gt;csc TextFile.cs
Microsoft (R) Visual C# 2005 Compiler version 8.00.50727.3053
for Microsoft (R) Windows (R) 2005 Framework version 2.0.50727
Copyright (C) Microsoft Corporation 2001-2005. All rights reserved.


C:\ccc&gt;TextFile Hello.txt
file: path=Hello.txt
Hello, C#!
C# 真有趣!
I love C#.
</code></pre>
<h1 id="c-程式進階正規表達式"><a href="#c-程式進階正規表達式">C# 程式進階：正規表達式</a></h1>
<p>正規表達式是現代程式設計的重要工具，在 C# 當中，對正規表達式的支援相當的完整。您可以用正規表達式抽取出文件中的電話、地址、超連結、email 等欄位，因此正規表達式在文字型資料的處理上是相當方便的。</p>
<h2 id="程式範例"><a href="#程式範例">程式範例</a></h2>
<p>在以下的範例中，我們利用正規表達式 &quot;[0-9]+號&quot;，抽取出字串當中的號碼，像是 32號，45號等。其中的 matches 函數是正規表達式的主要部分，我們透過 Regex 物件中的 Match(pText) 與 NextMatch() 函數，不斷取得比對的結果 (Match m)，然後再利用Match 結構取出 m.Groups[pGroupId].Value 這個比對的值，其中若 pGroudId 為 0 ，代表所要取得的是比對結果的全部。而 m.Success 可以用來判斷下一個比對是否成功，這可以做為回圈節數的條件。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>.<span class="fu">RegularExpressions</span>;

<span class="kw">public</span> <span class="kw">class</span> Regexp
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        String text = <span class="st">&quot;王小明:32號，李小華：45號&quot;</span>;
        <span class="kw">foreach</span> (String s <span class="kw">in</span> <span class="fu">matches</span>(<span class="st">&quot;[0-9]+號&quot;</span>, text, <span class="dv">0</span>))
         Console.<span class="fu">WriteLine</span>(s);
    }

    <span class="kw">public</span> <span class="kw">static</span> IEnumerable <span class="fu">matches</span>(String pPattern, String pText, <span class="dt">int</span> pGroupId)
    {
        Regex r = <span class="kw">new</span> <span class="fu">Regex</span>(pPattern, RegexOptions.<span class="fu">IgnoreCase</span> | RegexOptions.<span class="fu">Compiled</span>);
        <span class="kw">for</span> (Match m = r.<span class="fu">Match</span>(pText); m.<span class="fu">Success</span>; m = m.<span class="fu">NextMatch</span>())
         <span class="kw">yield</span> <span class="kw">return</span> m.<span class="fu">Groups</span>[pGroupId].<span class="fu">Value</span>;
    }
}</code></pre>
<p>上述範例的執行結果如下所示，您可以看到字串 &quot;王小明:32號，李小華：45號&quot; 當中的 32號與 45 號被抽出來了，這正是正規表達式 &quot;[0-9]+號&quot; 所指定的樣式阿。</p>
<pre><code>D:\myweb\teach\CSharpNetworkProgramming&gt;csc RegexpTest1.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.


D:\myweb\teach\CSharpNetworkProgramming&gt;RegexpTest1
32號
45號</code></pre>
<h1 id="c-程式進階作業系統與-thread"><a href="#c-程式進階作業系統與-thread">C# 程式進階：作業系統與 Thread</a></h1>
<p>很多資工系的學生都上過作業系統這門課，但是通常老師只有講理論，沒有說明如何實作，這讓很多同學都無法清楚的理解其中的概念。在本系列文章中，我們將使用 C# 語言來說明作業系統當中的一些關鍵概念，像是 Process (進程、行程、Task)、Thread (執行緒、線程)、Deadlock (死結)、Race Condition (競爭情況)、Semaphore (號誌、信號量) 等等。</p>
<h2 id="process-與-thread"><a href="#process-與-thread">Process 與 Thread</a></h2>
<p>Thread 在台灣被稱為『執行緒』，但是在中國被稱為『線程』，作業系統教科書中通常會定義 Process 為：執行中的程式。因此假如您開了一個 Word 檔案，那就是有一個 Word 行程在執行，如果您又開了個命令列，那就是又有一個命令列行程在執行，如果又開第二個命令列，那就有兩個命令列行程在執行。</p>
<p>Thread 在作業系統中通常被定義為輕量級行程 (Light Weight Process)，一個 Process 可以包含很多個 Thread，如下圖所示：</p>
<div class="figure">
<img src="../img/ProcessVsThread.jpg" alt="圖、Process 與 Thread 的關係" /><p class="caption">圖、Process 與 Thread 的關係</p>
</div>
<p>每個 Process 與 Thread 都會執行，而且執行到一半很可能就會因為進行輸出入或佔用 CPU 過久而被作業系統切換出去，改換另一個 Process 或 Thread 執行，這種概念稱為 Multitasking (多工)。</p>
<p>在 Windows 當中，我們可以按下 Ctrl-Alt-Del 鍵以顯示出系統的行程資訊，而在 Linux 中則可以用 ps (Process Status) 這個指令顯示行程資訊，以下是這兩個作業系統中的行程資訊範例。</p>
<div class="figure">
<img src="../img/ProcessScreenshot.jpg" alt="圖、Linux 與 Windows 中的 Process" /><p class="caption">圖、Linux 與 Windows 中的 Process</p>
</div>
<p>Thread 交替執行的這種慨念可以用下圖表示。(Proces 也是如此，只是將圖中的 Thread 改為 Process 而已)</p>
<div class="figure">
<img src="../img/FileMultithreadedProcess.jpg" alt="圖、Thread 的概念" /><p class="caption">圖、Thread 的概念</p>
</div>
<h2 id="c-中的-thread-概念"><a href="#c-中的-thread-概念">C# 中的 Thread 概念</a></h2>
<p>在現代的作業系統當中，如果我們將一個程式重複執行兩次，將會產生兩個 Process ，那麼這兩個程式將是毫不相關的。任何一個程式都不需要知道另一個程式是否存在，通常也不會與另一個程式進行溝通。</p>
<p>但是，如果我們希望兩個程式能夠互相分享某些變數，但是卻又同時執行，此時就可以利用 Thread 的機制。對於程式設計師而言，Thread 就像一個可以單獨執行的函數，這個函數與其他程式 (包含主程式) 同時執行，感覺上好像互相獨立，但是又可以共用某些變數。以下是一個 C# 的 Thread 範例：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Threading</span>;

<span class="kw">class</span> SimpleThread
{
    String name;

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        SimpleThread a = <span class="kw">new</span> <span class="fu">SimpleThread</span>(<span class="st">&quot;A&quot;</span>);
        SimpleThread b = <span class="kw">new</span> <span class="fu">SimpleThread</span>(<span class="st">&quot;B&quot;</span>);
        Thread athread = <span class="kw">new</span> <span class="fu">Thread</span>(a.<span class="fu">run</span>);
        Thread bthread = <span class="kw">new</span> <span class="fu">Thread</span>(b.<span class="fu">run</span>);
        athread.<span class="fu">Start</span>();
        bthread.<span class="fu">Start</span>();
        athread.<span class="fu">Join</span>();
        bthread.<span class="fu">Join</span>();
    }

    <span class="fu">SimpleThread</span>(String pName)
    {
        name = pName;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>()
    {
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; i++)
        {
            String line = name + <span class="st">&quot;:&quot;</span> + i;
            Console.<span class="fu">WriteLine</span>(line);
            <span class="co">// Thread.Sleep(10);</span>
        }
    }
}</code></pre>
<p>其執行結果如下圖所示：</p>
<div class="figure">
<img src="../img/CSharpThreadRun1.jpg" alt="圖、Thread 的執行結果 -- 沒有 Sleep 的情況" /><p class="caption">圖、Thread 的執行結果 -- 沒有 Sleep 的情況</p>
</div>
<p>對於剛開始接觸 Thread 的程式人員而言，會感覺到相當的詭異。因為『兩個 Thread 同時執行』是一個相當難以理解的概念。事實上，對於只有一個 CPU 的程式而言，並非兩個程式真的會「同時」執行，而只不過是「交錯」執行而已。但是這個交錯方式是由作業系統決定的，而非由程式設計師自行安排。而對於多 CPU 或多核心的處理器而言，就真的會「同時」執行，而不是只有「交錯」執行而已。</p>
<p>通常，程式人員對於這種不能由自己操控決定的情況會有不安的感覺，但是當您多寫幾個程式之後，這種疑慮就會消除了，畢竟，程式人員本來就相當依賴作業系統，只是自己通常感覺不到而已。</p>
<p>當然，如果我們想要稍微控制一下 Thread 的執行順序，那麼就可以要求目前的 Thread 去休息睡覺，像是上述程式中的 Thread.Sleep(10) 這行程是本來是被註解掉的，但是如果我們將這行程式的註解拿掉，那麼將得到下列執行結果。</p>
<div class="figure">
<img src="../img/CSharpThreadRun2.jpg" alt="圖、Thread 的執行結果 2 -- 有 Sleep 的情況" /><p class="caption">圖、Thread 的執行結果 2 -- 有 Sleep 的情況</p>
</div>
<p>從上面兩個圖中，您可以看到還沒加入 Thread.Sleep(10) 之前，兩個 Thread 的交錯方是很隨興，基本上是由作業系統任意安排的，但是在加入 Thread.Sleep(10) 之後，因為兩個 Thread 在印一次後就會禮讓給對方，所以就成了嚴格交互的 A, B, A, B .... 之情形了。</p>
<h2 id="以-c-體驗死結-deadlock"><a href="#以-c-體驗死結-deadlock">以 C# 體驗死結 (Deadlock)</a></h2>
<p>在作業系統的課程當中我們會學到『死結』這個問題，當程式 1 抓住資源 A，卻又在等程式 2 釋放資源 B，而程式 2 則抓住資源 B ，卻又在等程式 1 釋放資源 A 的時候，就會進入死結狀態。這就像兩台很長的火車，互相卡住對方一般，下圖顯示了死結情況的示意圖。</p>
<div class="figure">
<img src="../img/Deadlock.jpg" alt="圖、死結的示意圖" /><p class="caption">圖、死結的示意圖</p>
</div>
<p>在程式設計中我們真的會遇到死結嗎？如果真的有死結，能否寫一個會造成死結的程式呢？</p>
<p>這並不難，只要用執行緒 (Thread) 與鎖定 (lock) 機制，我們很容易就可以造出會導致死結的程式，以下是我們用 C# 撰寫的一段死結程式，請參考。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">class</span> ThreadTest
{
    <span class="kw">static</span> String A = <span class="st">&quot;A&quot;</span>;
    <span class="kw">static</span> String B = <span class="st">&quot;B&quot;</span>;

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        Thread thread1 = <span class="kw">new</span> <span class="fu">Thread</span>(AB);
        Thread thread2 = <span class="kw">new</span> <span class="fu">Thread</span>(BA);
        thread1.<span class="fu">Start</span>();
        thread2.<span class="fu">Start</span>();
        thread1.<span class="fu">Join</span>();
        thread2.<span class="fu">Join</span>();
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">AB</span>()
    {
        <span class="kw">lock</span> (A)
        {
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;AB.lock(A)&quot;</span>);
            Thread.<span class="fu">Sleep</span>(<span class="dv">1000</span>);
            <span class="kw">lock</span> (B)
            {
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;AB.lock(B)&quot;</span>);
            }
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">BA</span>()
    {
        <span class="kw">lock</span> (B)
        {
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;BA.lock(B)&quot;</span>);
            Thread.<span class="fu">Sleep</span>(<span class="dv">1000</span>);
            <span class="kw">lock</span> (A)
            {
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;BA.lock(A)&quot;</span>);
            }
        }
    }
}</code></pre>
<p>上述程式的執行結果如下圖所示，當程式跑到 BA.lock(B) 之後就進入了死結，再也無法跑下去了，因此我們不會看到 BA.lock(A) 與 AB.lock(B) 這兩行輸出的結果，程式已經進入了死結狀態，再也出不來了。</p>
<div class="figure">
<img src="../img/CSharpDeadlockRun1.jpg" alt="圖、Deadlock.cs 程式的執行結果" /><p class="caption">圖、Deadlock.cs 程式的執行結果</p>
</div>
<h2 id="競爭情況-race-condition"><a href="#競爭情況-race-condition">競爭情況 (Race Condition)</a></h2>
<p>至此，我們已經用 C# 實作了作業系統中的 Thread 與 Deadlock 這兩種慨念，但事實上、這兩個概念之間是有關係的，要理解 Thread 與死結之間的關係，就必須從 Race Condition (競爭情況) 這個問題談起。</p>
<p>在多 Thread (或多 CPU) 的情況之下，兩個 thread 可以共用某些變數，但是共用變數可能造成一個嚴重的問題，那就是當兩個 thread 同時修改一個變數時，這種修改會造成變數的值可能錯誤的情況，以下是一個範例。</p>
<table>
<thead>
<tr class="header">
<th align="left">Thread 1</th>
<th align="left">Thread 2</th>
<th align="left">Thread1+2 (第 1 種情況)</th>
<th align="left">Thread1+2 (第 2 種情況)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">counter = 0</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">...</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">R1 = counter</td>
<td align="left">R1 = counter</td>
<td align="left">T1:R1 = counter</td>
<td align="left">T1:R1 = counter</td>
</tr>
<tr class="even">
<td align="left">R1 = R1 + 1</td>
<td align="left">R1 = R1 - 1</td>
<td align="left">T2:R1 = counter</td>
<td align="left">T1:R1 = R1+1</td>
</tr>
<tr class="odd">
<td align="left">counter = R1</td>
<td align="left">counter = R1</td>
<td align="left">T2:R1 = R1-1</td>
<td align="left">T2:R1 = counter</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left">T2:counter=R1</td>
<td align="left">T2:R1 = R1-1</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left">T1:R1 = R1+1</td>
<td align="left">T2:counter = R1</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left">T1:counter = R1</td>
<td align="left">T1:counter = R1</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left">...</td>
<td align="left">...</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left">執行結果 : counter = 0</td>
<td align="left">執行結果 : counter = -1</td>
</tr>
</tbody>
</table>
<p>這種情況並非只在多 CPU 的系統裡會發生，在單 CPU 的多線程系統裡也會發生，因為一個高階語言指令在翻譯成機器碼時，通常會變成很多個指令，這讓修改的動作無法在單一指令內完成，如果這些修改動作執行到一半的時候，線程被切換了，就會造成上述的競爭情況。</p>
<table>
<thead>
<tr class="header">
<th align="left">高階語言</th>
<th align="left">組合語言</th>
<th align="left">對應動作</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">counter ++</td>
<td align="left">LD R1, counter</td>
<td align="left">R1 = counter</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ADD R1, R1, 1</td>
<td align="left">R1 = R1 + 1</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">ST R1, counter</td>
<td align="left">counter = R1</td>
</tr>
</tbody>
</table>
<p>這種競爭情況對程式設計者而言是無法接受的，如果程式的執行結果無法確保，那所有的程式都將陷入一團混亂，連 counter++ 這樣的動作都有問題的話，那任何多線程的程式都將無法正確運作。</p>
<p>為了避免這樣的問題產生，一個可能的解決方法是採用鎖定 (lock) 的方式，當我們執行共用變數的修改時，先進行鎖定，讓其他的線程無法同時修改該變數，等到修改完畢後解索後，其他的線程才能修改該變數，這樣就能避免掉競爭情況的問題了。</p>
<p>但是、一但我們能夠進行鎖定的動作，那就可能會造成上述的死結情況，這也正是 Thread 與死結之間的關係，讓我們用一句話總結如下：</p>
<pre><code>因為多線程的程式會有競爭情況，為了避免該情況而引入了鎖定機制，
但是鎖定機制用得不好就會造成死結。</code></pre>
<p>讓我們先用程式來驗證競爭情況的存在，以下是一個 C# 的競爭情況範例 (當然這種競爭情況是我們刻意造成的)。</p>
<p>檔案：RaceConditon.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;

<span class="kw">class</span> RaceCondition
{
    <span class="kw">static</span> <span class="dt">int</span> counter = <span class="dv">0</span>, R1 = <span class="dv">0</span>;
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Thread thread1 = <span class="kw">new</span> <span class="fu">Thread</span>(inc);
        Thread thread2 = <span class="kw">new</span> <span class="fu">Thread</span>(dec);
        thread1.<span class="fu">Start</span>();
        thread2.<span class="fu">Start</span>();
        thread1.<span class="fu">Join</span>();
        thread2.<span class="fu">Join</span>();
    }

    <span class="kw">static</span> Random random = <span class="kw">new</span> <span class="fu">Random</span>();

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">waitAndSee</span>(String msg)
    {
        Thread.<span class="fu">Sleep</span>(random.<span class="fu">Next</span>(<span class="dv">0</span>, <span class="dv">10</span>));
        Console.<span class="fu">WriteLine</span>(msg+<span class="st">&quot;     R1:&quot;</span>+R1+<span class="st">&quot; counter:&quot;</span>+counter);
    }

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">inc</span>()
    {
        R1 = counter;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:R1 = counter&quot;</span>);
        R1 = R1 + <span class="dv">1</span>;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:R1 = R1 + 1 &quot;</span>);
        counter = R1;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:counter = R1&quot;</span>);
    }

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">dec</span>()
    {
        R1 = counter;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:R1 = counter&quot;</span>);
        R1 = R1 - <span class="dv">1</span>;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:R1 = R1 - 1 &quot;</span>);
        counter = R1;
        <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:counter = R1&quot;</span>);
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\Dropbox\Public\cs\code&gt;RaceCondition
inc:R1 = counter     R1:0 counter:0
dec:R1 = counter     R1:0 counter:0
inc:R1 = R1 + 1      R1:0 counter:0
inc:counter = R1     R1:0 counter:0
dec:R1 = R1 - 1      R1:0 counter:0
dec:counter = R1     R1:0 counter:0

D:\Dropbox\Public\cs\code&gt;RaceCondition
inc:R1 = counter     R1:0 counter:0
inc:R1 = R1 + 1      R1:0 counter:0
dec:R1 = counter     R1:0 counter:0
inc:counter = R1     R1:-1 counter:0
dec:R1 = R1 - 1      R1:-1 counter:0
dec:counter = R1     R1:-1 counter:-1</code></pre>
<p>要解決以上的競爭情況，必須採用一些協調 (Cooperation) 方法，C# 當中所提供的主要協調方法是 lock 這個語句。簡單來說，C# 的 lock 的實作方式就是採用作業系統教科書中所說的 Monitor 之方法，只是在 lock 的開始加入 Monitor.Enter() 語句，然後在 lock 的結束加入 Monitor.Exit() 語句而已，其方法如下所示。</p>
<table>
<thead>
<tr class="header">
<th align="left">C# lock</th>
<th align="left">Monitor 語句</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">lock (_locker) {</td>
<td align="left">Monitor.Enter(_locker);</td>
</tr>
<tr class="even">
<td align="left">...</td>
<td align="left">...</td>
</tr>
<tr class="odd">
<td align="left">critical();</td>
<td align="left">critical();</td>
</tr>
<tr class="even">
<td align="left">...</td>
<td align="left">...</td>
</tr>
<tr class="odd">
<td align="left">}</td>
<td align="left">Monitor.Exit(_locker);</td>
</tr>
</tbody>
</table>
<p>使用 lock 的方式，我們可以很輕易的解決上述程式的競爭情況，以下是該程式加入 lock 機制後的程式碼與執行結果。</p>
<p>檔案：RaceConditonLock.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;

<span class="kw">class</span> RaceConditionLock
{
    <span class="kw">static</span> <span class="dt">int</span> counter = <span class="dv">0</span>, R1 = <span class="dv">0</span>;
    <span class="kw">static</span> String counterLocker = <span class="st">&quot;counterLocker&quot;</span>;
    
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Thread thread1 = <span class="kw">new</span> <span class="fu">Thread</span>(inc);
        Thread thread2 = <span class="kw">new</span> <span class="fu">Thread</span>(dec);
        thread1.<span class="fu">Start</span>();
        thread2.<span class="fu">Start</span>();
        thread1.<span class="fu">Join</span>();
        thread2.<span class="fu">Join</span>();
    }

    <span class="kw">static</span> Random random = <span class="kw">new</span> <span class="fu">Random</span>();

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">waitAndSee</span>(String msg)
    {
        Thread.<span class="fu">Sleep</span>(random.<span class="fu">Next</span>(<span class="dv">0</span>, <span class="dv">10</span>));
        Console.<span class="fu">WriteLine</span>(msg+<span class="st">&quot;     R1:&quot;</span>+R1+<span class="st">&quot; counter:&quot;</span>+counter);
    }

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">inc</span>()
    {
        <span class="kw">lock</span> (counterLocker) {
            R1 = counter;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:R1 = counter&quot;</span>);
            R1 = R1 + <span class="dv">1</span>;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:R1 = R1 + 1 &quot;</span>);
            counter = R1;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;inc:counter = R1&quot;</span>);
        }
    }

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">dec</span>()
    {
        <span class="kw">lock</span> (counterLocker) {
            R1 = counter;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:R1 = counter&quot;</span>);
            R1 = R1 - <span class="dv">1</span>;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:R1 = R1 - 1 &quot;</span>);
            counter = R1;
            <span class="fu">waitAndSee</span>(<span class="st">&quot;dec:counter = R1&quot;</span>);
        }
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\Dropbox\Public\cs\code&gt;csc RaceConditionLock.cs
適用於 Microsoft (R) .NET Framework 4.5 的
Microsoft (R) Visual C# 編譯器版本 4.0.30319.17929
Copyright (C) Microsoft Corporation. 著作權所有，並保留一切權利。


D:\Dropbox\Public\cs\code&gt;RaceConditionLock
inc:R1 = counter     R1:0 counter:0
inc:R1 = R1 + 1      R1:1 counter:0
inc:counter = R1     R1:1 counter:1
dec:R1 = counter     R1:1 counter:1
dec:R1 = R1 - 1      R1:0 counter:1
dec:counter = R1     R1:0 counter:0

D:\Dropbox\Public\cs\code&gt;RaceConditionLock
inc:R1 = counter     R1:0 counter:0
inc:R1 = R1 + 1      R1:1 counter:0
inc:counter = R1     R1:1 counter:1
dec:R1 = counter     R1:1 counter:1
dec:R1 = R1 - 1      R1:0 counter:1
dec:counter = R1     R1:0 counter:0

D:\Dropbox\Public\cs\code&gt;RaceConditionLock
inc:R1 = counter     R1:0 counter:0
inc:R1 = R1 + 1      R1:1 counter:0
inc:counter = R1     R1:1 counter:1
dec:R1 = counter     R1:1 counter:1
dec:R1 = R1 - 1      R1:0 counter:1
dec:counter = R1     R1:0 counter:0</code></pre>
<h2 id="號誌-semaphore-與生產者消費者問題"><a href="#號誌-semaphore-與生產者消費者問題">號誌 (Semaphore) 與生產者/消費者問題</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;

<span class="kw">class</span> ProducerConsumer
{
    <span class="kw">static</span> <span class="kw">readonly</span> <span class="dt">int</span> BUFFER_SIZE = <span class="dv">4</span>;
    <span class="kw">static</span> Queue&lt;<span class="dt">int</span>&gt; circularBuffer = <span class="kw">new</span> Queue&lt;<span class="dt">int</span>&gt;(BUFFER_SIZE);
    <span class="kw">static</span> Semaphore semaFilledSlots = <span class="kw">new</span> <span class="fu">Semaphore</span>(<span class="dv">0</span>, BUFFER_SIZE);
    <span class="kw">static</span> Semaphore semaUnfilledSlots = <span class="kw">new</span> <span class="fu">Semaphore</span>(BUFFER_SIZE, BUFFER_SIZE);
    <span class="kw">static</span> Mutex mutex = <span class="kw">new</span> <span class="fu">Mutex</span>(<span class="kw">false</span>);

    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        Thread producer = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(produce));
        Thread consumer = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(consume));
        producer.<span class="fu">Start</span>();
        consumer.<span class="fu">Start</span>();
        producer.<span class="fu">Join</span>();
        consumer.<span class="fu">Join</span>();
    }

    <span class="kw">static</span> Random random = <span class="kw">new</span> <span class="fu">Random</span>();

    <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">produce</span>()
    {
        <span class="kw">while</span> (<span class="kw">true</span>)
        {
            Thread.<span class="fu">Sleep</span>(random.<span class="fu">Next</span>(<span class="dv">0</span>, <span class="dv">500</span>));
            <span class="dt">int</span> produceNumber = random.<span class="fu">Next</span>(<span class="dv">0</span>, <span class="dv">20</span>);
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Produce: {0}&quot;</span>, produceNumber);

            semaUnfilledSlots.<span class="fu">WaitOne</span>();    <span class="co">// wait(semaUnfilledSlots)</span>
            mutex.<span class="fu">WaitOne</span>();                <span class="co">// wait(mutex)</span>
            
            queue.<span class="fu">Enqueue</span>(produceNumber);

            mutex.<span class="fu">ReleaseMutex</span>();           <span class="co">// signal(mutex)</span>
            semaFilledSlots.<span class="fu">Release</span>();      <span class="co">// signal(semaFilledSlots)</span>

            <span class="kw">if</span> (produceNumber == <span class="dv">0</span>)
                <span class="kw">break</span>;
        }
    }

    <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">consume</span>()
    {
        <span class="kw">while</span> (<span class="kw">true</span>)
        {
            semaFilledSlots.<span class="fu">WaitOne</span>();      <span class="co">// wait(semaFilledSlots)</span>
            mutex.<span class="fu">WaitOne</span>();                <span class="co">// wait(mutex)</span>
            <span class="dt">int</span> number = circularBuffer.<span class="fu">Dequeue</span>();
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Consume: {0}&quot;</span>, number);

            mutex.<span class="fu">ReleaseMutex</span>();           <span class="co">// signal(mutex)</span>
            semaUnfilledSlots.<span class="fu">Release</span>();    <span class="co">// signal(semaUnfilledSlots)</span>
            <span class="kw">if</span> (number == <span class="dv">0</span>)
                <span class="kw">break</span>;
            Thread.<span class="fu">Sleep</span>(random.<span class="fu">Next</span>(<span class="dv">0</span>, <span class="dv">1000</span>));
        }
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\Dropbox\Public\cs\code&gt;csc ProducerConsumer.cs
適用於 Microsoft (R) .NET Framework 4.5 的
Microsoft (R) Visual C# 編譯器版本 4.0.30319.17929
Copyright (C) Microsoft Corporation. 著作權所有，並保留一切權利。


D:\Dropbox\Public\cs\code&gt;ProducerConsumer
Produce: 9
Consume: 9
Produce: 8
Consume: 8
Produce: 2
Consume: 2
Produce: 6
Produce: 0
Consume: 6
Consume: 0</code></pre>
<p>另外、在作業系統中有個多行程的經典問題稱為 Dining Philospher (哲學家用餐) 問題，也可以採用 lock 的方法解決，由於這個問題實務上比較不那麼常用，本文中就不再詳細探討此一問題，有興趣的朋友可以看看網路上的解決方法，像是以下這篇 java2s 當中的程式就用 C# 實作解決了此一問題。</p>
<ul>
<li><a href="http://www.java2s.com/Tutorial/CSharp/0420__Thread/DiningPhilosopher.htm">http://www.java2s.com/Tutorial/CSharp/0420__Thread/DiningPhilosopher.htm</a></li>
</ul>
<p>在本章中，我們購過透過實作的方式，讓讀者感受作業系統當中的 Thread、Deadlock、Race Condition、與 Semaphore 等概念，希望這樣的說明方式對讀者會有所幫助。</p>
<h2 id="參考文獻-4"><a href="#參考文獻-4">參考文獻</a></h2>
<ul>
<li>Threading in C#, Joseph Albahari (超讚！)
<ul>
<li><a href="http://www.albahari.com/threading/">http://www.albahari.com/threading/</a></li>
</ul></li>
</ul>
<h1 id="c-視窗程式簡介"><a href="#c-視窗程式簡介">C# 視窗程式：簡介</a></h1>
<h2 id="視窗與-c-程式"><a href="#視窗與-c-程式">視窗與 C# 程式</a></h2>
<p>本書所採用的視窗技術，是較舊型的 Windows Forms 技術，而非新型的 WPF 技術，雖然這種技術較為傳統，但是卻比較容易學習，對初學者而言是比較好上手的。</p>
<p>要學習 C# 的視窗程式設計，只看程式碼往往是不夠的，因為程式碼沒有辦法傳達有關視覺化介面設計過程的實況訊息。因此、最好搭配教學影片同時學習。筆者在金門大學上課的時候，幾乎都有用 CamStudio 將上課過程進行螢幕錄影，讀者可以一邊觀看這些上課錄影，一邊參考本書的程式碼進行學習，以下是這些錄影在 YouTube 上的網址。</p>
<table>
<thead>
<tr class="header">
<th align="left">主題</th>
<th align="left">教學影片</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">C# 視窗程式設計簡介 1</td>
<td align="left"><a href="http://youtu.be/MtCx-T71_bg">http://youtu.be/MtCx-T71_bg</a></td>
</tr>
<tr class="even">
<td align="left">C# 視窗程式設計簡介 2</td>
<td align="left"><a href="http://youtu.be/_9rEEWE3lXQ">http://youtu.be/_9rEEWE3lXQ</a></td>
</tr>
<tr class="odd">
<td align="left">C# 視窗控制項巡禮</td>
<td align="left"><a href="http://youtu.be/e5366D_ngAA">http://youtu.be/e5366D_ngAA</a></td>
</tr>
<tr class="even">
<td align="left">C# 文字型計算機</td>
<td align="left"><a href="http://youtu.be/A1KVnrfVF7k">http://youtu.be/A1KVnrfVF7k</a></td>
</tr>
<tr class="odd">
<td align="left">C# 實作字典查詢程式</td>
<td align="left"><a href="http://youtu.be/yS3G-H_hrFU">http://youtu.be/yS3G-H_hrFU</a></td>
</tr>
<tr class="even">
<td align="left">C# Array 與 List 物件的使用</td>
<td align="left"><a href="http://youtu.be/EHSGtKpRprI">http://youtu.be/EHSGtKpRprI</a></td>
</tr>
<tr class="odd">
<td align="left">C# HashTable 與 Dictionary 物件的使用</td>
<td align="left"><a href="http://youtu.be/hYH-npRmmKM">http://youtu.be/hYH-npRmmKM</a></td>
</tr>
<tr class="even">
<td align="left">C# 將小字典擴充為小翻譯系統</td>
<td align="left"><a href="http://youtu.be/_sFsTo41PXs">http://youtu.be/_sFsTo41PXs</a></td>
</tr>
<tr class="odd">
<td align="left">C# Timer 與碼錶</td>
<td align="left"><a href="http://youtu.be/UA0rizekLow">http://youtu.be/UA0rizekLow</a></td>
</tr>
<tr class="even">
<td align="left">C# Timer 與小時鐘</td>
<td align="left"><a href="http://youtu.be/NJ6B5-vO_88">http://youtu.be/NJ6B5-vO_88</a></td>
</tr>
<tr class="odd">
<td align="left">C# Timer 與移動球</td>
<td align="left"><a href="http://youtu.be/6Gs4MPzt6q4">http://youtu.be/6Gs4MPzt6q4</a></td>
</tr>
<tr class="even">
<td align="left">C# 檔案處理</td>
<td align="left"><a href="http://youtu.be/3EyPcAddd70">http://youtu.be/3EyPcAddd70</a></td>
</tr>
<tr class="odd">
<td align="left">C# 文字編輯器 1</td>
<td align="left"><a href="http://youtu.be/xymT54El53E">http://youtu.be/xymT54El53E</a></td>
</tr>
<tr class="even">
<td align="left">C# 文字編輯器 2</td>
<td align="left"><a href="http://youtu.be/xz5sKvZjLZI">http://youtu.be/xz5sKvZjLZI</a></td>
</tr>
<tr class="odd">
<td align="left">C# 畫圖功能示範</td>
<td align="left"><a href="http://youtu.be/8aAql8R4WSg">http://youtu.be/8aAql8R4WSg</a></td>
</tr>
<tr class="even">
<td align="left">C# 小畫板 (2)</td>
<td align="left"><a href="http://youtu.be/HkOkWRQ_Ad4">http://youtu.be/HkOkWRQ_Ad4</a></td>
</tr>
<tr class="odd">
<td align="left">C# 小畫板 (3)</td>
<td align="left"><a href="http://youtu.be/VXaQu_yYu08">http://youtu.be/VXaQu_yYu08</a></td>
</tr>
<tr class="even">
<td align="left">C# 瀏覽器控制 1/3</td>
<td align="left"><a href="http://youtu.be/CIwYabPN7qA">http://youtu.be/CIwYabPN7qA</a></td>
</tr>
<tr class="odd">
<td align="left">C# 瀏覽器控制 2/3</td>
<td align="left"><a href="http://youtu.be/sJ6cfuL3-ZA">http://youtu.be/sJ6cfuL3-ZA</a></td>
</tr>
<tr class="even">
<td align="left">C# 瀏覽器控制 3/3</td>
<td align="left"><a href="http://youtu.be/YThlDxk-E7U">http://youtu.be/YThlDxk-E7U</a></td>
</tr>
<tr class="odd">
<td align="left">C# DataGridView 元件的使用</td>
<td align="left"><a href="http://youtu.be/XzsZRqLAi30">http://youtu.be/XzsZRqLAi30</a></td>
</tr>
<tr class="even">
<td align="left">C# 製作賣紅茶的 POS 系統</td>
<td align="left"><a href="http://youtu.be/XX0wHhvkkiE">http://youtu.be/XX0wHhvkkiE</a></td>
</tr>
</tbody>
</table>
<p>讀者可以先看「C# 視窗程式設計簡介1, 2 與 C# 視窗控制項巡禮」等三部影片，並且操作一次，有了基本概念之後，就可以繼續下看下列的內容了。</p>
<h2 id="按鈕測試"><a href="#按鈕測試">按鈕測試</a></h2>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/ButtonTest.zip">https://dl.dropbox.com/u/101584453/cs/code/ButtonTest.zip</a></p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> ButtonTest
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">button1_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            label1.<span class="fu">Text</span> = <span class="st">&quot;你好！&quot;</span>;
            textBox1.<span class="fu">Text</span> = <span class="st">&quot;我很好！&quot;</span>;
        }
    }
}</code></pre>
<h2 id="文字型計算機"><a href="#文字型計算機">文字型計算機</a></h2>
<p>教學錄影：C# 文字型計算機 -- <a href="http://youtu.be/A1KVnrfVF7k">http://youtu.be/A1KVnrfVF7k</a> 專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/TextCalculator.zip">https://dl.dropbox.com/u/101584453/cs/code/TextCalculator.zip</a></p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> TextCalculator
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonEqual_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="kw">try</span>
            {
                <span class="dt">double</span> number1 = Double.<span class="fu">Parse</span>(textBoxNumber1.<span class="fu">Text</span>);
                <span class="dt">double</span> number2 = Double.<span class="fu">Parse</span>(textBoxNumber2.<span class="fu">Text</span>);
                <span class="dt">string</span> op = comboBoxOp.<span class="fu">Text</span>;
                <span class="dt">double</span> result = <span class="fl">0.0</span>;
                <span class="co">// MessageBox.Show(number1 + op + number2 + &quot;=&quot;);</span>
                <span class="kw">switch</span> (op)
                {
                    <span class="kw">case</span> <span class="st">&quot;+&quot;</span>: result = number1 + number2; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;-&quot;</span>: result = number1 - number2; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;*&quot;</span>: result = number1 * number2; <span class="kw">break</span>;
                    <span class="kw">case</span> <span class="st">&quot;/&quot;</span>: result = number1 / number2; <span class="kw">break</span>;
                    <span class="kw">default</span>: <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>(<span class="st">&quot;op=&quot;</span> + op + <span class="st">&quot;:Error!&quot;</span>);
                }
                textBoxResult.<span class="fu">Text</span> = result.<span class="fu">ToString</span>();
            }
            <span class="kw">catch</span> (Exception exception)
            {
                MessageBox.<span class="fu">Show</span>(exception.<span class="fu">ToString</span>());
            }
        }
    }
}</code></pre>
<h2 id="小字典"><a href="#小字典">小字典</a></h2>
<p>教學錄影：</p>
<ul>
<li>C# 實作字典查詢程式 -- <a href="http://youtu.be/yS3G-H_hrFU">http://youtu.be/yS3G-H_hrFU</a></li>
<li>C# Array 與 List 物件的使用 -- <a href="http://youtu.be/EHSGtKpRprI">http://youtu.be/EHSGtKpRprI</a></li>
<li>C# HashTable 與 Dictionary 物件的使用 -- <a href="http://youtu.be/hYH-npRmmKM">http://youtu.be/hYH-npRmmKM</a></li>
<li>C# 將小字典擴充為小翻譯系統 -- <a href="http://youtu.be/_sFsTo41PXs">http://youtu.be/_sFsTo41PXs</a></li>
</ul>
<p>專案下載： <a href="https://dl.dropbox.com/u/101584453/cs/code/WinDictionary.zip">https://dl.dropbox.com/u/101584453/cs/code/WinDictionary.zip</a></p>
<p>執行畫面：</p>
<div class="figure">
<img src="../img/DictionaryRun.png" alt="小字典執行畫面" /><p class="caption">小字典執行畫面</p>
</div>
<p>介面設計</p>
<div class="figure">
<img src="../img/DictionaryDesign.png" alt="小字典介面設計" /><p class="caption">小字典介面設計</p>
</div>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> WindowsFormsApplication1
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> FormDictionary : Form
    {
        Dictionary&lt;String, String&gt; dict = <span class="kw">new</span> Dictionary&lt;<span class="dt">string</span>, <span class="dt">string</span>&gt;();

        <span class="kw">public</span> <span class="fu">FormDictionary</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonQuery_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="kw">try</span>
            {
                String eword = comboBoxQuery.<span class="fu">Text</span>;
                String cword = dict[eword];
                richTextBox.<span class="fu">Text</span> = cword;
            }
            <span class="kw">catch</span>
            {
                MessageBox.<span class="fu">Show</span>(<span class="st">&quot;輸入錯誤，查不到！&quot;</span>);
            }
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">FormDictionary_Load</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            String[] eWords = <span class="kw">new</span> String[] { <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;eat&quot;</span>, <span class="st">&quot;chase&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;a&quot;</span>,    <span class="st">&quot;the&quot;</span> };
            String[] cWords = <span class="kw">new</span> String[] { <span class="st">&quot;狗&quot;</span>,  <span class="st">&quot;貓&quot;</span>,  <span class="st">&quot;吃&quot;</span>,  <span class="st">&quot;追&quot;</span>,     <span class="st">&quot;跑&quot;</span>,  <span class="st">&quot;一隻&quot;</span>, <span class="st">&quot;這隻&quot;</span> };
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; eWords.<span class="fu">Length</span>; i++)
            {
                dict.<span class="fu">Add</span>(eWords[i], cWords[i]);
            }
        }
    }
}</code></pre>
<h1 id="c-視窗程式時間驅動"><a href="#c-視窗程式時間驅動">C# 視窗程式：時間驅動</a></h1>
<h2 id="碼表"><a href="#碼表">碼表</a></h2>
<p>教學錄影：C# Timer 與碼錶 -- <a href="http://youtu.be/UA0rizekLow">http://youtu.be/UA0rizekLow</a></p>
<p>專案下載：</p>
<ul>
<li><a href="https://dl.dropbox.com/u/101584453/cs/code/TimerDemo.zip">https://dl.dropbox.com/u/101584453/cs/code/TimerDemo.zip</a></li>
<li><a href="https://dl.dropbox.com/u/101584453/cs/code/TimerClock.zip">https://dl.dropbox.com/u/101584453/cs/code/TimerClock.zip</a></li>
</ul>
<div class="figure">
<img src="../img/TimerCounter.png" alt="碼表畫面" /><p class="caption">碼表畫面</p>
</div>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> WindowsFormsApplication1
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="dt">int</span> counter = <span class="dv">0</span>;

        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">timer_Tick</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            counter++;
            labelTimer.<span class="fu">Text</span> = <span class="st">&quot;&quot;</span>+counter;
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonStart_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            timer.<span class="fu">Enabled</span> = <span class="kw">true</span>;
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonStop_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            timer.<span class="fu">Enabled</span> = <span class="kw">false</span>;
        }
    }
}</code></pre>
<h2 id="小時鐘"><a href="#小時鐘">小時鐘</a></h2>
<p>教學錄影：C# Timer 與小時鐘 -- <a href="http://youtu.be/NJ6B5-vO_88">http://youtu.be/NJ6B5-vO_88</a></p>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/Clock.zip">https://dl.dropbox.com/u/101584453/cs/code/Clock.zip</a></p>
<p>執行畫面：</p>
<div class="figure">
<img src="../img/ClockRun.png" alt="小時鐘" /><p class="caption">小時鐘</p>
</div>
<p>介面設計</p>
<p>請從工具箱中拉出一個 label 與一個 Timer，如下圖所示。</p>
<div class="figure">
<img src="../img/ClockDesign.png" alt="小時鐘介面設計" /><p class="caption">小時鐘介面設計</p>
</div>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> TimerDemo
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
            <span class="fu">timer1_Tick</span>(<span class="kw">this</span>, <span class="kw">null</span>);
            timer1.<span class="fu">Interval</span> = <span class="dv">1000</span>; <span class="co">// 設定每秒觸發一次</span>
            timer1.<span class="fu">Enabled</span> = <span class="kw">true</span>; <span class="co">// 啟動 Timer</span>
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">timer1_Tick</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            DateTime time = DateTime.<span class="fu">Now</span>;
<span class="co">//            label1.Text = time.TimeOfDay.ToString();</span>
<span class="co">//            label1.Text = time.Hour + &quot;:&quot; + time.Minute + &quot;:&quot; + time.Second;</span>
            label1.<span class="fu">Text</span> = String.<span class="fu">Format</span>(<span class="st">&quot;{0:00}:{1:00}:{2:00}&quot;</span>, 
                                                   time.<span class="fu">Hour</span>, time.<span class="fu">Minute</span>, time.<span class="fu">Second</span>);
        }
    }
}</code></pre>
<h2 id="用-timer-控制動畫"><a href="#用-timer-控制動畫">用 Timer 控制動畫</a></h2>
<p>教學錄影：C# Timer 與移動球 -- <a href="http://youtu.be/6Gs4MPzt6q4">http://youtu.be/6Gs4MPzt6q4</a></p>
<h1 id="c-視窗程式設計文字編輯器"><a href="#c-視窗程式設計文字編輯器">C# 視窗程式：設計文字編輯器</a></h1>
<p>教學錄影：</p>
<ul>
<li>C# 檔案處理 -- <a href="http://youtu.be/3EyPcAddd70">http://youtu.be/3EyPcAddd70</a></li>
<li>C# 文字編輯器 1 -- <a href="http://youtu.be/xymT54El53E">http://youtu.be/xymT54El53E</a></li>
<li>C# 文字編輯器 2 -- <a href="http://youtu.be/xz5sKvZjLZI">http://youtu.be/xz5sKvZjLZI</a></li>
</ul>
<p>專案下載：</p>
<ul>
<li>只有介面的版本 (英文) -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Editor1.zip">https://dl.dropbox.com/u/101584453/cs/code/Editor1.zip</a></li>
<li>只有介面的版本 (中文) -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Editor2.zip">https://dl.dropbox.com/u/101584453/cs/code/Editor2.zip</a></li>
<li>完整版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/TextEditor2012.zip">https://dl.dropbox.com/u/101584453/cs/code/TextEditor2012.zip</a></li>
</ul>
<p>執行結果</p>
<div class="figure">
<img src="../img/TextEditorRun.jpg" alt="文字編輯器執行畫面" /><p class="caption">文字編輯器執行畫面</p>
</div>
<p>程式碼</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">namespace</span> WindowsFormsApplication1
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> FormEditor : Form
    {
        String filePath = <span class="kw">null</span>;

        <span class="kw">public</span> <span class="fu">FormEditor</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">fileToText</span>(String filePath)
        {
            StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(filePath);
            String text = file.<span class="fu">ReadToEnd</span>();
            file.<span class="fu">Close</span>();
            <span class="kw">return</span> text;
        }

        <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">textToFile</span>(String filePath, String text)
        {
            StreamWriter file = <span class="kw">new</span> <span class="fu">StreamWriter</span>(filePath);
            file.<span class="fu">Write</span>(text);
            file.<span class="fu">Close</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">openFileToolStripMenuItem_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="kw">if</span> (openFileDialog.<span class="fu">ShowDialog</span>() == DialogResult.<span class="fu">OK</span>)
            {
                String text = <span class="fu">fileToText</span>(openFileDialog.<span class="fu">FileName</span>);
                richTextBox.<span class="fu">Text</span> = text;
                filePath = openFileDialog.<span class="fu">FileName</span>;
            }
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">newFileToolStripMenuItem_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            richTextBox.<span class="fu">Text</span> = <span class="st">&quot;&quot;</span>;
            filePath = <span class="kw">null</span>;
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">saveFileToolStripMenuItem_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="kw">if</span> (filePath == <span class="kw">null</span>)
            {
                <span class="fu">dialogSaveFile</span>();
            }
            <span class="kw">else</span>
            {
                <span class="fu">textToFile</span>(filePath, richTextBox.<span class="fu">Text</span>);
            }
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">saveAsToolStripMenuItem_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="fu">dialogSaveFile</span>();
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">dialogSaveFile</span>()
        {
            <span class="kw">if</span> (saveFileDialog.<span class="fu">ShowDialog</span>() == DialogResult.<span class="fu">OK</span>)
            {
                <span class="fu">textToFile</span>(saveFileDialog.<span class="fu">FileName</span>, richTextBox.<span class="fu">Text</span>);
                filePath = saveFileDialog.<span class="fu">FileName</span>;
            }
        }

    }
}</code></pre>
<h1 id="c-視窗程式datagridview-與-listview-元件"><a href="#c-視窗程式datagridview-與-listview-元件">C# 視窗程式：DataGridView 與 ListView 元件</a></h1>
<h2 id="datagridview-的使用"><a href="#datagridview-的使用">DataGridView 的使用</a></h2>
<p>在微軟 .NET 的架構中，DataGridView 是一個強大而複雜的元件，我們欣賞其功能的強大，但也相當畏懼其複雜性，有時我們並不想將這個元件與資料庫綁在一起使用，但是卻不知道應該如何直接在元件中填入表格資料，以下是這個問題的一個簡單解法。</p>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/MenuGridView.zip">https://dl.dropbox.com/u/101584453/cs/code/MenuGridView.zip</a></p>
<p>設計：當您用 Visual Studio 拉出一個 DataGridView 物件 (假設稱為 dataGridViewMenu) 後，可以點選其屬性中的 Columns 欄位，然後用視覺化的方式加入兩個 Column，並設定好名稱為 name (品名), price (單價)，以下是筆者設定時的畫面。</p>
<div class="figure">
<img src="../img/MenuGridViewColumn.png" alt="DataGridView 的設計介面" /><p class="caption">DataGridView 的設計介面</p>
</div>
<p>授課錄影：C# DataGridView 元件的使用 -- <a href="http://youtu.be/XzsZRqLAi30">http://youtu.be/XzsZRqLAi30</a></p>
<h2 id="賣泡沫紅茶的系統-point-of-sale-pos"><a href="#賣泡沫紅茶的系統-point-of-sale-pos">賣泡沫紅茶的系統 (Point of Sale, POS)</a></h2>
<p>授課錄影：</p>
<ul>
<li>C# 製作賣紅茶的 POS 系統 -- <a href="http://youtu.be/XX0wHhvkkiE">http://youtu.be/XX0wHhvkkiE</a></li>
<li>設計飲料店點菜系統 (1/2: 介面設計) -- <a href="http://youtu.be/4NRzpSNLQ44">http://youtu.be/4NRzpSNLQ44</a></li>
<li>設計飲料店點菜系統 (2/2: 程式邏輯) -- <a href="http://youtu.be/KO6fENU5Yfo">http://youtu.be/KO6fENU5Yfo</a></li>
</ul>
<p>為了展示如何用 C# 設計一個小型的銷售點系統，我們設計了一個販賣飲料的 POS 軟體，可以讓販售者於電腦上點選飲料與數量，然後系統會自動計算總金額，這個程式可以用 ListView 或 DataGridView 元件進行設計，在上述的專案下載連結中，我們分別設計了這些專案，以下說明是我們使用 DataGridView 的設計方式的結果。</p>
<p>專案下載：</p>
<ul>
<li>簡易版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Menu1.zip">https://dl.dropbox.com/u/101584453/cs/code/Menu1.zip</a> (只有一樣商品：紅茶)</li>
<li>完整版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/Menu2.zip">https://dl.dropbox.com/u/101584453/cs/code/Menu2.zip</a> (使用 ListView)</li>
<li>豪華版 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/POS2012.zip">https://dl.dropbox.com/u/101584453/cs/code/POS2012.zip</a> (2012 年更新版，使用 DataGridView)</li>
</ul>
<div class="figure">
<img src="../img/MenuDesign.png" alt="賣泡沫紅茶的系統的畫面設計" /><p class="caption">賣泡沫紅茶的系統的畫面設計</p>
</div>
<p>程式碼</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> POS
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> FormMenu : Form
    {
        String name; <span class="co">// 品名</span>
        <span class="dt">double</span> price; <span class="co">// 單價</span>
        <span class="dt">double</span> number; <span class="co">// 數量</span>
        <span class="dt">double</span> subTotal; <span class="co">// 小計</span>

        <span class="kw">public</span> <span class="fu">FormMenu</span>()
        {
            <span class="fu">InitializeComponent</span>();

            <span class="co">// 填入銷售項目到菜單中</span>
            DataGridViewRowCollection rows = dataGridViewMenu.<span class="fu">Rows</span>;
            rows.<span class="fu">Add</span>(<span class="kw">new</span> Object[] { <span class="st">&quot;紅茶&quot;</span>, <span class="dv">25</span> }); 
            rows.<span class="fu">Add</span>(<span class="kw">new</span> Object[] { <span class="st">&quot;綠茶&quot;</span>, <span class="dv">25</span> });
            rows.<span class="fu">Add</span>(<span class="kw">new</span> Object[] { <span class="st">&quot;奶茶&quot;</span>, <span class="dv">30</span> });
            rows.<span class="fu">Add</span>(<span class="kw">new</span> Object[] { <span class="st">&quot;珍珠奶茶&quot;</span>, <span class="dv">35</span> });
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">dataGridViewMenu_CellClick</span>(<span class="dt">object</span> sender, DataGridViewCellEventArgs e)
        {
            <span class="co">// 選取某項目，將該項目的品名價格放入待購項目中。</span>
            <span class="kw">if</span> (dataGridViewMenu.<span class="fu">Rows</span>[e.<span class="fu">RowIndex</span>].<span class="fu">Cells</span>[<span class="dv">0</span>].<span class="fu">Value</span> == <span class="kw">null</span>)
                <span class="kw">return</span>;
            buttonName.<span class="fu">Text</span> = dataGridViewMenu.<span class="fu">Rows</span>[e.<span class="fu">RowIndex</span>].<span class="fu">Cells</span>[<span class="dv">0</span>].<span class="fu">Value</span>.<span class="fu">ToString</span>();
            textBoxPrice.<span class="fu">Text</span> = dataGridViewMenu.<span class="fu">Rows</span>[e.<span class="fu">RowIndex</span>].<span class="fu">Cells</span>[<span class="dv">1</span>].<span class="fu">Value</span>.<span class="fu">ToString</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonAdd_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="co">// 加入紐被按下</span>
            <span class="fu">calculateSubTotal</span>(); <span class="co">// 計算小計，並加入到訂單中</span>
            dataGridViewOrder.<span class="fu">Rows</span>.<span class="fu">Add</span>(<span class="kw">new</span> Object[] { name, price, number, subTotal }); 
            <span class="fu">calculateTotal</span>(); <span class="co">// 重新計算總價</span>
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">calculateSubTotal</span>() <span class="co">// 計算小計</span>
        {
            name = buttonName.<span class="fu">Text</span>;
            price = <span class="dt">double</span>.<span class="fu">Parse</span>(textBoxPrice.<span class="fu">Text</span>);
            number = (<span class="dt">double</span>)numericUpDownNumber.<span class="fu">Value</span>;
            subTotal = price * number; <span class="co">// 小計 = 價格 * 數量</span>
            textBoxSubtotal.<span class="fu">Text</span> = subTotal.<span class="fu">ToString</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">calculateTotal</span>() <span class="co">// 計算總價</span>
        {
            <span class="dt">double</span> total = <span class="fl">0.0</span>;
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; dataGridViewOrder.<span class="fu">Rows</span>.<span class="fu">Count</span>; i++)
            {
                DataGridViewRow row = dataGridViewOrder.<span class="fu">Rows</span>[i];
                <span class="kw">if</span> (row.<span class="fu">Cells</span>[<span class="dv">0</span>].<span class="fu">Value</span> != <span class="kw">null</span>)
                    total += (<span class="dt">double</span>)row.<span class="fu">Cells</span>[<span class="dv">3</span>].<span class="fu">Value</span>;
            }
            textBoxTotal.<span class="fu">Text</span> = total.<span class="fu">ToString</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">numericUpDownNumber_ValueChanged</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="fu">calculateSubTotal</span>(); <span class="co">// 數量修改時，重新計算小計。</span>
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonTotal_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="fu">calculateTotal</span>(); <span class="co">// 按下總價紐時，重新計算總價。</span>
        }
    }
}</code></pre>
<p>執行結果</p>
<div class="figure">
<img src="../img/MenuRun.png" alt="賣泡沫紅茶的系統的執行結果" /><p class="caption">賣泡沫紅茶的系統的執行結果</p>
</div>
<h2 id="參考文獻-5"><a href="#參考文獻-5">參考文獻</a></h2>
<ul>
<li>Data Binding in .NET / C# Windows Forms -- <a href="http://www.akadia.com/services/dotnet_databinding.html">http://www.akadia.com/services/dotnet_databinding.html</a></li>
<li>C# DataRow Examples -- <a href="http://dotnetperls.com/datarow">http://dotnetperls.com/datarow</a></li>
<li>How to bind a DataGridView to a DataSet without a database? -- <a href="http://www.devnewsgroups.net/windowsforms/t57859-how-bind-datagridview-dataset-without-database.aspx">http://www.devnewsgroups.net/windowsforms/t57859-how-bind-datagridview-dataset-without-database.aspx</a></li>
<li>Data Binding in DataGrid Control - Part 1 -- <a href="http://www.c-sharpcorner.com/UploadFile/mahesh/DataBindingInDataGridMCB112022005002207AM/DataBindingInDataGridMCB1.aspx">http://www.c-sharpcorner.com/UploadFile/mahesh/DataBindingInDataGridMCB112022005002207AM/DataBindingInDataGridMCB1.aspx</a></li>
</ul>
<h1 id="c-視窗程式繪圖功能"><a href="#c-視窗程式繪圖功能">C# 視窗程式：繪圖功能</a></h1>
<h2 id="畫圖功能示範"><a href="#畫圖功能示範">畫圖功能示範</a></h2>
<p>教學錄影：C# 畫圖功能示範 -- <a href="http://youtu.be/8aAql8R4WSg">http://youtu.be/8aAql8R4WSg</a></p>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/PaintDemo.zip">https://dl.dropbox.com/u/101584453/cs/code/PaintDemo.zip</a></p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> WindowsFormsApplication1
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        Graphics g;
        Pen pen;
        Font font;
        Brush brush;

        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();

            g = <span class="kw">this</span>.<span class="fu">CreateGraphics</span>();
            pen = <span class="kw">new</span> <span class="fu">Pen</span>(Color.<span class="fu">Black</span>, <span class="dv">3</span>);
            font = <span class="kw">new</span> <span class="fu">Font</span>(<span class="st">&quot;標楷體&quot;</span>, <span class="dv">16</span>);
            brush = <span class="kw">new</span> <span class="fu">SolidBrush</span>(Color.<span class="fu">Black</span>);
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_Paint</span>(<span class="dt">object</span> sender, PaintEventArgs e)
        {
            g.<span class="fu">DrawLine</span>(pen, <span class="kw">new</span> <span class="fu">Point</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="kw">new</span> <span class="fu">Point</span>(<span class="dv">300</span>, <span class="dv">100</span>));
            g.<span class="fu">DrawLine</span>(pen, <span class="kw">new</span> <span class="fu">Point</span>(<span class="dv">100</span>, <span class="dv">1</span>), <span class="kw">new</span> <span class="fu">Point</span>(<span class="dv">300</span>, <span class="dv">100</span>));
            g.<span class="fu">DrawRectangle</span>(pen, <span class="kw">new</span> <span class="fu">Rectangle</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">100</span>));

            g.<span class="fu">DrawString</span>(<span class="st">&quot;Hello! 你好！&quot;</span>, font, brush, <span class="kw">new</span> <span class="fu">PointF</span>(<span class="fl">150.</span>0F, <span class="fl">150.</span>0F));

            Image image = Image.<span class="fu">FromFile</span>(<span class="st">&quot;../../ccc.jpg&quot;</span>);
            g.<span class="fu">DrawImage</span>(image, <span class="kw">new</span> <span class="fu">Point</span>(<span class="dv">200</span>, <span class="dv">200</span>));
        }
    }
}</code></pre>
<h2 id="小畫板"><a href="#小畫板">小畫板</a></h2>
<p>教學錄影： * C# 小畫板 (2) -- <a href="http://youtu.be/HkOkWRQ_Ad4">http://youtu.be/HkOkWRQ_Ad4</a> * C# 小畫板 (3) -- <a href="http://youtu.be/VXaQu_yYu08">http://youtu.be/VXaQu_yYu08</a></p>
<p>專案下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/Painter.zip">https://dl.dropbox.com/u/101584453/cs/code/Painter.zip</a></p>
<div class="figure">
<img src="../img/Painter.png" alt="小畫板執行畫面" /><p class="caption">小畫板執行畫面</p>
</div>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> Painter
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        Graphics g;                 <span class="co">// 繪圖區</span>
        Pen pen;                    <span class="co">// 畫筆</span>
        <span class="dt">bool</span> isMouseDown = <span class="kw">false</span>;   <span class="co">// 紀錄滑鼠是否被按下</span>
        List&lt;Point&gt; points = <span class="kw">new</span> List&lt;Point&gt;(); <span class="co">// 紀錄滑鼠軌跡的陣列。</span>

        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();

            g = <span class="kw">this</span>.<span class="fu">CreateGraphics</span>(); <span class="co">// 取得繪圖區物件</span>
            pen = <span class="kw">new</span> <span class="fu">Pen</span>(Color.<span class="fu">Black</span>, <span class="dv">3</span>); <span class="co">// 設定畫筆為黑色、粗細為 3 點。</span>
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_MouseDown</span>(<span class="dt">object</span> sender, MouseEventArgs e)
        {
            isMouseDown = <span class="kw">true</span>; <span class="co">// 滑鼠被按下後設定旗標值。</span>
            points.<span class="fu">Add</span>(e.<span class="fu">Location</span>); <span class="co">// 將點加入到 points 陣列當中。</span>
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_MouseMove</span>(<span class="dt">object</span> sender, MouseEventArgs e)
        {
            <span class="kw">if</span> (isMouseDown) <span class="co">// 如果滑鼠被按下</span>
            {
                points.<span class="fu">Add</span>(e.<span class="fu">Location</span>); <span class="co">// 將點加入到 points 陣列當中。</span>
                <span class="co">// 畫出上一點到此點的線段。</span>
                g.<span class="fu">DrawLine</span>(pen, points[points.<span class="fu">Count</span> - <span class="dv">2</span>], points[points.<span class="fu">Count</span> - <span class="dv">1</span>]);
            }
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_MouseUp</span>(<span class="dt">object</span> sender, MouseEventArgs e)
        {
            points.<span class="fu">Add</span>(<span class="kw">new</span> <span class="fu">Point</span>(-<span class="dv">1</span>, -<span class="dv">1</span>)); <span class="co">// 滑鼠放開時，插入一個斷點 (-1,-1)，以代表前後兩點之間有斷開。</span>
            isMouseDown = <span class="kw">false</span>; <span class="co">// 滑鼠已經沒有被按下了。</span>
        }
    }
}</code></pre>
<h1 id="c-網路程式簡介ip-與-url"><a href="#c-網路程式簡介ip-與-url">C# 網路程式：簡介、IP 與 URL</a></h1>
<h2 id="簡介-2"><a href="#簡介-2">簡介</a></h2>
<p>最常被使用的網路函式庫稱為 <a href="http://en.wikipedia.org/wiki/Internet_socket">Socket</a>，這個名詞起源於柏克萊大學於 1983 年所釋放出來的 <a href="http://en.wikipedia.org/wiki/Berkeley_sockets">Berkeley Sockets</a> 函式庫，該函式庫將網路視為串流。因而使存取網路的動作，與存取檔案一樣，都可以透過串流機制運行。</p>
<p>雖然 Socket 函式庫將網路抽像化為串流，但是理解網路的架構對程式的學習仍有很大的幫助，目前我們所使用的 Internet 網路是基於 TCP/IP 的網路架構，要能理解目前的網路程式架構，首先要從 TCP/IP 的架構下手。</p>
<h3 id="tcpip-網路架構"><a href="#tcpip-網路架構">TCP/IP 網路架構</a></h3>
<p>網路的 OSI 參考模型將網路的層次分為七層，但是 TCP/IP 架構所依據的 ARPANET DoD 模型則只有四層，兩者之間存在某種對應關係，這個對應關係顯示於下圖當中，能正確的理解該圖，將有助於程式設計師理解網路程式的原理。</p>
<table>
<thead>
<tr class="header">
<th align="left">層次</th>
<th align="left">OSI</th>
<th align="left">TCP/IP</th>
<th align="left">協定範例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">7</td>
<td align="left">應用層</td>
<td align="left">HTTP</td>
<td align="left">HTTP、SMTP、SNMP、FTP、Telnet、<BR/> SIP、SSH、NFS、RTSP、XMPP、Whois、ENRP</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">表示層</td>
<td align="left"></td>
<td align="left">XDR、ASN.1、SMB、AFP、NCP</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">會話層</td>
<td align="left"></td>
<td align="left">ASAP、SSH、ISO 8327 / CCITT X.225、<BR/>RPC、NetBIOS、ASP、Winsock、BSD sockets</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">傳輸層</td>
<td align="left">TCP/UDP</td>
<td align="left">TCP、UDP、TLS、RTP、SCTP、SPX、ATP、IL</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">網路層</td>
<td align="left">IP</td>
<td align="left">IP、ICMP、IGMP、IPX、BGP、OSPF、RIP、<BR/>IGRP、EIGRP、ARP、RARP、 X.25</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">鏈結層</td>
<td align="left"></td>
<td align="left">乙太網、令牌環、HDLC、幀中繼、ISDN、<BR/>ATM、IEEE 802.11、FDDI、PPP</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">實體層</td>
<td align="left"></td>
<td align="left">線路、無線電、光纖</td>
</tr>
</tbody>
</table>
<p>舉例而言，當我們使用 TCP 的方式傳輸訊息時，由於 TCP 傳輸層會自動維持封包排列的順序，因此先傳送的封包一定會先到達，這讓程式設計師不需要擔心封包的先後順序問題。但在使用 UDP 傳輸的時候，先傳送的封包可能反而會後到達，因此訊息的順序將無法確保，這種 UDP 傳送方式雖然較快，但是卻較不方便，通常只被使用在強調速度的領域，像是立即影音傳輸的應用上。</p>
<div class="figure">
<img src="../img/1000px-IP_stack_connections.svg.png" alt="圖、OSI 與 TCP/IP 的層次對應圖" /><p class="caption">圖、OSI 與 TCP/IP 的層次對應圖</p>
</div>
<div class="figure">
<img src="../img/UDP_encapsulation.svg.png" alt="圖、UDP 的封包" /><p class="caption">圖、UDP 的封包</p>
</div>
<h3 id="基於-http-的-web"><a href="#基於-http-的-web">基於 HTTP 的 Web</a></h3>
<p>HTTP 是 Web 全球資訊網 (萬維網) 的基礎協定，該協定架構在 TCP/IP 架構之上，屬於應用層的協定。構成 HTTP 的主要兩個應用程式是瀏覽器 (Browser) 與網站 (Web Server)。HTTP 是一個典型的 Client-Server (客戶端-伺服端) 架構的協定，使用者透過 Client 端的瀏覽器連結到 Server 的伺服器，然後由伺服端將結果以 HTML 的網頁格式傳回。 HTML 的網頁當中包含了許多超連結 (Hyperlink)，這些超連結連接到某些網址 (URL)，於是使用者可以透過瀏覽器中的超連結，進一步點選其他的網頁，進行網路瀏覽 (衝浪) 的行為。</p>
<h3 id="socket-函式庫"><a href="#socket-函式庫">Socket 函式庫</a></h3>
<p>目前大部分的程式語言與平台 (像是 Java, C#, .NET, UNIX, Linux, ....) 都已經支援了 Socket 函式庫。但是由於語言與設計者的不同，這些 Socket 函式庫的使用方式都略有差異。在 C# 最常使用的是微軟 .NET 平台當中 的 Socket 函式庫，這個函式庫相當的成熟，除了將 TCP/IP 封裝成 Socket 函式庫之外，微軟甚至進一步將 HTTP 、加解密、甚至是高階的 Web 服務等機制，都包含在 .NET 平台當中，因此 C# 的程式設計師可以很輕易的寫出網路應用程式。</p>
<p>Socket 函式庫與 TCP/IP/HTTP 等層級的協定，是學習網路程式的基礎，接下來，我們將會進一步以範例說明網路程式的架構。</p>
<h2 id="ip-層的程式設計"><a href="#ip-層的程式設計">IP 層的程式設計</a></h2>
<p>IP 是 TCP/IP 架構當中代表網址的層次，在撰寫 C# 網路程式時，幾乎每個程式都會用到 IP 層的物件，像是 IPAddress，IPEndPoint 等。我們將在本文當中介紹這些物件的使用方式。</p>
<p>IPAddress 物件代表一個 IP 網址，像是 210.59.154.30 就是一個 IP。在一個大機構當中，由於有自身的內部網路，因此 IP 通常也分為對內與對外兩種。舉例而言，筆者在金門技術學院電腦的內部 IP 是 192.168.60.155，外部 IP 是 210.59.154.30。學校內部的電腦可以透過內部 IP 192.168.60.155 連接到該電腦，但是校外的電腦就只能透過外部 IP 210.59.154.30 連結到該電腦。</p>
<p>但是，IP 畢竟是不好記的數字，因此就發展出了 DNS (Domain Name Server, 網域名稱伺服器) 機制，用來將文字型的網址對應到數字型的 IP，這個文字型的網址稱為 URL (Universial Resource Locator)。</p>
<h3 id="操作實驗"><a href="#操作實驗">操作實驗</a></h3>
<pre><code>C:\Documents and Settings\ccc.CCC-KMIT2&gt;ipconfig /all

Windows IP Configuration

        Host Name . . . . . . . . . . . . : ccc-kmit3
        Primary Dns Suffix  . . . . . . . :
        Node Type . . . . . . . . . . . . : Mixed
        IP Routing Enabled. . . . . . . . : No
        WINS Proxy Enabled. . . . . . . . : No
        DNS Suffix Search List. . . . . . : internal

Ethernet adapter 區域連線:

        Connection-specific DNS Suffix  . : internal
        Description . . . . . . . . . . . : Broadcom NetLink (TM) Gigabit Ethernet
        Physical Address. . . . . . . . . : 00-01-6C-95-20-52
        Dhcp Enabled. . . . . . . . . . . : Yes
        Autoconfiguration Enabled . . . . : Yes
        IP Address. . . . . . . . . . . . : 192.168.60.155
        Subnet Mask . . . . . . . . . . . : 255.255.255.0
        Default Gateway . . . . . . . . . : 192.168.60.254
        DHCP Server . . . . . . . . . . . : 192.168.1.252
        DNS Servers . . . . . . . . . . . : 10.10.10.3
                                            10.10.10.10
        Primary WINS Server . . . . . . . : 10.10.10.20
        Lease Obtained. . . . . . . . . . : 2010年3月8日 上午 09:45:01
        Lease Expires . . . . . . . . . . : 2012年2月6日 上午 09:45:01

C:\Documents and Settings\ccc.CCC-KMIT2&gt;nslookup ccc.kmit.edu.tw
Server:  ns1.kmit.edu.tw
Address:  10.10.10.3

Name:    ccc.kmit.edu.tw
Address:  192.168.60.155

C:\Documents and Settings\ccc.CCC-KMIT2&gt;nslookup tw.yahoo.com
Server:  ns1.kmit.edu.tw
Address:  10.10.10.3

Non-authoritative answer:
Name:    tw-tpe-fo.fyap.b.yahoo.com
Address:  119.160.246.241
Aliases:  tw.yahoo.com, tw-cidr.fyap.b.yahoo.com

C:\ccc&gt;nslookup
Default Server:  ns1.kmit.edu.tw
Address:  10.10.10.3

&gt; server dns.hinet.net
Default Server:  dns.hinet.net
Address:  168.95.1.1

&gt; ccc.kmit.edu.tw
Server:  dns.hinet.net
Address:  168.95.1.1

Non-authoritative answer:
Name:    ccc.kmit.edu.tw
Address:  203.72.226.32</code></pre>
<h3 id="ip-層程式範例-1"><a href="#ip-層程式範例-1">IP 層程式範例 1</a></h3>
<p>範例：建立 IPAddress 與 IPEndPoint。</p>
<p>檔案： IPAddressTest.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;

<span class="kw">class</span> IPAddressTest {
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>() {
        <span class="co">// 建立一個 IP 位址 (IPAddress)。</span>
        IPAddress ipAddr = IPAddress.<span class="fu">Parse</span>(<span class="st">&quot;210.59.154.30&quot;</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;ipAddr=&quot;</span>+ipAddr);

        <span class="co">// 建立一個 IP 終端 (IPEndPoint = ipAddress + port)。</span>
        IPEndPoint ipEndPoint = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(ipAddr, <span class="dv">80</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;ipEndPoint=&quot;</span> + ipEndPoint);

        <span class="co">// 將IPEndPoint序列化為SocketAddress</span>
        SocketAddress socketAddr = ipEndPoint.<span class="fu">Serialize</span>();
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;socketAddr=&quot;</span> + socketAddr);
    }
}</code></pre>
<p>執行結果：</p>
<pre><code>D:\CSharp&gt;csc IPAddressTest.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

D:\CSharp&gt;IPAddressTest
ipAddr=210.59.154.30
ipEndPoint=210.59.154.30:80
socketAddr=InterNetwork:16:{0,80,210,59,154,30,0,0,0,0,0,0,0,0}</code></pre>
<p>範例：取得主機名稱</p>
<p>檔案：IpToHost.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;

<span class="kw">class</span> IpToHost
{
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        IPAddress ipAddr = IPAddress.<span class="fu">Parse</span>(args[<span class="dv">0</span>]);

        <span class="co">// 透過DNS找尋IP位址相對應之主機名稱 </span>
        IPHostEntry remoteHostEntry = Dns.<span class="fu">GetHostEntry</span>(ipAddr);

        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;host of ip &quot;</span> + ipAddr + <span class="st">&quot; is &quot;</span> + remoteHostEntry.<span class="fu">HostName</span>);
    }
}</code></pre>
<p>執行結果：</p>
<pre><code>D:\CSharp&gt;csc IpToHost.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

D:\CSharp&gt;IpToHost 210.59.154.30
host of ip 210.59.154.30 is 210.59.154.30

D:\CSharp&gt;IpToHost 119.160.246.241
host of ip 119.160.246.241 is w1.www.vip.tw1.yahoo.com</code></pre>
<h2 id="url-dns-與網址剖析"><a href="#url-dns-與網址剖析">URL 、DNS 與網址剖析</a></h2>
<p>範例：使用 DNS 查詢 IP</p>
<p>檔案：DnsTest.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;

<span class="kw">class</span> DnsTest
{
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        IPHostEntry hostEntry = Dns.<span class="fu">GetHostEntry</span>(args[<span class="dv">0</span>]);

        <span class="co">// 由於主機有可能有一個以上的 Alias</span>
        <span class="co">// 因此程式中以迴圈方式判斷 Aliases </span>
        <span class="dt">string</span>[] aliasList = hostEntry.<span class="fu">Aliases</span>;

        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= aliasList.<span class="fu">Length</span> - <span class="dv">1</span>; i++)
        {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Alias &quot;</span>+i+<span class="st">&quot; : &quot;</span>+aliasList[i]);
        }

        <span class="co">// 由於主機有可能有一個以上的 IP Address</span>
        <span class="co">// 因此程式中以迴圈方式判斷 AddressList </span>
        IPAddress[] addrList = hostEntry.<span class="fu">AddressList</span>;

        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= addrList.<span class="fu">Length</span> - <span class="dv">1</span>; i++)
        {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Address &quot;</span> + i + <span class="st">&quot; : &quot;</span> + addrList[i]);
        }
    }
}</code></pre>
<p>執行結果</p>
<pre><code>D:\CSharp&gt;DnsTest tw.yahoo.com
Address 0 : 119.160.246.241</code></pre>
<p>範例：剖析網址 URL</p>
<p>檔案：UrlParseTest.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;

<span class="kw">class</span> UrlParseTest
{
    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        <span class="co">// 由於 DOS 的命令列會以 &amp; 符號做命令分隔字元，因此、若以指令模式下，網址中的 &amp; 之後會被視為是下一個指令</span>
        System.<span class="fu">Uri</span> URL = <span class="kw">new</span> System.<span class="fu">Uri</span>(<span class="st">&quot;http://findbook.tw/search?keyword_type=keyword&amp;t=xxx&quot;</span>);
<span class="co">//        System.Uri URL = new System.Uri(args[0]);</span>
        <span class="co">// System.Uri類別之屬性</span>
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;AbsolutePath: &quot;</span> + URL.<span class="fu">AbsolutePath</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;AbsoluteUri: &quot;</span> + URL.<span class="fu">AbsoluteUri</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Authority: &quot;</span> + URL.<span class="fu">Authority</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Host: &quot;</span> + URL.<span class="fu">Host</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Port: &quot;</span> + URL.<span class="fu">Port</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;LocalPath: &quot;</span> + URL.<span class="fu">LocalPath</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;IsDefaultPort: &quot;</span> + URL.<span class="fu">IsDefaultPort</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;IsFile: &quot;</span> + URL.<span class="fu">IsFile</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;PathAndQuery: &quot;</span> + URL.<span class="fu">PathAndQuery</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Query: &quot;</span> + URL.<span class="fu">Query</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Scheme: &quot;</span> + URL.<span class="fu">Scheme</span>);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;UserEscaped: &quot;</span> + URL.<span class="fu">UserEscaped</span>);
<span class="co">//        Console.WriteLine(&quot;UserInfo: &quot; + URL.UserInfo);</span>
    }
}</code></pre>
<p>執行結果</p>
<pre><code>C:\ccc&gt;csc UrlParseTest.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

C:\ccc&gt;UrlParseTest
AbsolutePath: /search
AbsoluteUri: http://findbook.tw/search?keyword_type=keyword&amp;t=xxx
Authority: findbook.tw
Host: findbook.tw
Port: 80
LocalPath: /search
IsDefaultPort: True
IsFile: False
PathAndQuery: /search?keyword_type=keyword&amp;t=xxx
Query: ?keyword_type=keyword&amp;t=xxx
Scheme: http
UserEscaped: False</code></pre>
<h2 id="結語-3"><a href="#結語-3">結語</a></h2>
<p>微軟 C# 的 IP 層物件主要是 IPAddress 與 IPEndPoint，另外 IPHostEntry可以用來代表 URL，也可以用 Dns.GetHostEntry() 查詢主機名稱。這些是 C# 較常使用的 IP 層物件。</p>
<h1 id="c-網路程式udp-程式設計"><a href="#c-網路程式udp-程式設計">C# 網路程式：UDP 程式設計</a></h1>
<h2 id="udp-簡介"><a href="#udp-簡介">UDP 簡介</a></h2>
<p>UDP 是網路程式設計當中，最簡單的一種模式。本文將介紹如何使用 C# 撰寫 UDP 的『傳送-接收程式』。</p>
<p>UDP 程式的架構：使用 UDP 方式傳送訊息，由於封包是以一個一個的方式分別傳輸，先傳送者不一定會先到，甚至於沒有到達也不進行處理。由於這種方式不是連線導向的方式，因此不需要記住連線的 Socket，只要直接用 Socket 當中的 ReceiveFrom(data, ref Remote) 函數即可。</p>
<p>UDP 的程式必須有『傳送-接收』兩端，通常傳送端稱為 Client，接收端稱為 Server，以下是一個 UDP Client-Server 的 C# 程式架構。</p>
<p>客戶端：傳送訊息的 Client</p>
<pre class="sourceCode CS"><code class="sourceCode cs">IPEndPoint ip = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(address, port);
Socket server = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Dgram</span>, ProtocolType.<span class="fu">Udp</span>);
....
<span class="kw">while</span>(<span class="kw">true</span>) {
     ...
     server.<span class="fu">SendTo</span>(data, ip);
}
...
server.<span class="fu">Close</span>();</code></pre>
<p>伺服端：接收訊息的 Server</p>
<pre class="sourceCode CS"><code class="sourceCode cs">ip = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, port);
socket = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Dgram</span>, ProtocolType.<span class="fu">Udp</span>);
socket.<span class="fu">Bind</span>(ipep);
...
<span class="kw">while</span>(<span class="kw">true</span>) {
  <span class="dt">byte</span>[] data = <span class="kw">new</span> <span class="dt">byte</span>[size];
  <span class="dt">int</span> recv = socket.<span class="fu">ReceiveFrom</span>(data, <span class="kw">ref</span> Remote);
  ...
}</code></pre>
<p>為了說明 UDP 網路程式的設計方式，我們設計了一個單向的 UDP 聊天程式專案，這個專案包含 UdpClient.cs 與 UdpServer.cs 等兩個 C# 的程式。使用者可以在 UdpClient 當中輸入要傳送給 UdpServer 的訊息，而程式會忠實的將訊息從 Client 傳送到 Server 中。當使用者輸入 exit 的時候，Client 程式將會結束，以下是該程式執行時的畫面。</p>
<div class="figure">
<img src="../img/CSharpUdpScreen.jpg" alt="圖一、單向的 UDP 聊天專案的執行畫面" /><p class="caption">圖一、單向的 UDP 聊天專案的執行畫面</p>
</div>
<h2 id="單向-udp-訊息傳遞程式"><a href="#單向-udp-訊息傳遞程式">單向 UDP 訊息傳遞程式</a></h2>
<p>以下是一個 UDP 客戶端 UdpClient，該客戶端會接受使用者的輸入，然後將訊息傳遞給伺服端的 UdpServer。</p>
<p>檔案：UdpClient.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">public</span> <span class="kw">class</span> UdpClient
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)  <span class="co">// 主程式開始</span>
    {
        <span class="co">// 連接到 args[0] 參數所指定的 Server，使用連接埠 5555</span>
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Parse</span>(args[<span class="dv">0</span>]), <span class="dv">5555</span>);
        <span class="co">// 建立 Socket，連接到 Internet (InterNetwork)，使用 Udp 協定的 Datagram 方式 (Dgram)。</span>
        Socket server = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Dgram</span>, ProtocolType.<span class="fu">Udp</span>);
        <span class="kw">while</span>(<span class="kw">true</span>)  <span class="co">// 不斷讀取鍵盤輸入，並傳送輸入訊息給伺服器。</span>
        {
         <span class="dt">string</span> input = Console.<span class="fu">ReadLine</span>(); <span class="co">// 讀取鍵盤輸入</span>
         <span class="kw">if</span> (input == <span class="st">&quot;exit&quot;</span>)   <span class="co">// 如果輸入為 exit，則強制離開程式。</span>
         <span class="kw">break</span>;
         server.<span class="fu">SendTo</span>(Encoding.<span class="fu">UTF8</span>.<span class="fu">GetBytes</span>(input), ipep);    <span class="co">// 將訊息以 UTF8 的方式編碼後傳出。</span>
        }
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Stopping client&quot;</span>);   <span class="co">// 印出 Stopping client 訊息。</span>
        server.<span class="fu">Close</span>(); <span class="co">// 關閉連線。</span>
    }
}</code></pre>
<p>以下是一個 Udp 的伺服端，利用無窮迴圈接收上述客戶端傳來的訊息，然後列印在螢幕上。</p>
<p>檔案：UdpServer.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">public</span> <span class="kw">class</span> UdpServer
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
    {
        <span class="co">// 開啟伺服器的 5555 連接埠，用來接收任何傳送到本機的訊息。</span>
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, <span class="dv">5555</span>);
        <span class="co">// 建立接收的 Socket，並使用 Udp 的 Datagram 方式接收。</span>
        Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Dgram</span>, ProtocolType.<span class="fu">Udp</span>);
        <span class="co">// 綁定 Socket (newsock) 與 IPEndPoint (ipep)，讓 Socket 接收 5555 埠的訊息。</span>
        newsock.<span class="fu">Bind</span>(ipep);
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Waiting for a client...&quot;</span>); <span class="co">// 顯示 Waiting for client ...。</span>
        <span class="co">// 建立 Remote 物件以便取得封包的接收來源的 EndPoint 物件。</span>
        IPEndPoint sender = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, <span class="dv">0</span>); 
        EndPoint Remote = (EndPoint)(sender);
        <span class="kw">while</span>(<span class="kw">true</span>) <span class="co">// 無窮迴圈，不斷接收訊息並顯示到螢幕上。</span>
        {
         <span class="dt">byte</span>[] data = <span class="kw">new</span> <span class="dt">byte</span>[<span class="dv">1024</span>]; <span class="co">// 設定接收緩衝區的陣列變數。</span>
         <span class="dt">int</span> recv = newsock.<span class="fu">ReceiveFrom</span>(data, <span class="kw">ref</span> Remote); <span class="co">// 接收對方傳來的封包。</span>
         <span class="co">// 將該封包以 UTF8 的格式解碼為字串，並顯示到螢幕上。</span>
         Console.<span class="fu">WriteLine</span>(Encoding.<span class="fu">UTF8</span>.<span class="fu">GetString</span>(data, <span class="dv">0</span>, recv)); 
        }
    }
}</code></pre>
<p>程式說明：</p>
<p>在上述程式當中，讀者會看到兩個無窮迴圈，這在網路程式設計領域是很常見的。Server 通常是一個由無窮迴圈所構成的程式，該程式不斷的接收由 Client 所傳來的訊息，然後進行處理與顯示。</p>
<p>程式中的 IPEndPoint 所代表的就是 TCP/IP 協定中的 IP 層，也就是網址。建構函數 new IPEndPoint(address, port) 有兩個參數，第一個是 IP 地址 (address)，第二個是連接埠 (port)。這個物件在撰寫 Client 與 Server 時都會用到。</p>
<p>在 UdpClient 的程式中，我們直接利用下列程式連接到 Server，您可以使用</p>
<pre><code>IPEndPoint ipep = new IPEndPoint(IPAddress.Parse(args[0]), 5555);</code></pre>
<p>UdpServer 程式中的 new IPEndPoint(IPAddress.Any, 5555) 會開啟該伺服器電腦的 5555 這個連接埠 (port)，讓其他程式可以透過網路傳送訊息給該程式。一但某程式開啟了特定連接埠，就會霸佔該連接埠。作業系統不會允許其他程式再度開啟這個連接埠，因為該連接埠已經被用掉了。</p>
<p>讀者可能會對其中的 IPAddress.Any 的用意感到納悶，為何不是指定本機的 IP，而是用 IPAddress.Any 呢？</p>
<h2 id="參考文獻-6"><a href="#參考文獻-6">參考文獻</a></h2>
<ul>
<li>MSDN/.NET Framework 類別庫/Socket 類別 -- <a href="http://msdn.microsoft.com/zh-tw/library/system.net.sockets.socket(VS.80).aspx">http://msdn.microsoft.com/zh-tw/library/system.net.sockets.socket(VS.80).aspx</a></li>
<li>Socket.ReceiveFrom 方法 -- <a href="http://msdn.microsoft.com/zh-tw/library/wdfskwcy(VS.80).aspx">http://msdn.microsoft.com/zh-tw/library/wdfskwcy(VS.80).aspx</a></li>
</ul>
<h1 id="c-網路程式tcp-程式設計"><a href="#c-網路程式tcp-程式設計">C# 網路程式：TCP 程式設計</a></h1>
<h2 id="tcp-簡介"><a href="#tcp-簡介">TCP 簡介</a></h2>
<p>TCP 是一個連線導向的網路傳輸協定，程式通常在斷線之前會一直記住這個連線。在我們使用 Socket 函式庫設計 TCP 網路程式時，通常會讓一個 Thread 負責處理一條連線，這樣可以讓問題變得較為單純，因為不需要用表格去記住連線。</p>
<p>所以，在學習 TCP 程式設計之前，我們有必要先複習一下 Thread (台灣稱為執行緒、中國大陸稱為線程) 的程式設計方式，若讀者對 Thread 尚不熟悉，請先閱讀本書的 Thread 章節。</p>
<h2 id="tcp-的程式架構"><a href="#tcp-的程式架構">TCP 的程式架構</a></h2>
<p>TCP 客戶端的通常在連上伺服端後，就會用一個迴圈透過 Socket.send 函數傳送訊息，以下是一個典型的 TCP 客戶端程式。</p>
<p>客戶端：Client</p>
<pre class="sourceCode CS"><code class="sourceCode cs">        IPEndPoint ip = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Parse</span>(address), port);
        Socket server = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
        server.<span class="fu">Connect</span>(ip);
        ...
        <span class="kw">while</span>(<span class="kw">true</span>) {
            ...
            server.<span class="fu">Send</span>(data);
            ...
        }
        ...
        server.<span class="fu">Shutdown</span>(SocketShutdown.<span class="fu">Both</span>);
        server.<span class="fu">Close</span>();</code></pre>
<p>TCP 伺服端通常較為複雜，首先在利用 Socket 中的 bind() 函數佔用特定的 port 之後，會再進入一個無窮迴圈，在迴圈中利用 socket.Accept() 接受客戶端的連線，此時會產生一個新的 Socket 物件。通常，我們會建立一個新的 Thread 去處理這個連線，因此在下列程式中，我們建立了 TcpListener 這個物件，以便讓一個 Listener 處理一個 Socket 連線。</p>
<p>伺服端：Server</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">public</span> <span class="kw">class</span> TcpServer
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
    {
        IPEndPoint ip = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, port);
        Socket socket = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
        socket.<span class="fu">Bind</span>(ip);
        socket.<span class="fu">Listen</span>(<span class="dv">10</span>);
        <span class="kw">while</span>(<span class="kw">true</span>)
        {
            Socket client = socket.<span class="fu">Accept</span>();
            TcpListener listener = <span class="kw">new</span> <span class="fu">TcpListener</span>(client); <span class="co">// 建立 Listener 物件處理這個連線。</span>
            Thread thread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(listener.<span class="fu">run</span>)); <span class="co">// 建立 listener.run 的 Thread。</span>
            thread.<span class="fu">Start</span>(); <span class="co">// 啟動 Thread</span>
            ...
        }
         ...
    }
}

<span class="kw">public</span> <span class="kw">class</span> TcpListener {
    Socket socket;

    <span class="kw">public</span> <span class="fu">TcpListener</span>(Socket s)  { socket = s; }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() { <span class="co">// Thread 的主要函數</span>
        <span class="kw">while</span> (<span class="kw">true</span>)  {
            ...
            <span class="dt">byte</span>[] data = <span class="kw">new</span> <span class="dt">byte</span>[<span class="dv">1024</span>];
            <span class="dt">int</span> recv = socket.<span class="fu">Receive</span>(data); <span class="co">// 接收資料</span>
            ...
        }
        socket.<span class="fu">Close</span>();
    }
}</code></pre>
<p>以上就是一個典型的 TCP 程式架構，該架構包含了『客戶端-伺服端』兩個部分，客戶端透過 Socket.send 傳送訊息，而伺服端則會針對每一個連線，建立新的 Thread ，以便處理連線的互動關係。這種架構對 TCP 而言是較為簡單的，有幾個連線就建立幾個 Thread。由於這種架構不需要用表格記住連線，因此簡化了伺服端的管理，讓程式設計更為容易。</p>
<p>在理解了這個架構後，讓我們來看看幾個真實的程式範例：</p>
<h2 id="tcp-單向的訊息傳遞程式"><a href="#tcp-單向的訊息傳遞程式">TCP 單向的訊息傳遞程式</a></h2>
<p>由於網路程式必須有連線，因此至少要有兩個程式才能運作，通常主動連線的一方稱為 Client，被動等待連線的一方稱為 Server，這就是所謂的 Client - Server 架構。</p>
<p>在本範例中，我們撰寫了一個 TcpClient 與一個 TcpServer 程式，TcpClient 連線到 TcpServer 之後，會將使用者所輸入的文字傳司送給 TcpServer。當 TcpServer 收到這些文字之後會印出在螢幕上，這個範例示範了一個極為簡單的網路程式架構。</p>
<p>檔案：TcpClient1.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;

<span class="kw">public</span> <span class="kw">class</span> TcpClient
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
    {
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Parse</span>(args[<span class="dv">0</span>]), <span class="dv">20</span>);

        Socket server = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
        server.<span class="fu">Connect</span>(ipep);

        <span class="kw">while</span>(<span class="kw">true</span>)
        {
         <span class="dt">string</span> input = Console.<span class="fu">ReadLine</span>();
         <span class="kw">if</span> (input == <span class="st">&quot;exit&quot;</span>)
         <span class="kw">break</span>;
         <span class="dt">byte</span>[] data = Encoding.<span class="fu">UTF8</span>.<span class="fu">GetBytes</span>(input);
<span class="co">//   byte[] data = Encoding.ASCII.GetBytes(input);</span>
         server.<span class="fu">Send</span>(data);
        }
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Disconnecting from server...&quot;</span>);
        server.<span class="fu">Shutdown</span>(SocketShutdown.<span class="fu">Both</span>);
        server.<span class="fu">Close</span>();
    }
}</code></pre>
<p>檔案：TcpServer1.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;

<span class="kw">public</span> <span class="kw">class</span> TcpServer
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
    {
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, <span class="dv">20</span>);

        Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);

        newsock.<span class="fu">Bind</span>(ipep);
        newsock.<span class="fu">Listen</span>(<span class="dv">10</span>);

        <span class="kw">while</span>(<span class="kw">true</span>)
        {
         Socket client = newsock.<span class="fu">Accept</span>();
         IPEndPoint clientep = (IPEndPoint) client.<span class="fu">RemoteEndPoint</span>;
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Client End Point = &quot;</span> + clientep);
         <span class="co">// create a new thread and then receive message.</span>
         TcpListener listener = <span class="kw">new</span> <span class="fu">TcpListener</span>(client);
         Thread thread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(listener.<span class="fu">run</span>));
         thread.<span class="fu">Start</span>();
        }
<span class="co">//     newsock.Close();</span>
    }
}

<span class="kw">public</span> <span class="kw">class</span> TcpListener {
    Socket socket;

    <span class="kw">public</span> <span class="fu">TcpListener</span>(Socket s)
    {
        socket = s;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() 
    {
        <span class="kw">try</span> {
          <span class="kw">while</span> (<span class="kw">true</span>) 
          {
            <span class="dt">byte</span>[] data = <span class="kw">new</span> <span class="dt">byte</span>[<span class="dv">1024</span>];
            <span class="dt">int</span> recv = socket.<span class="fu">Receive</span>(data);
            <span class="kw">if</span> (recv == <span class="dv">0</span>) <span class="kw">break</span>;
            Console.<span class="fu">WriteLine</span>(Encoding.<span class="fu">UTF8</span>.<span class="fu">GetString</span>(data, <span class="dv">0</span>, recv));
          }
          socket.<span class="fu">Close</span>();
        } <span class="kw">catch</span> (Exception e) {
          Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Client &quot;</span>+socket.<span class="fu">RemoteEndPoint</span>+<span class="st">&quot; Error : close&quot;</span>);
          Console.<span class="fu">WriteLine</span>(e);
        }
    }
}</code></pre>
<p>上述程式的執行結果如下所示：</p>
<p><a href="../img/TcpMessage1way.jpg"></a></p>
<h2 id="tcp-雙向聊天程式"><a href="#tcp-雙向聊天程式">TCP 雙向聊天程式</a></h2>
<p>聊天程式是學習網路程式設計很好的入門題目之一，在本文中，我們將示範如何用 C# 的 Socket 函式庫設計一個網路聊天程式。以下是這個程式的執行時的一個畫面，讀者可以看到我們在兩個命令列視窗中執行同一個 ChatBox 程式，左上角是 Server 程式，右下角是 Client 程式。</p>
<div class="figure">
<img src="../img/ChatBox.jpg" alt="聊天程式的執行畫面" /><p class="caption">聊天程式的執行畫面</p>
</div>
<p>在上圖中，Client 可以傳送訊息給 Server ，而 Server 也可傳送訊息給 Client，由於雙方在這個傳送接收的動作上幾乎是相同的，因此在寫程式時就將這些動作封裝後共用，可以讓程式更為精簡，這就是 P2P 架構的程式。</p>
<p>當然，這個程式也可以放在兩台不同的電腦上執行，其結果將與上述結果類似，只是無法同時在一台電腦上看到輸入與輸出的結果而已。</p>
<p>以下是上述雙向聊天程式 ChatBox 的原始程式碼，其中的 TcpListener 程式是 Client-Server 雙方所共用的部分，因此獨立出來變成一個類別，並且分別在 Client 與 Server 主程式當中都用 new TcpListener() 的方式呼叫。此時雙方都會建立一個寫入迴圈 (outLoop) 與讀取回圈 (inLoop)，寫入迴圈不斷等待鍵盤的輸入，並在有輸入時將訊息傳遞給對方。而讀取回圈則是不斷接收對方所傳來的訊息並顯示在螢幕上。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;

<span class="kw">class</span> ChatBox
{
    <span class="dt">int</span> port = <span class="dv">20</span>;

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        ChatBox chatBox = <span class="kw">new</span> <span class="fu">ChatBox</span>();
        <span class="kw">if</span> (args.<span class="fu">Length</span> == <span class="dv">0</span>)
         chatBox.<span class="fu">ServerMain</span>();
        <span class="kw">else</span>
         chatBox.<span class="fu">ClientMain</span>(args[<span class="dv">0</span>]);
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">ServerMain</span>()
    {
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, port);
        Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
        newsock.<span class="fu">Bind</span>(ipep);
        newsock.<span class="fu">Listen</span>(<span class="dv">10</span>);
        Socket client = newsock.<span class="fu">Accept</span>();
        <span class="kw">new</span> <span class="fu">TcpListener</span>(client); <span class="co">// create a new thread and then receive message.</span>
        newsock.<span class="fu">Close</span>();
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">ClientMain</span>(String ip)
    {
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Parse</span>(ip), port);
        Socket server = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
        server.<span class="fu">Connect</span>(ipep);
        <span class="kw">new</span> <span class="fu">TcpListener</span>(server);
        server.<span class="fu">Shutdown</span>(SocketShutdown.<span class="fu">Both</span>);
        server.<span class="fu">Close</span>();
    }

}

<span class="kw">public</span> <span class="kw">class</span> TcpListener
{
    Socket socket;
    Thread inThread, outThread;
    NetworkStream stream;
    StreamReader reader;
    StreamWriter writer;

    <span class="kw">public</span> <span class="fu">TcpListener</span>(Socket s)
    {
        socket = s;
        stream = <span class="kw">new</span> <span class="fu">NetworkStream</span>(s);
        reader = <span class="kw">new</span> <span class="fu">StreamReader</span>(stream);
        writer = <span class="kw">new</span> <span class="fu">StreamWriter</span>(stream);
        inThread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(inLoop));
        inThread.<span class="fu">Start</span>();
        outThread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(outLoop));
        outThread.<span class="fu">Start</span>();
        inThread.<span class="fu">Join</span>(); <span class="co">// 等待 inThread 執行續完成，才離開此函數。 </span>
        <span class="co">// (注意、按照 inLoop 的邏輯，這個函數永遠不會跳出，因為 inLoop 是個無窮迴圈)。</span>
    } 

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">inLoop</span>()
    {
        <span class="kw">while</span> (<span class="kw">true</span>)
        {
         String line = reader.<span class="fu">ReadLine</span>();
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;收到：&quot;</span> + line);
        }
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">outLoop</span>()
    {
        <span class="kw">while</span> (<span class="kw">true</span>)
        {
         String line = Console.<span class="fu">ReadLine</span>();
         writer.<span class="fu">WriteLine</span>(line);
         writer.<span class="fu">Flush</span>();
        }
    }
}</code></pre>
<h2 id="tcp-多人聊天室-視窗版"><a href="#tcp-多人聊天室-視窗版">TCP 多人聊天室 (視窗版)</a></h2>
<p>專案程式下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/ChattingRoom.zip">https://dl.dropbox.com/u/101584453/cs/code/ChattingRoom.zip</a></p>
<p>使用方法</p>
<pre><code>// ---------------------------------------------------------------
// 共有四個程式檔案
//
//  程式檔 : ChatLib.cs
//  程式檔 : ChattingServer.cs
//  程式檔 : FormChatClient.cs
//  程式檔 : FormChatClient.Designer.cs
//
// 編譯方式 : 
//    步驟 1 : csc ChatServer.cs ChatLib.cs
//             會產生 ChattingServer.exe 檔
//
//    步驟 2 : csc WinChatClient.cs FormChatClient.cs FormChatClilent.Designer.cs ChatLib.cs
//             會產生 WinChatClient.exe 檔
//     
// 執行方式 : 
//    步驟 1 : 執行 ChatServer.exe
//    步驟 2 : 執行 WinChatClient.exe (使用者 1)
//    步驟 3 : 執行 WinChatClient.exe (使用者 2)
//
// 如此，兩個 WinChatClient.exe 的視窗間即可透過本機聊天
// ---------------------------------------------------------------</code></pre>
<p>檔案：ChatLib.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="co">// ------------------------- ChatLib.cs --------------------------</span>
<span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;

<span class="kw">namespace</span> ChattingRoom
{
    <span class="kw">public</span> <span class="kw">class</span> ChatSetting
    {
        <span class="kw">public</span> <span class="kw">static</span> String serverIp = <span class="st">&quot;192.168.100.172&quot;</span>;
        <span class="kw">public</span> <span class="kw">static</span> <span class="dt">int</span> port = <span class="dv">3766</span>;
    }

    <span class="kw">public</span> <span class="kw">delegate</span> String <span class="fu">StrHandler</span>(String str);

    <span class="kw">public</span> <span class="kw">class</span> ChatSocket
    {
        <span class="kw">public</span> Socket socket;
        <span class="kw">public</span> NetworkStream stream;
        <span class="kw">public</span> StreamReader reader;
        <span class="kw">public</span> StreamWriter writer;
        <span class="kw">public</span> StrHandler inHandler;
        <span class="kw">public</span> EndPoint remoteEndPoint;
        <span class="kw">public</span> <span class="dt">bool</span> isDead = <span class="kw">false</span>;

        <span class="kw">public</span> <span class="fu">ChatSocket</span>(Socket s)
        {
            socket = s;
            stream = <span class="kw">new</span> <span class="fu">NetworkStream</span>(s);
            reader = <span class="kw">new</span> <span class="fu">StreamReader</span>(stream);
            writer = <span class="kw">new</span> <span class="fu">StreamWriter</span>(stream);
            remoteEndPoint = socket.<span class="fu">RemoteEndPoint</span>;
        }

        <span class="kw">public</span> String <span class="fu">receive</span>()
        {
            <span class="kw">return</span> reader.<span class="fu">ReadLine</span>();
        }

        <span class="kw">public</span> ChatSocket <span class="fu">send</span>(String line)
        {
            writer.<span class="fu">WriteLine</span>(line);
            writer.<span class="fu">Flush</span>();
            <span class="kw">return</span> <span class="kw">this</span>;
        }

        <span class="kw">public</span> <span class="kw">static</span> ChatSocket <span class="fu">connect</span>(String ip)
        {
            IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Parse</span>(ip), ChatSetting.<span class="fu">port</span>);

            Socket socket = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);
            socket.<span class="fu">Connect</span>(ipep);
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">ChatSocket</span>(socket);
        }

        <span class="kw">public</span> Thread <span class="fu">newListener</span>(StrHandler pHandler)
        {
            inHandler = pHandler;

            Thread listenThread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(listen));
            listenThread.<span class="fu">Start</span>();
            <span class="kw">return</span> listenThread;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">listen</span>()
        {
            <span class="kw">try</span>
            {
                <span class="kw">while</span> (<span class="kw">true</span>)
                {
                    String line = <span class="fu">receive</span>();
                    <span class="fu">inHandler</span>(line);
                }
            }
            <span class="kw">catch</span> (Exception ex)
            {
                isDead = <span class="kw">true</span>;
                Console.<span class="fu">WriteLine</span>(ex.<span class="fu">Message</span>);
            }
        }
    }
}</code></pre>
<p>檔案：ChattingServer.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="co">// ------------------------- ChatServer.cs -------------------</span>
<span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;

<span class="kw">namespace</span> ChattingRoom
{
    <span class="kw">public</span> <span class="kw">class</span> ChatServer
    {
        List&lt;ChatSocket&gt; clientList = <span class="kw">new</span> List&lt;ChatSocket&gt;();

        <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
        {
            ChatServer chatServer = <span class="kw">new</span> <span class="fu">ChatServer</span>();
            chatServer.<span class="fu">run</span>();
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>()
        {
            IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, ChatSetting.<span class="fu">port</span>);

            Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);

            newsock.<span class="fu">Bind</span>(ipep);
            newsock.<span class="fu">Listen</span>(<span class="dv">10</span>);

            <span class="kw">while</span> (<span class="kw">true</span>)
            {
                Socket socket = newsock.<span class="fu">Accept</span>();
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;接受一個新連線!&quot;</span>);
                ChatSocket client = <span class="kw">new</span> <span class="fu">ChatSocket</span>(socket);
                <span class="kw">try</span>
                {
                    clientList.<span class="fu">Add</span>(client);
                    client.<span class="fu">newListener</span>(processMsgComeIn);
                }
                <span class="kw">catch</span>
                {
                }
<span class="co">//                clientList.Remove(client);</span>
            }
            <span class="co">//    newsock.Close();</span>
        }

        <span class="kw">public</span> String <span class="fu">processMsgComeIn</span>(String msg)
        {
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;收到訊息：&quot;</span>+msg);
            <span class="fu">broadCast</span>(msg);
            <span class="kw">return</span> <span class="st">&quot;OK&quot;</span>;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">broadCast</span>(String msg)
        {
            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;廣播訊息給 &quot;</span> + msg+<span class="st">&quot; 線上使用者共&quot;</span>+clientList.<span class="fu">Count</span>+<span class="st">&quot;個人!&quot;</span>);
            <span class="kw">foreach</span> (ChatSocket client <span class="kw">in</span> clientList)
            {
         <span class="kw">if</span> (!client.<span class="fu">isDead</span>) {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Send to &quot;</span>+client.<span class="fu">remoteEndPoint</span>.<span class="fu">ToString</span>()+<span class="st">&quot;:&quot;</span>+msg);
         client.<span class="fu">send</span>(msg);
         }
            }
        }
    }
}</code></pre>
<p>檔案：FormChatClient.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="co">// ------------------------- FormChatClient.cs -------------------</span>
<span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Data</span>;
<span class="kw">using</span> System.<span class="fu">Drawing</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> ChattingRoom
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> FormChatClient : Form
    {
        ChatSocket client;
        StrHandler msgHandler;

        <span class="kw">public</span> <span class="fu">FormChatClient</span>()
        {
            <span class="fu">InitializeComponent</span>();

            msgHandler = <span class="kw">this</span>.<span class="fu">addMsg</span>;
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonSend_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            <span class="fu">sendMsg</span>();
        }
        
        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">textBoxMsg_KeyPress</span>(<span class="dt">object</span> sender, KeyPressEventArgs e)
        {
         <span class="kw">if</span> (e.<span class="fu">KeyChar</span> == <span class="ch">&#39;\r&#39;</span>)
         <span class="fu">sendMsg</span>();
        }

        <span class="kw">public</span> String <span class="fu">user</span>() {
            <span class="kw">return</span> textBoxUser.<span class="fu">Text</span>.<span class="fu">Trim</span>();
        }

        <span class="kw">public</span> String <span class="fu">msg</span>() {
            <span class="kw">return</span> textBoxMsg.<span class="fu">Text</span>;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">sendMsg</span>()
        {
            <span class="kw">if</span> (<span class="fu">user</span>().<span class="fu">Length</span> == <span class="dv">0</span>)
            {
                MessageBox.<span class="fu">Show</span>(<span class="st">&quot;請輸入使用者名稱!&quot;</span>);
                <span class="kw">return</span>;
            }
            <span class="kw">if</span> (client == <span class="kw">null</span>) {
                client = ChatSocket.<span class="fu">connect</span>(ChatSetting.<span class="fu">serverIp</span>);
                client.<span class="fu">newListener</span>(processMsgComeIn);
                client.<span class="fu">send</span>(<span class="fu">user</span>() + <span class="st">&quot; : 新使用者進入!&quot;</span>);
                textBoxUser.<span class="fu">Enabled</span> = <span class="kw">false</span>;
            }
            <span class="kw">if</span> (<span class="fu">msg</span>().<span class="fu">Length</span> &gt; <span class="dv">0</span>) {
                client.<span class="fu">send</span>(<span class="fu">user</span>()+<span class="st">&quot; : &quot;</span>+<span class="fu">msg</span>());
         textBoxMsg.<span class="fu">Text</span> = <span class="st">&quot;&quot;</span>;
         }
        }

        <span class="kw">public</span> String <span class="fu">processMsgComeIn</span>(String msg)
        {
            <span class="kw">this</span>.<span class="fu">Invoke</span>(msgHandler, <span class="kw">new</span> Object[] { msg });
            <span class="kw">return</span> <span class="st">&quot;OK&quot;</span>;
        }

        <span class="kw">public</span> String <span class="fu">addMsg</span>(String msg)
        {
            richTextBoxBoard.<span class="fu">AppendText</span>(msg + <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);
            <span class="kw">return</span> <span class="st">&quot;OK&quot;</span>;
        }
    }
}</code></pre>
<p>檔案：FormChatClient.Designer.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="co">// ------------------------- FormChatClient.Designer.cs ----------</span>
<span class="kw">namespace</span> ChattingRoom
{
    <span class="kw">partial</span> <span class="kw">class</span> FormChatClient
    {
        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// 設計工具所需的變數。</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">private</span> System.<span class="fu">ComponentModel</span>.<span class="fu">IContainer</span> components = <span class="kw">null</span>;

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// 清除任何使用中的資源。</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">&quot;disposing&quot;</span><span class="kw">&gt;</span><span class="co">如果應該公開 Managed 資源則為 true，否則為 false。</span><span class="kw">&lt;/param&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Dispose</span>(<span class="dt">bool</span> disposing)
        {
            <span class="kw">if</span> (disposing &amp;&amp; (components != <span class="kw">null</span>))
            {
                components.<span class="fu">Dispose</span>();
            }
            <span class="kw">base</span>.<span class="fu">Dispose</span>(disposing);
        }

        <span class="dv">#region Windows Form 設計工具產生的程式碼</span>

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// 此為設計工具支援所需的方法 - 請勿使用程式碼編輯器修改這個方法的內容。</span>
        <span class="co">///</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeComponent</span>()
        {
            <span class="kw">this</span>.<span class="fu">panelInput</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span>();
            <span class="kw">this</span>.<span class="fu">labelSaid</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Label</span>();
            <span class="kw">this</span>.<span class="fu">textBoxUser</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">TextBox</span>();
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">TextBox</span>();
            <span class="kw">this</span>.<span class="fu">buttonSend</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Button</span>();
            <span class="kw">this</span>.<span class="fu">panelPadding1</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span>();
            <span class="kw">this</span>.<span class="fu">panelMsg</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span>();
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span> = <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">RichTextBox</span>();
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">SuspendLayout</span>();
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">SuspendLayout</span>();
            <span class="kw">this</span>.<span class="fu">SuspendLayout</span>();
            <span class="co">// </span>
            <span class="co">// panelInput</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">labelSaid</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">textBoxUser</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">textBoxMsg</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">buttonSend</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">panelPadding1</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Dock</span> = System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">DockStyle</span>.<span class="fu">Bottom</span>;
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">0</span>, <span class="dv">283</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Name</span> = <span class="st">&quot;panelInput&quot;</span>;
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">494</span>, <span class="dv">64</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">TabIndex</span> = <span class="dv">0</span>;
            <span class="co">// </span>
            <span class="co">// labelSaid</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">AutoSize</span> = <span class="kw">true</span>;
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">Font</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Font</span>(<span class="st">&quot;DFKai-SB&quot;</span>, <span class="fl">15.</span>75F, System.<span class="fu">Drawing</span>.<span class="fu">FontStyle</span>.<span class="fu">Regular</span>, System.<span class="fu">Drawing</span>.<span class="fu">GraphicsUnit</span>.<span class="fu">Point</span>, ((<span class="dt">byte</span>)(<span class="dv">136</span>)));
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">94</span>, <span class="dv">17</span>);
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">Name</span> = <span class="st">&quot;labelSaid&quot;</span>;
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">54</span>, <span class="dv">21</span>);
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">TabIndex</span> = <span class="dv">4</span>;
            <span class="kw">this</span>.<span class="fu">labelSaid</span>.<span class="fu">Text</span> = <span class="st">&quot;說：&quot;</span>;
            <span class="co">// </span>
            <span class="co">// textBoxUser</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">textBoxUser</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">3</span>, <span class="dv">17</span>);
            <span class="kw">this</span>.<span class="fu">textBoxUser</span>.<span class="fu">Name</span> = <span class="st">&quot;textBoxUser&quot;</span>;
            <span class="kw">this</span>.<span class="fu">textBoxUser</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">88</span>, <span class="dv">22</span>);
            <span class="kw">this</span>.<span class="fu">textBoxUser</span>.<span class="fu">TabIndex</span> = <span class="dv">3</span>;
            <span class="co">// </span>
            <span class="co">// textBoxMsg</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">154</span>, <span class="dv">17</span>);
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span>.<span class="fu">Name</span> = <span class="st">&quot;textBoxMsg&quot;</span>;
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">250</span>, <span class="dv">22</span>);
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span>.<span class="fu">TabIndex</span> = <span class="dv">2</span>;
            <span class="kw">this</span>.<span class="fu">textBoxMsg</span>.<span class="fu">KeyPress</span> += <span class="kw">new</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">KeyPressEventHandler</span>(<span class="kw">this</span>.<span class="fu">textBoxMsg_KeyPress</span>);
            <span class="co">// </span>
            <span class="co">// buttonSend</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">410</span>, <span class="dv">14</span>);
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">Name</span> = <span class="st">&quot;buttonSend&quot;</span>;
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">81</span>, <span class="dv">28</span>);
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">TabIndex</span> = <span class="dv">1</span>;
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">Text</span> = <span class="st">&quot;送出&quot;</span>;
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">UseVisualStyleBackColor</span> = <span class="kw">true</span>;
            <span class="kw">this</span>.<span class="fu">buttonSend</span>.<span class="fu">Click</span> += <span class="kw">new</span> System.<span class="fu">EventHandler</span>(<span class="kw">this</span>.<span class="fu">buttonSend_Click</span>);
            <span class="co">// </span>
            <span class="co">// panelPadding1</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">panelPadding1</span>.<span class="fu">Dock</span> = System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">DockStyle</span>.<span class="fu">Bottom</span>;
            <span class="kw">this</span>.<span class="fu">panelPadding1</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">0</span>, <span class="dv">48</span>);
            <span class="kw">this</span>.<span class="fu">panelPadding1</span>.<span class="fu">Name</span> = <span class="st">&quot;panelPadding1&quot;</span>;
            <span class="kw">this</span>.<span class="fu">panelPadding1</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">494</span>, <span class="dv">16</span>);
            <span class="kw">this</span>.<span class="fu">panelPadding1</span>.<span class="fu">TabIndex</span> = <span class="dv">0</span>;
            <span class="co">// </span>
            <span class="co">// panelMsg</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>);
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">Dock</span> = System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">DockStyle</span>.<span class="fu">Fill</span>;
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">0</span>, <span class="dv">0</span>);
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">Name</span> = <span class="st">&quot;panelMsg&quot;</span>;
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">494</span>, <span class="dv">283</span>);
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">TabIndex</span> = <span class="dv">1</span>;
            <span class="co">// </span>
            <span class="co">// richTextBoxBoard</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">Dock</span> = System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">DockStyle</span>.<span class="fu">Fill</span>;
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">Location</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Point</span>(<span class="dv">0</span>, <span class="dv">0</span>);
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">Name</span> = <span class="st">&quot;richTextBoxBoard&quot;</span>;
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">Size</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">494</span>, <span class="dv">283</span>);
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">TabIndex</span> = <span class="dv">0</span>;
            <span class="kw">this</span>.<span class="fu">richTextBoxBoard</span>.<span class="fu">Text</span> = <span class="st">&quot;&quot;</span>;
            <span class="co">// </span>
            <span class="co">// FormChatClient</span>
            <span class="co">// </span>
            <span class="kw">this</span>.<span class="fu">AutoScaleDimensions</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">SizeF</span>(6F, 12F);
            <span class="kw">this</span>.<span class="fu">AutoScaleMode</span> = System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">AutoScaleMode</span>.<span class="fu">Font</span>;
            <span class="kw">this</span>.<span class="fu">ClientSize</span> = <span class="kw">new</span> System.<span class="fu">Drawing</span>.<span class="fu">Size</span>(<span class="dv">494</span>, <span class="dv">347</span>);
            <span class="kw">this</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">panelMsg</span>);
            <span class="kw">this</span>.<span class="fu">Controls</span>.<span class="fu">Add</span>(<span class="kw">this</span>.<span class="fu">panelInput</span>);
            <span class="kw">this</span>.<span class="fu">Name</span> = <span class="st">&quot;FormChatClient&quot;</span>;
            <span class="kw">this</span>.<span class="fu">Text</span> = <span class="st">&quot;C# 聊天室&quot;</span>;
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">ResumeLayout</span>(<span class="kw">false</span>);
            <span class="kw">this</span>.<span class="fu">panelInput</span>.<span class="fu">PerformLayout</span>();
            <span class="kw">this</span>.<span class="fu">panelMsg</span>.<span class="fu">ResumeLayout</span>(<span class="kw">false</span>);
            <span class="kw">this</span>.<span class="fu">ResumeLayout</span>(<span class="kw">false</span>);

        }

        <span class="dv">#endregion</span>

        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span> panelInput;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span> panelMsg;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">TextBox</span> textBoxMsg;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Button</span> buttonSend;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Panel</span> panelPadding1;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">RichTextBox</span> richTextBoxBoard;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">Label</span> labelSaid;
        <span class="kw">private</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>.<span class="fu">TextBox</span> textBoxUser;
    }
}</code></pre>
<p>檔案：Program.cs (主程式)</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> ChattingRoom
{
    <span class="kw">static</span> <span class="kw">class</span> Program
    {
        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// 應用程式的主要進入點。</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        [STAThread]
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
        {
            Application.<span class="fu">EnableVisualStyles</span>();
            Application.<span class="fu">SetCompatibleTextRenderingDefault</span>(<span class="kw">false</span>);
            Application.<span class="fu">Run</span>(<span class="kw">new</span> <span class="fu">FormChatClient</span>());
            Application.<span class="fu">Exit</span>();
        }
    }
}</code></pre>
<h1 id="c-網路程式http-程式設計-1----server"><a href="#c-網路程式http-程式設計-1----server">C# 網路程式：HTTP 程式設計 (1) -- Server</a></h1>
<h2 id="http-協定簡介"><a href="#http-協定簡介">HTTP 協定簡介</a></h2>
<p>HTTP 協定是 Web 的基礎，Web 是一個典型的 Client-Server 架構，主要由 HTTP+URL+HTML 所組成。</p>
<p>Web Server (網站伺服器) 是 WWW 網路的基礎， 1991 年 Tim Burner Lee 發明 HTML 與 URL 後，就自己寫了第一個 Web Server，導至後來 Web 網路的興起，因此、Tim Burner Lee被尊稱為 WWW 之父，然而、對於一般程式設計人員而言， Web Server 的設計方法卻是個難解的謎，本篇文章將以一個簡單而完整的 Java 程式，讓大家了解 Web Server 的設計原理。</p>
<p>一個最簡單的 Web Server 之功能包含下列三個步驟:</p>
<ul>
<li>步驟一 : 接收瀏覽器所傳來的網址。</li>
<li>步驟二 : 取出相對應的檔案。</li>
<li>步驟三 : 將檔案內容傳回給瀏覽器。</li>
</ul>
<p>然而、在這個接收與傳回的過程中，所有的資訊都必須遵照固定的格式，規範這個接收/傳送格式的協定，稱為超文字傳送協定 (Hyper Text Transfer Protocol)，簡稱為 HTTP 協定。</p>
<p>HTTP 協定格式的基礎，乃是建構在網址 URL 上的傳輸方式，早期只能用來傳送簡單的 HTML 檔案，後來經擴充後也可以傳送 其他類型的檔案，包含 影像、動畫、簡報、Word 文件等。</p>
<p>在本文中，我們將先簡介 HTTP 協定的訊息內容，然後在介紹如何以 Java 語言實作 HTTP 協定，以建立一個簡單的 Web Server。</p>
<p>HTTP 表頭：</p>
<p>當你在瀏覽器上打上網址(URL)後，瀏覽器會傳出一個HTTP訊息給對應的 Web Server，Web Server 再接收到這個訊息後， 根據網址取出對應的檔案，並將該檔案以 HTTP 格式的訊息傳回給瀏覽器，以下是這個過程的一個範例。</p>
<p>豬小弟上網，在瀏覽器中打上 http://ccc.kmit.edu.tw/index.htm，於是、瀏覽器傳送下列訊息給 ccc.kmit.edu.tw 這台電腦。</p>
<pre><code>GET /index.htm HTTP/1.0
Accept: image/gif, image/jpeg, application/msword, */*
Accept-Language: zh-tw
User-Agent: Mozilla/4.0
Content-Length: 
Host: ccc.kmit.edu.tw
Cache-Control: max-age=259200
Connection: keep-alive
</code></pre>
<p>當 ccc.kmit.edu.tw 電腦上的 Web Server 程式收到上述訊息後，會取出指定的路徑 /index.htm ，然後根據預設的網頁根目錄 (假設為 c:)，合成一個 c:.htm 的絕對路徑，接著從磁碟機中取出該檔案，並傳回下列訊息給豬小弟的瀏覽器。</p>
<pre><code>HTTP/1.0 200 OK
Content-Type: text/html
Content-Length: 438

&lt;html&gt;
  ....
&lt;/html&gt;</code></pre>
<p>其中第一行 HTTP/1.0 200 OK 代表該網頁被成功傳回，第二行 Content-Type: text/html 代表傳回文件為 HTML 檔案， Content-Length: 438 代表該 HTML 檔案的大小為 438 位元組。</p>
<h2 id="helloserver-永遠傳回-hello-的-webserver"><a href="#helloserver-永遠傳回-hello-的-webserver">HelloServer: 永遠傳回 Hello 的 WebServer</a></h2>
<p>檔案 HelloServer.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;

<span class="kw">public</span> <span class="kw">class</span> HttpServer
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
    {
        IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, <span class="dv">80</span>);

        Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);

        newsock.<span class="fu">Bind</span>(ipep);
        newsock.<span class="fu">Listen</span>(<span class="dv">10</span>);
    
        <span class="kw">while</span>(<span class="kw">true</span>)
        {
         Socket client = newsock.<span class="fu">Accept</span>();
         IPEndPoint clientep = (IPEndPoint) client.<span class="fu">RemoteEndPoint</span>;
        
         <span class="co">// create a new thread and then receive message.</span>
         HttpListener listener = <span class="kw">new</span> <span class="fu">HttpListener</span>(client);
         Thread thread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(listener.<span class="fu">run</span>));
         thread.<span class="fu">Start</span>();
        }
<span class="co">//    newsock.Close();</span>
   }
}

<span class="kw">public</span> <span class="kw">class</span> HttpListener {
    Socket socket;

    <span class="kw">public</span> <span class="fu">HttpListener</span>(Socket s)
    {
        socket = s;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() 
    {
        String msg = <span class="st">&quot;Hello!&quot;</span>;
        String helloMsg = @<span class="st">&quot;HTTP/1.0 200 OK</span><span class="ch">\n</span><span class="st">Content-Type: text/plain</span><span class="ch">\n</span><span class="st">Contgent-Length: &quot;</span>+msg.<span class="fu">Length</span>+<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>+msg;

        NetworkStream stream = <span class="kw">new</span> <span class="fu">NetworkStream</span>(socket);
        StreamReader reader = <span class="kw">new</span> <span class="fu">StreamReader</span>(stream);
        String header = <span class="st">&quot;&quot;</span>;
        <span class="kw">while</span> (<span class="kw">true</span>) 
        {
         String line = reader.<span class="fu">ReadLine</span>();
         Console.<span class="fu">WriteLine</span>(line);
         <span class="kw">if</span> (line.<span class="fu">Trim</span>().<span class="fu">Length</span>==<span class="dv">0</span>)
         <span class="kw">break</span>;
         header += line+<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>;
        }
        socket.<span class="fu">Send</span>(Encoding.<span class="fu">UTF8</span>.<span class="fu">GetBytes</span>(helloMsg));
        socket.<span class="fu">Close</span>();
    }
}</code></pre>
<h2 id="完整的-web-server"><a href="#完整的-web-server">完整的 Web Server</a></h2>
<p>專案程式下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/WebServer.zip">https://dl.dropbox.com/u/101584453/cs/code/WebServer.zip</a></p>
<p>請注意：此範例必須在專案中加入 System.Web 套件引用。</p>
<p>根據 HTTP 協定，我們以 C# 實作了一個 Web Server 程式 (WebServer.cs)，該程式是利用一個稱為 Socket 的物件來實作的，這個物件位於 C# 的網路函式庫 System.Net 中。</p>
<p>Socket 是根據博克萊 (U.C.Berkley) 大學早期發展的 Socket 概念寫成的，其設計理念是是將網路傳輸類比成檔案讀取與寫入 (傳送的動作被視為是寫入/接收的動作被視為是讀取)，如此、傳送與接收就簡化為程式人員比較容易懂的 讀取與寫入，降低了網路程式的學習困難度。</p>
<p>要使用 Socket 的方式寫網路程式，首先要登記網路的埠號 (port)，將該 port 占領下來，以防止其他程式使用該 port 而互相干擾，HTTP 協定所預設使用的是 port 80。</p>
<p>一但完成登記，就可以開始接受瀏覽器的請求，並根據請求回傳檔案訊息，以下程式為其 (接收/傳送) 程序的核心程式。</p>
<p>這個最簡單版以 Socket 的方式，不斷讀取資料直到發現有一空白行即結束，然而、這樣的程式是過度簡化的結果，無法處理有 POST 訊息的狀況，然而、何謂 POST 訊息呢 ?</p>
<p>所謂 POST 訊息、乃是 HTML 為了傳遞較大量的填表資料，所發展出來的一種訊息格式，以下是POST訊息的一個範例：</p>
<pre><code>POST /getMsg.asp HTTP/1.0
Accept: image/gif, image/jpeg, application/msword, */*
Accept-Language: zh-tw
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/4.0
Content-Length: 66
Host: ccc.kmit.edu.tw
Cache-Control: max-age=259200
Connection: keep-alive

user=ccc&amp;password=1234&amp;msg=Hello+%21+%0D%0AHow+are+you+%21%0D%0A++</code></pre>
<p>其中的HTTP的訊息開頭以 POST 取代原來的 GET ，並且多了一個 Content-Length:66 的欄位，該欄位指示了訊息結尾會有 66 個位元組的填表資料，這些資料會被編碼成特輸的格式以利在網路上傳遞。</p>
<p>一但取得了瀏覽器傳來的 GET 或 POST 訊息後，我們就可以根據其訊息，決定回應的方式，在 WebServer.java 中，我們只是單純的將對應的檔案取出，並附在回應的訊息表頭後傳回，其程式碼如下。</p>
<p>以上就是 Web Server 的簡單設計方式，若想了解更多細節，請直接閱讀 WebServer.java 檔並執行之，執行時請安裝好 Visual Studio 後，並於 WebServer.cs 的存檔路徑上打 csc WebServer.cs, 之後再打 WebServer 即可啟動，其執行畫面如下：</p>
<p>檔案： WebServer.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Sockets</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">Threading</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Web</span>;

<span class="kw">public</span> <span class="kw">class</span> WebServer
{
   <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
   {
      IPEndPoint ipep = <span class="kw">new</span> <span class="fu">IPEndPoint</span>(IPAddress.<span class="fu">Any</span>, <span class="dv">8085</span>);

      Socket newsock = <span class="kw">new</span> <span class="fu">Socket</span>(AddressFamily.<span class="fu">InterNetwork</span>, SocketType.<span class="fu">Stream</span>, ProtocolType.<span class="fu">Tcp</span>);

      newsock.<span class="fu">Bind</span>(ipep);
      newsock.<span class="fu">Listen</span>(<span class="dv">10</span>);

      <span class="kw">while</span>(<span class="kw">true</span>)
      {
         Socket client = newsock.<span class="fu">Accept</span>();
         IPEndPoint clientep = (IPEndPoint) client.<span class="fu">RemoteEndPoint</span>;

         <span class="co">// create a new thread and then receive message.</span>
         HttpListener listener = <span class="kw">new</span> <span class="fu">HttpListener</span>(client);
         Thread thread = <span class="kw">new</span> <span class="fu">Thread</span>(<span class="kw">new</span> <span class="fu">ThreadStart</span>(listener.<span class="fu">run</span>));
         thread.<span class="fu">Start</span>();
      }
   }
}

<span class="kw">class</span> HttpListener 
{
    String[] map ={<span class="st">&quot;mpeg=video/mpeg&quot;</span>, <span class="st">&quot;mpg=video/mpeg&quot;</span>, <span class="st">&quot;wav=audio/x-wav&quot;</span>, <span class="st">&quot;jpg=image/jpeg&quot;</span>, 
<span class="st">&quot;gif=image/gif&quot;</span>, <span class="st">&quot;zip=application/zip&quot;</span>, <span class="st">&quot;pdf=application/pdf&quot;</span>, <span class="st">&quot;xls=application/vnd.ms-excel&quot;</span>, 
<span class="st">&quot;ppt=application/vnd.ms-powerpoint&quot;</span>, <span class="st">&quot;doc=application/msword&quot;</span>, <span class="st">&quot;htm=text/html&quot;</span>, 
<span class="st">&quot;html=text/html&quot;</span>, <span class="st">&quot;css=text/plain&quot;</span>, <span class="st">&quot;vbs=text/plain&quot;</span>, <span class="st">&quot;js=text/plain&quot;</span>, <span class="st">&quot;txt=text/plain&quot;</span>, 
<span class="st">&quot;java=text/plain&quot;</span>};
    Socket socket;
    NetworkStream stream;
    String header;
    String root = <span class="st">&quot;.&quot;</span>;

    <span class="kw">public</span> <span class="fu">HttpListener</span>(Socket s)
    {
        socket = s;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() 
    {
        stream = <span class="kw">new</span> <span class="fu">NetworkStream</span>(socket);
        <span class="fu">request</span>();
        <span class="fu">response</span>();
        stream.<span class="fu">Close</span>();
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">send</span>(String str) {
        socket.<span class="fu">Send</span>(Encoding.<span class="fu">UTF8</span>.<span class="fu">GetBytes</span>(str));
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">innerText</span>(String pText, String beginMark, String endMark)
    {
        <span class="dt">int</span> beginStart = pText.<span class="fu">IndexOf</span>(beginMark);
        <span class="kw">if</span> (beginStart &lt; <span class="dv">0</span>) <span class="kw">return</span> <span class="kw">null</span>;
        <span class="dt">int</span> beginEnd = beginStart + beginMark.<span class="fu">Length</span>;
        <span class="dt">int</span> endStart = pText.<span class="fu">IndexOf</span>(endMark, beginEnd);
        <span class="kw">if</span> (endStart &lt; <span class="dv">0</span>) <span class="kw">return</span> <span class="kw">null</span>;
        <span class="kw">return</span> pText.<span class="fu">Substring</span>(beginEnd, endStart - beginEnd);
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">request</span>()
    {
        <span class="kw">try</span> {
         StreamReader reader = <span class="kw">new</span> <span class="fu">StreamReader</span>(stream);
         header = <span class="st">&quot;&quot;</span>;
         <span class="kw">while</span> (<span class="kw">true</span>)
         {
         String line = reader.<span class="fu">ReadLine</span>();
         Console.<span class="fu">WriteLine</span>(line);
         <span class="kw">if</span> (line.<span class="fu">Trim</span>().<span class="fu">Length</span> == <span class="dv">0</span>)
         <span class="kw">break</span>;
         header += line + <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>;
         }
        } <span class="kw">catch</span> {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;request error!&quot;</span>);
        }
    }

    <span class="dt">void</span> <span class="fu">response</span>() 
    {
      <span class="kw">try</span> 
      {
        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;========response()==========&quot;</span>);
        String path = <span class="fu">innerText</span>(header, <span class="st">&quot;GET &quot;</span>, <span class="st">&quot;HTTP/&quot;</span>).<span class="fu">Trim</span>(); <span class="co">// 取得檔案路徑 : GET 版。</span>
        HttpUtility.<span class="fu">UrlDecode</span>(path);
        String fullPath = root+path;
        FileInfo info = <span class="kw">new</span> <span class="fu">FileInfo</span>(fullPath);
        <span class="kw">if</span> (!info.<span class="fu">Exists</span>) 
            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>(<span class="st">&quot;File not found !&quot;</span>);
        <span class="fu">send</span>(<span class="st">&quot;HTTP/1.0 200 OK</span><span class="ch">\n</span><span class="st">&quot;</span>);
        <span class="fu">send</span>(<span class="st">&quot;Content-Type: &quot;</span>+<span class="fu">type</span>(fullPath)+<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);
        <span class="fu">send</span>(<span class="st">&quot;Content-Length: &quot;</span>+info.<span class="fu">Length</span>+<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);
        <span class="fu">send</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);
        <span class="dt">byte</span>[] buffer = <span class="kw">new</span> <span class="dt">byte</span>[<span class="dv">4096</span>];
        FileStream fileStream = File.<span class="fu">OpenRead</span>(fullPath);
        <span class="kw">while</span> (<span class="kw">true</span>) 
        {
            <span class="dt">int</span> len = fileStream.<span class="fu">Read</span>(buffer, <span class="dv">0</span>, buffer.<span class="fu">Length</span>);
            socket.<span class="fu">Send</span>(buffer, <span class="dv">0</span>, len, SocketFlags.<span class="fu">None</span>);
            <span class="kw">if</span> (len &lt; buffer.<span class="fu">Length</span>) <span class="kw">break</span>;
        }
        fileStream.<span class="fu">Close</span>();
      } <span class="kw">catch</span> {
        <span class="kw">try</span> {
         <span class="fu">send</span>(<span class="st">&quot;HTTP/1.0 404 Error</span><span class="ch">\n</span><span class="st">&quot;</span>);
         <span class="fu">send</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);
        } <span class="kw">catch</span> {
         Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Send Error Msg fail!&quot;</span>);
        }
      }
    }

    String <span class="fu">type</span>(String path)
    {
        String type = <span class="st">&quot;*/*&quot;</span>;
        path = path.<span class="fu">ToLower</span>();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; map.<span class="fu">Length</span>; i++)
        {
            String[] tokens = map[i].<span class="fu">Split</span>(&#39;=&#39;);
            String ext = tokens[<span class="dv">0</span>], mime = tokens[<span class="dv">1</span>];
            <span class="kw">if</span> (path.<span class="fu">EndsWith</span>(<span class="st">&quot;.&quot;</span> + ext)) type = mime;
        }
        <span class="kw">return</span> type;
    }
}</code></pre>
<h2 id="參考文獻-7"><a href="#參考文獻-7">參考文獻</a></h2>
<ul>
<li>How Java Web Servers Work - <a href="http://www.onjava.com/pub/a/onjava/2003/04/23/java_webserver.html">http://www.onjava.com/pub/a/onjava/2003/04/23/java_webserver.html</a></li>
<li>JDK API : java.net.ServerSocket - <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/net/ServerSocket.html">http://java.sun.com/j2se/1.4.2/docs/api/java/net/ServerSocket.html</a></li>
<li>Hypertext Transfer Protocol:HTTP/1.0 - <a href="http://www.w3.org/Protocols/HTTP/1.0/draft-ietf-http-spec.html">http://www.w3.org/Protocols/HTTP/1.0/draft-ietf-http-spec.html</a></li>
</ul>
<h1 id="c-網路程式http-程式設計-2----client"><a href="#c-網路程式http-程式設計-2----client">C# 網路程式：HTTP 程式設計 (2) -- Client</a></h1>
<h2 id="http-client-端程式簡介"><a href="#http-client-端程式簡介">HTTP Client 端程式簡介</a></h2>
<p>在 C# 當中，HTTP Client 端元件的主要物件有 WebClient 與 Browser 元件，其中的 WebClient 物件是一個單純用來下載網頁的程式，這樣的物件可以用來撰寫像 WebCrawler 這樣的搜尋引擎關鍵程式，用來抓取全世界的網頁。</p>
<p>有時我們需要將整個瀏覽器嵌入到視窗程式中，此時就可以使用 Browser 元件。事實上、Visual C# 當中的 Browser 元件就是 Internet Explorer (IE)，因此您可以很容易的用 Visual C# 做出類似 IE 的功能，並且與其他視窗程式進行互動。</p>
<h2 id="單一網頁下載"><a href="#單一網頁下載">單一網頁下載</a></h2>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>;

<span class="kw">class</span> PageDwnloader
{
    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        String text = <span class="fu">fileToText</span>(args[<span class="dv">0</span>]);
        String[] urls = text.<span class="fu">Split</span>(<span class="ch">&#39;\n&#39;</span>);
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; urls.<span class="fu">Length</span>; i++)
        {
         Console.<span class="fu">WriteLine</span>(i + <span class="st">&quot;:&quot;</span> + urls[i]);
         <span class="fu">UrlToFile</span>(urls[i], i+<span class="st">&quot;.htm&quot;</span>);
        }
<span class="co">//   Console.WriteLine(text);</span>
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">fileToText</span>(String filePath)
    {
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(filePath);
        String text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> text;
    }

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">UrlToFile</span>(String url, String file) {
        WebClient webclient = <span class="kw">new</span> <span class="fu">WebClient</span>();
        webclient.<span class="fu">DownloadFile</span>(<span class="st">&quot;http://&quot;</span>+url, file);
    }
}</code></pre>
<h2 id="網路爬蟲-webcrawler-的設計"><a href="#網路爬蟲-webcrawler-的設計">網路爬蟲 WebCrawler 的設計</a></h2>
<p>搜尋引擎是網際網路興起後最常被使用的工具之一，其主要技術包含前端的全文檢索與後端的網頁蒐集兩類，本文將介紹搜尋引擎後端的網頁蒐集技術 - 并且以 C# 語言實作一個100行左右的網頁蒐集程式 &quot;網路爬蟲 (Crawler)&quot;, 然後說明其製作方法與原理。</p>
<p>Google 等搜尋網站的背後，都有一個強大的網頁蒐集程式，可以將全世界的網頁通通抓回去儲存以便提供搜尋之用，這個程式就稱為 &quot;爬行者 (Crawler)&quot;，也有人索性稱為蜘蛛 (Spider)，因為這個就好像在網路上爬來爬去的蜘蛛一樣，到處抓網頁回家放。</p>
<p>Crawler 的設計原理，簡要來說是透過程式去追蹤網頁上的超連結，然後不斷往外擴張，以便將全世界中曾經被連結到的網頁全部都抓回到來，這也是 Google, Baidu, Bing, Yahoo 等網站背後最重要的程式之一。</p>
<p>要啟動 Crawler，首先要給一個起始點，以下的範例是利用台灣的 tw.msn.com 網站作為起始點，然後不斷透過「透過連結抓取網頁、取出連結再抓網頁」的方式擴展出去，以下是 Crawler 的核心程式。</p>
<p>每當抓到新的網頁時，我們繪將其存檔，然後抽取出其中所有的超連結，並將這些超連結放入等待抓取的網址庫中，以便下次可以抓取該網頁。</p>
<p>檔案：WebCrawler.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> System.<span class="fu">Net</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>.<span class="fu">RegularExpressions</span>;

<span class="kw">class</span> WebCrawler
{
<span class="co">//    WebProxy proxy = new WebProxy(&quot;http://proxy.internal:3128/&quot;, true);</span>
    List&lt;String&gt; urlList = <span class="kw">new</span> List&lt;String&gt;();
    <span class="co">// Dictionary&lt;String, String&gt; </span>

    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(String[] args)
    {
        WebCrawler crawler = <span class="kw">new</span> <span class="fu">WebCrawler</span>();
        crawler.<span class="fu">urlList</span>.<span class="fu">Add</span>(<span class="st">&quot;http://tw.msn.com/&quot;</span>);
        crawler.<span class="fu">craw</span>();
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">craw</span>()
    {
        <span class="dt">int</span> urlIdx = <span class="dv">0</span>;
        <span class="kw">while</span> (urlIdx &lt; urlList.<span class="fu">Count</span>)
        {
            <span class="kw">try</span>
            {
                String url = urlList[urlIdx];
                String fileName = <span class="st">&quot;data/&quot;</span> + <span class="fu">toFileName</span>(url);
                Console.<span class="fu">WriteLine</span>(urlIdx + <span class="st">&quot;:url=&quot;</span> + url + <span class="st">&quot; file=&quot;</span> + fileName);
                <span class="fu">urlToFile</span>(url, fileName);
                String html = <span class="fu">fileToText</span>(fileName);
                <span class="kw">foreach</span> (String childUrl <span class="kw">in</span> <span class="fu">matches</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">shref</span><span class="ch">\\</span><span class="st">s*=</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\&quot;</span><span class="st">(.*?)</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, html, <span class="dv">1</span>))
                {
                    Console.<span class="fu">WriteLine</span>(childUrl);
                    urlList.<span class="fu">Add</span>(childUrl);
                }
            }
            <span class="kw">catch</span>
            {
                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Error:&quot;</span> + urlList[urlIdx] + <span class="st">&quot; fail!&quot;</span>);
            }
            urlIdx++;
        }
    }

    <span class="kw">public</span> <span class="kw">static</span> IEnumerable <span class="fu">matches</span>(String pPattern, String pText, <span class="dt">int</span> pGroupId)
    {
        Regex r = <span class="kw">new</span> <span class="fu">Regex</span>(pPattern, RegexOptions.<span class="fu">IgnoreCase</span> | RegexOptions.<span class="fu">Compiled</span>);
        <span class="kw">for</span> (Match m = r.<span class="fu">Match</span>(pText); m.<span class="fu">Success</span>; m = m.<span class="fu">NextMatch</span>())
         <span class="kw">yield</span> <span class="kw">return</span> m.<span class="fu">Groups</span>[pGroupId].<span class="fu">Value</span>;
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">fileToText</span>(String filePath)
    {
        StreamReader file = <span class="kw">new</span> <span class="fu">StreamReader</span>(filePath);
        String text = file.<span class="fu">ReadToEnd</span>();
        file.<span class="fu">Close</span>();
        <span class="kw">return</span> text;
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">urlToFile</span>(String url, String file)
    {
        WebClient webclient = <span class="kw">new</span> <span class="fu">WebClient</span>();
<span class="co">//        webclient.Proxy = proxy;</span>
        webclient.<span class="fu">DownloadFile</span>(url, file);
    }

    <span class="kw">public</span> <span class="kw">static</span> String <span class="fu">toFileName</span>(String url)
    {
        String fileName = url.<span class="fu">Replace</span>(&#39;?&#39;, &#39;_&#39;);
        fileName = fileName.<span class="fu">Replace</span>(&#39;/&#39;, &#39;_&#39;);
        fileName = fileName.<span class="fu">Replace</span>(&#39;&amp;&#39;, &#39;_&#39;);
        fileName = fileName.<span class="fu">Replace</span>(&#39;:&#39;, &#39;_&#39;);
        fileName = fileName.<span class="fu">ToLower</span>();
        <span class="kw">if</span> (!fileName.<span class="fu">EndsWith</span>(<span class="st">&quot;.htm&quot;</span>) &amp;&amp; !fileName.<span class="fu">EndsWith</span>(<span class="st">&quot;.html&quot;</span>))
         fileName = fileName + <span class="st">&quot;.htm&quot;</span>;
        <span class="kw">return</span> fileName;
    }
}</code></pre>
<p>以上的 Crawler 是搜尋引擎中的關鍵技術，在本文中我們實作了一個簡單的 Crawler ，這個程式可以用來作為個人抓取網頁個工具程式，作為建立搜尋引擎的基礎。</p>
<h2 id="browser-的控制"><a href="#browser-的控制">Browser 的控制</a></h2>
<p>教學錄影： * C# 瀏覽器控制 1/3 -- <a href="http://youtu.be/CIwYabPN7qA">http://youtu.be/CIwYabPN7qA</a> * C# 瀏覽器控制 2/3 -- <a href="http://youtu.be/sJ6cfuL3-ZA">http://youtu.be/sJ6cfuL3-ZA</a> * C# 瀏覽器控制 3/3 -- <a href="http://youtu.be/YThlDxk-E7U">http://youtu.be/YThlDxk-E7U</a></p>
<p>專案程式下載：<a href="https://dl.dropbox.com/u/101584453/cs/code/WebBrowser.zip">https://dl.dropbox.com/u/101584453/cs/code/WebBrowser.zip</a></p>
<p>在 C# 當中控制 Internet Explorer (IE) 瀏覽器是一件很簡單的事情，因為 .NET framework 當中已經將 IE 的 WebBrowser 內建成一個控制元件，只要利用這個控制元件中的網址 (Url) 欄位，以及瀏覽 Navigate(url)、向前 GoForward()、向後 GoBack() 等函數，就可以輕鬆的控制瀏覽器元件的行為了。</p>
<p>檔案：WebBrowser.cs</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">ComponentModel</span>;
<span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;

<span class="kw">namespace</span> WindowsFormsApplication1
{
    <span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form
    {
        <span class="kw">public</span> <span class="fu">Form1</span>()
        {
            <span class="fu">InitializeComponent</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonPrev_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            webBrowser.<span class="fu">GoBack</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonNext_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            webBrowser.<span class="fu">GoForward</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">updateState</span>()
        {
            buttonPrev.<span class="fu">Enabled</span> = webBrowser.<span class="fu">CanGoBack</span>;
            buttonNext.<span class="fu">Enabled</span> = webBrowser.<span class="fu">CanGoForward</span>;
            <span class="kw">if</span> (webBrowser.<span class="fu">Url</span> != <span class="kw">null</span>)
                comboBoxUrl.<span class="fu">Text</span> = webBrowser.<span class="fu">Url</span>.<span class="fu">ToString</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">buttonGo_Click</span>(<span class="dt">object</span> sender, EventArgs e)
        {
            webBrowser.<span class="fu">Navigate</span>(comboBoxUrl.<span class="fu">Text</span>);
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">webBrowser_Navigated</span>(<span class="dt">object</span> sender, WebBrowserNavigatedEventArgs e)
        {
            <span class="fu">updateState</span>();
        }

        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">comboBoxUrl_KeyDown</span>(<span class="dt">object</span> sender, KeyEventArgs e)
        {
            <span class="kw">if</span> (e.<span class="fu">KeyCode</span> == Keys.<span class="fu">Enter</span>)
                webBrowser.<span class="fu">Navigate</span>(comboBoxUrl.<span class="fu">Text</span>);
        }
    }
}</code></pre>
<p>您可以看到在 Visual C# 當中使用瀏覽器元件事非常容易的事情，這樣的功能可以讓您在應用程裏輕易的嵌入瀏覽器以便讓使用者看到某些網頁，讓 Web 程式的開發變得輕鬆且愉快。</p>
<h1 id="c-遊戲程式xna-遊戲引擎"><a href="#c-遊戲程式xna-遊戲引擎">C# 遊戲程式：XNA 遊戲引擎</a></h1>
<h2 id="xna-遊戲程式架構"><a href="#xna-遊戲程式架構">XNA 遊戲程式架構</a></h2>
<p>XNA 是微軟於 2007 年推出的遊戲設計引擎，以 C# 為主要語言。因此，您可以輕易的用 C# 在 Visual Studio 的 XNA 開發工具中撰寫 2D、3D 電腦遊戲。</p>
<p>XNA 所撰寫的遊戲可以在 MS. Windows 的電腦中，或者是 XBOX 遊戲機中使用，最近微軟更將 XNA 加入到 Window Phone 7 版中，讓手機也納入到 XNA 所支援的平台中。</p>
<p>大部分對 XNA 有興趣的人都會將焦點放在 3D 遊戲上，而這也正是 XNA 最強最好用的地方，用 XNA 寫 3D 遊戲其實相當簡單，其難度與 2D 遊戲差不多。</p>
<p>一個 XNA 的遊戲，是一個繼承 Microsoft.Xna.Framework.Game 這個類別的程式，其架構大致如下。</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">public</span> <span class="kw">class</span> MyGame : Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Game</span> 
{
        GraphicsDeviceManager graphics; <span class="co">// 繪圖裝置管理器</span>
        GamePadState previousState; <span class="co">// XBOX 的按鈕狀態</span>
<span class="kw">#if</span> !XBOX
        KeyboardState previousKeyboardState;      <span class="co">// 個人電腦的鍵盤狀態。</span>
<span class="kw">#endif</span>
        GameObject gameObj = <span class="kw">null</span>;  <span class="co">// 模型物件</span>
        SoundEffect sound = <span class="kw">null</span>; <span class="co">// 音效物件</span>
        ...

        <span class="kw">public</span> <span class="fu">GameMain</span>()
        {
            graphics = <span class="kw">new</span> <span class="fu">GraphicsDeviceManager</span>(<span class="kw">this</span>);
            Content.<span class="fu">RootDirectory</span> = <span class="st">&quot;Content&quot;</span>;
        }

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Initialize</span>() <span class="co">// 初始化</span>
        {
            camera = <span class="kw">new</span> <span class="fu">Camera</span>(<span class="kw">this</span>);
            <span class="kw">this</span>.<span class="fu">Components</span>.<span class="fu">Add</span>(camera);
            <span class="kw">base</span>.<span class="fu">Initialize</span>();
        }

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">LoadContent</span>()
        {
            gameObj.<span class="fu">model</span> = Content.<span class="fu">Load</span>&lt;Model&gt;(<span class="st">&quot;MyModel&quot;</span>); <span class="co">// 載入模型</span>
            gameObj.<span class="fu">scale</span> = <span class="fl">0.</span>1f; <span class="co">// 設定放大倍率</span>
            gameObj.<span class="fu">position</span> = <span class="kw">new</span> <span class="fu">Vector3</span>(<span class="fl">0.</span>0f, <span class="fl">0.</span>0f, -<span class="fl">10.</span>0f); <span class="co">// 設定起始位置</span>
            ...
        }

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime)
        {
           <span class="co">// 1. 偵測鍵盤或滑鼠，根據輸入決定主角如何移動。</span>
            <span class="kw">if</span> (GamePad.<span class="fu">GetState</span>(PlayerIndex.<span class="fu">One</span>).<span class="fu">Buttons</span>.<span class="fu">Back</span> == ButtonState.<span class="fu">Pressed</span>)
                <span class="kw">this</span>.<span class="fu">Exit</span>();

            KeyboardState keyboardState = Keyboard.<span class="fu">GetState</span>();  <span class="co">//得到目前鍵盤每一個按鍵的狀況</span>
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Space</span>) &amp;&amp; previousKeyboardState.<span class="fu">IsKeyUp</span>(Keys.<span class="fu">Space</span>))
            { 
               <span class="co">// 當空白鍵被按下時，...</span>
            }

           <span class="co">// 2. 移動物件</span>
           gameObj.<span class="fu">position</span> += gameObj.<span class="fu">velocity</span>;

           <span class="co">// 3. 播放聲音</span>
           <span class="kw">if</span> (...)  explodeSound.<span class="fu">Play</span>();

           <span class="co">// 4. 呼叫基礎類別的 Update() 函數。</span>
            <span class="kw">base</span>.<span class="fu">Update</span>(gameTime);
        }

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Draw</span>(GameTime gameTime)
        {
            GraphicsDevice.<span class="fu">Clear</span>(Color.<span class="fu">CornflowerBlue</span>);

            gameObj.<span class="fu">Draw</span>(camera);

            <span class="kw">base</span>.<span class="fu">Draw</span>(gameTime);
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Draw</span>(Model model)
        {
            <span class="kw">foreach</span> (ModelMesh mesh <span class="kw">in</span> model.<span class="fu">Meshes</span>)
            {
                <span class="kw">foreach</span> (BasicEffect effect <span class="kw">in</span> mesh.<span class="fu">Effects</span>)
                {
                    effect.<span class="fu">EnableDefaultLighting</span>();
                    effect.<span class="fu">PreferPerPixelLighting</span> = <span class="kw">true</span>;

                    effect.<span class="fu">World</span> =
                        Matrix.<span class="fu">CreateFromYawPitchRoll</span>(
                        rotation.<span class="fu">Y</span>,
                        rotation.<span class="fu">X</span>,
                        rotation.<span class="fu">Z</span>) *

                        Matrix.<span class="fu">CreateScale</span>(scale) *

                        Matrix.<span class="fu">CreateTranslation</span>(position);

                    effect.<span class="fu">Projection</span> = camera.<span class="fu">projection</span>;
                    effect.<span class="fu">View</span> = camera.<span class="fu">view</span>;
                }
                mesh.<span class="fu">Draw</span>();
            }
        }
    }</code></pre>
<p>在以上的程式架構中，<code>MyGame : Microsoft.Xna.Framework.Game</code> 這行程式宣告 MyGame 繼承 Xna.Framework.Game 這個類別，這是所有 XNA 程式共同的起點。透過這樣的繼承關係，MyGame 就只要實作 XNA 遊戲需要實作的部份，其餘的邏輯就由 Xna.Framework 幫我們處理掉了，於是、我們就只要實作以下的幾個函數，就能讓 XNA 遊戲運作起來了。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Initialize</span>() <span class="co">// 初始化</span>
        ...

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">LoadContent</span>() <span class="co">// 載入資源</span>
        ...

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime) <span class="co">// 更新畫面</span>
        ... 

        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Draw</span>(GameTime gameTime)　<span class="co">// 繪製畫面</span></code></pre>
<p>通常，在 XNA 遊戲程式中，我們會在 Initialize()　進行初始化動作 (物件建立、參數設定、....)，然後在 LoadContent() 函數當中載入資源 (像是 2D 的圖檔或 3D 的模型檔等)。然後、整個 XNA 程式就開始運作了，XNA 引擎會不斷的呼叫 Update 動作 (通常每秒六十次)，以變更新遊戲畫面，而我們所要作的工作，就只剩下決定要如何畫圖，以及鍵盤滑鼠被按下時應該作甚麼事就行了。</p>
<p>如果讀者想進一步理解 XNA 的 2D 或 3D 遊戲，以下是筆者用 C# 所撰寫的幾個 XNA 遊戲程式，請讀者直接參考這些內容學習 XNA 遊戲程式的寫法。</p>
<h2 id="xna-的-2d-打飛碟遊戲"><a href="#xna-的-2d-打飛碟遊戲">XNA 的 2D 打飛碟遊戲</a></h2>
<p>專案下載： * 最簡單版本 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGame.zip">https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGame.zip</a> * 有爆炸效果 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGameWithExplode.zip">https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGameWithExplode.zip</a> * 有爆炸聲音 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGameWithSound.zip">https://dl.dropbox.com/u/101584453/cs/code/2D_FighterGameWithSound.zip</a></p>
<p>本節將介紹如何用微軟的 XNA 遊戲引擎設計一個 2D 的打飛碟遊戲。在該遊戲中，共有 3 隻飛碟會亂飛，玩家的符號是一個砲台，您必須發射砲彈打飛碟，並且一邊閃避飛碟，每打死一台飛碟就會加一分，一但被飛碟撞到後就會死亡，導致遊戲結束，最後看看你能得到多少分，下圖顯示了遊戲的一個擷取畫面。</p>
<div class="figure">
<img src="../img/GameScreenCatch.jpg" />
</div>
<p>設計方法：XNA 遊戲的主要架構包含載入 (LoadContent)、更新 (Update) 、繪出 (Draw) 等三個動作，以下是本遊戲中的主要程式片斷。</p>
<h3 id="資料結構"><a href="#資料結構">資料結構</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="kw">public</span> <span class="kw">class</span> Game1 : Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Game</span>
    {
        GraphicsDeviceManager graphics;
        SpriteBatch spriteBatch;
        Sprite playerSprite;
        <span class="dt">const</span> <span class="dt">int</span> MAX_MISSILES = <span class="dv">5</span>, MAX_ENEMIES = <span class="dv">3</span>;
        Sprite[] missileSprites = <span class="kw">new</span> Sprite[MAX_MISSILES];
        Sprite[] enemySprites = <span class="kw">new</span> Sprite[MAX_ENEMIES];
        Vector2 screenSize;
        Texture2D playerTexture, enemyTexture, missileTexture;
        KeyboardState previousKeyboardState = Keyboard.<span class="fu">GetState</span>();
        <span class="dt">bool</span> isGameOver = <span class="kw">false</span>;
        Random random = <span class="kw">new</span> <span class="fu">Random</span>();
        SpriteFont font;
        <span class="dt">int</span> score = <span class="dv">0</span>;</code></pre>
<h3 id="載入資源-圖檔字型"><a href="#載入資源-圖檔字型">載入資源 (圖檔+字型)</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs">        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">LoadContent</span>()
        {
            <span class="co">// Create a new SpriteBatch, which can be used to draw textures.</span>
            spriteBatch = <span class="kw">new</span> <span class="fu">SpriteBatch</span>(GraphicsDevice);

            <span class="co">// TODO: use this.Content to load your game content here</span>
            screenSize = <span class="kw">new</span> <span class="fu">Vector2</span>(graphics.<span class="fu">GraphicsDevice</span>.<span class="fu">Viewport</span>.<span class="fu">Width</span>, graphics.<span class="fu">GraphicsDevice</span>.<span class="fu">Viewport</span>.<span class="fu">Height</span>);
            playerTexture = Content.<span class="fu">Load</span>&lt;Texture2D&gt;(<span class="st">&quot;player&quot;</span>);
            enemyTexture = Content.<span class="fu">Load</span>&lt;Texture2D&gt;(<span class="st">&quot;enemy&quot;</span>);
            missileTexture = Content.<span class="fu">Load</span>&lt;Texture2D&gt;(<span class="st">&quot;missile&quot;</span>);

            playerSprite = <span class="kw">new</span> <span class="fu">Sprite</span>(playerTexture, <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">300</span>, <span class="dv">400</span>));
            playerSprite.<span class="fu">size</span>.<span class="fu">Y</span> = <span class="dv">140</span>;
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; MAX_MISSILES; i++)
            {
                missileSprites[i] = <span class="kw">new</span> <span class="fu">Sprite</span>(missileTexture, <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">0</span>, <span class="dv">0</span>));
                missileSprites[i].<span class="fu">isAlive</span> = <span class="kw">false</span>;
            }
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; MAX_ENEMIES; i++)
            {
                enemySprites[i] = <span class="kw">new</span> <span class="fu">Sprite</span>(enemyTexture, <span class="fu">randomEnemyXY</span>());
                enemySprites[i].<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(random.<span class="fu">Next</span>(-<span class="dv">3</span>, <span class="dv">3</span>), random.<span class="fu">Next</span>(-<span class="dv">3</span>, <span class="dv">3</span>));
                enemySprites[i].<span class="fu">isAlive</span> = <span class="kw">false</span>;
            }

            font = Content.<span class="fu">Load</span>&lt;SpriteFont&gt;(<span class="st">&quot;SpriteFont&quot;</span>);
            <span class="kw">base</span>.<span class="fu">LoadContent</span>();
        }

        <span class="kw">public</span> Vector2 <span class="fu">randomEnemyXY</span>() 
        {
           <span class="dt">int</span> enemyX = random.<span class="fu">Next</span>(<span class="dv">0</span>, (<span class="dt">int</span>) (screenSize.<span class="fu">X</span><span class="dv">-100</span>) );
           <span class="dt">int</span> enemyY = random.<span class="fu">Next</span>(<span class="dv">0</span>);
           <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Vector2</span>(enemyX, enemyY);
        }</code></pre>
<h3 id="更新邏輯模型"><a href="#更新邏輯模型">更新邏輯模型</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs">        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime)
        {
            <span class="co">// Allows the game to exit</span>
            <span class="kw">if</span> (GamePad.<span class="fu">GetState</span>(PlayerIndex.<span class="fu">One</span>).<span class="fu">Buttons</span>.<span class="fu">Back</span> == ButtonState.<span class="fu">Pressed</span>)
                <span class="kw">this</span>.<span class="fu">Exit</span>();

            <span class="co">// TODO: Add your update logic here</span>
            <span class="kw">if</span> (isGameOver) <span class="kw">return</span>;
<span class="kw">#if</span> !XBOX
            KeyboardState keyboardState = Keyboard.<span class="fu">GetState</span>();
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Left</span>))  playerSprite.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(-<span class="dv">5</span>, <span class="dv">0</span>);
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Right</span>)) playerSprite.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">5</span>, <span class="dv">0</span>);
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Up</span>)) playerSprite.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">0</span>, -<span class="dv">5</span>);
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Down</span>)) playerSprite.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">0</span>, <span class="dv">5</span>);
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Space</span>) &amp;&amp; previousKeyboardState.<span class="fu">IsKeyUp</span>(Keys.<span class="fu">Space</span>))
            {
                <span class="dt">float</span> x = playerSprite.<span class="fu">position</span>.<span class="fu">X</span> + playerTexture.<span class="fu">Width</span>/<span class="dv">2</span> - missileTexture.<span class="fu">Width</span>/<span class="dv">2</span>;
                <span class="dt">float</span> y = playerSprite.<span class="fu">position</span>.<span class="fu">Y</span>;
                <span class="fu">fireMissile</span>(x, y);
            }
            previousKeyboardState = keyboardState;
<span class="kw">#endif</span>
            Rectangle playerRect = <span class="kw">new</span> <span class="fu">Rectangle</span>((<span class="dt">int</span>)playerSprite.<span class="fu">position</span>.<span class="fu">X</span> + <span class="dv">20</span>, (<span class="dt">int</span>)playerSprite.<span class="fu">position</span>.<span class="fu">Y</span> + <span class="dv">20</span>,
                                                 playerTexture.<span class="fu">Width</span><span class="dv">-40</span>, playerTexture.<span class="fu">Height</span>/<span class="dv">2</span>);
            <span class="kw">foreach</span> (Sprite enemy <span class="kw">in</span> enemySprites) 
            {
                <span class="kw">if</span> (!enemy.<span class="fu">isAlive</span>)
                {
                    enemy.<span class="fu">isAlive</span> = <span class="kw">true</span>;
                    enemy.<span class="fu">position</span> = <span class="fu">randomEnemyXY</span>();
                }

                enemy.<span class="fu">Move</span>(screenSize);
                Rectangle enemyRect = <span class="kw">new</span> <span class="fu">Rectangle</span>((<span class="dt">int</span>) enemy.<span class="fu">position</span>.<span class="fu">X</span><span class="dv">+20</span>, (<span class="dt">int</span>) enemy.<span class="fu">position</span>.<span class="fu">Y</span><span class="dv">+20</span>, 
                                                    enemyTexture.<span class="fu">Width</span><span class="dv">-40</span>, enemyTexture.<span class="fu">Height</span><span class="dv">-40</span>);
                <span class="kw">if</span> (enemyRect.<span class="fu">Intersects</span>(playerRect))
                    isGameOver = <span class="kw">true</span>;

                <span class="kw">foreach</span> (Sprite missile <span class="kw">in</span> missileSprites)
                {
                    <span class="kw">if</span> (missile.<span class="fu">isInside</span>(screenSize))
                        missile.<span class="fu">Move</span>(screenSize);
                    <span class="kw">else</span>
                        missile.<span class="fu">isAlive</span> = <span class="kw">false</span>;

                    <span class="kw">if</span> (missile.<span class="fu">isAlive</span>)
                    {
                        Rectangle missileRect = <span class="kw">new</span> <span class="fu">Rectangle</span>((<span class="dt">int</span>) missile.<span class="fu">position</span>.<span class="fu">X</span>, (<span class="dt">int</span>) missile.<span class="fu">position</span>.<span class="fu">Y</span>, 
                                                              missileTexture.<span class="fu">Width</span>, missileTexture.<span class="fu">Height</span>);
                        <span class="kw">if</span> (missileRect.<span class="fu">Intersects</span>(enemyRect))
                        {
                            enemy.<span class="fu">isAlive</span> = <span class="kw">false</span>;
                            score ++;
                        }
                    }
                }
            }
            
            playerSprite.<span class="fu">Move</span>(screenSize);

            <span class="kw">base</span>.<span class="fu">Update</span>(gameTime);
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">fireMissile</span>(<span class="dt">float</span> x, <span class="dt">float</span> y)
        {
            <span class="kw">foreach</span> (Sprite missile <span class="kw">in</span> missileSprites)
            {
                <span class="kw">if</span> (!missile.<span class="fu">isAlive</span>)
                {
                    missile.<span class="fu">isAlive</span> = <span class="kw">true</span>;
                    missile.<span class="fu">position</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(x, y);
                    missile.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">0</span>, -<span class="dv">5</span>);
                    <span class="kw">return</span>;
                }
            }
        }</code></pre>
<h3 id="繪出---更新畫面"><a href="#繪出---更新畫面">繪出 - 更新畫面</a></h3>
<pre class="sourceCode CS"><code class="sourceCode cs">        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Draw</span>(GameTime gameTime)
        {
            GraphicsDevice.<span class="fu">Clear</span>(Color.<span class="fu">CornflowerBlue</span>);

            <span class="co">// TODO: Add your drawing code here</span>
            spriteBatch.<span class="fu">Begin</span>(SpriteBlendMode.<span class="fu">AlphaBlend</span>);
            playerSprite.<span class="fu">draw</span>(spriteBatch);
            <span class="kw">foreach</span> (Sprite enemy <span class="kw">in</span> enemySprites)
                enemy.<span class="fu">draw</span>(spriteBatch);
            <span class="kw">foreach</span> (Sprite missile <span class="kw">in</span> missileSprites)
            {
                <span class="kw">if</span> (missile.<span class="fu">isAlive</span>)
                    missile.<span class="fu">draw</span>(spriteBatch);
            }
            spriteBatch.<span class="fu">DrawString</span>(font, String.<span class="fu">Format</span>(<span class="st">&quot;Score:{0}&quot;</span>, score), <span class="kw">new</span> <span class="fu">Vector2</span>(<span class="dv">10</span>, <span class="dv">10</span>), Color.<span class="fu">Black</span>);
            <span class="kw">if</span> (isGameOver)
                spriteBatch.<span class="fu">DrawString</span>(font, <span class="st">&quot;Game Over!&quot;</span>, <span class="kw">new</span> <span class="fu">Vector2</span>(screenSize.<span class="fu">X</span> / <span class="dv">2</span>, screenSize.<span class="fu">Y</span> / <span class="dv">2</span>), Color.<span class="fu">Black</span>);
            spriteBatch.<span class="fu">End</span>();

            <span class="kw">base</span>.<span class="fu">Draw</span>(gameTime);
        }
    }</code></pre>
<p>透過以上程式，我們示範了如何使用 XNA 設計一個簡單的小遊戲 『打飛碟』。透過這樣的範例，應該可以呈現出 XNA 的 2D 遊戲設計主要架構。</p>
<h2 id="xna-的-3d-遊戲架構"><a href="#xna-的-3d-遊戲架構">XNA 的 3D 遊戲架構</a></h2>
<p>在 3D 的世界裏，每個物件都有其 3D 座標，而且最後還是必須要透過某個相機將整個視角畫面呈現在 2D 的螢幕上，因此 XNA 的 3D 遊戲設計牽涉到遊戲物件 (Game Object) 與照相機 (Camera) 等物體。</p>
<p>通常 XNA 程式裏的每個模型都會有對應的物件，如果把這些物件抽象化，那就會抽象出下列 GameObject 結構，於是我們就只要繼承這個物件，然後為每個物件的 model 填入適當的模型就行了。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="co">// 遊戲模型物件</span>
    <span class="kw">class</span> GameObject
    {
        <span class="kw">public</span> Model model = <span class="kw">null</span>;
        <span class="kw">public</span> Vector3 position = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> Vector3 rotation = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> <span class="dt">float</span> scale = <span class="fl">1.</span>0f;
        <span class="kw">public</span> Vector3 velocity = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> <span class="dt">bool</span> alive = <span class="kw">false</span>;

        <span class="kw">public</span> BoundingSphere <span class="fu">boundingSphere</span>()
        {
            BoundingSphere sphere = model.<span class="fu">Meshes</span>[<span class="dv">0</span>].<span class="fu">BoundingSphere</span>;
            sphere.<span class="fu">Center</span> = position;
            sphere.<span class="fu">Radius</span> *= scale;
            <span class="kw">return</span> sphere;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Draw</span>(Camera camera)
        {
            <span class="kw">foreach</span> (ModelMesh mesh <span class="kw">in</span> model.<span class="fu">Meshes</span>)
            {
                <span class="kw">foreach</span> (BasicEffect effect <span class="kw">in</span> mesh.<span class="fu">Effects</span>)
                {
                    effect.<span class="fu">EnableDefaultLighting</span>();
                    effect.<span class="fu">PreferPerPixelLighting</span> = <span class="kw">true</span>;

                    effect.<span class="fu">World</span> =
                        Matrix.<span class="fu">CreateFromYawPitchRoll</span>(
                        rotation.<span class="fu">Y</span>,
                        rotation.<span class="fu">X</span>,
                        rotation.<span class="fu">Z</span>) *

                        Matrix.<span class="fu">CreateScale</span>(scale) *

                        Matrix.<span class="fu">CreateTranslation</span>(position);

                    effect.<span class="fu">Projection</span> = camera.<span class="fu">projection</span>;
                    effect.<span class="fu">View</span> = camera.<span class="fu">view</span>;
                }
                mesh.<span class="fu">Draw</span>();
            }
        }
    }</code></pre>
<p>在遊戲當中，除了模型物件之外，還有一個很特殊的物件，那就是像機，這個物件的邏輯較為獨特，幾乎有固定的寫法，以下是一個基本的像機物件之寫法。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="co">// 相機物件</span>
    <span class="kw">class</span> Camera : Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">GameComponent</span>
    {
        <span class="kw">public</span> Matrix view;         <span class="co">//  視覺矩陣</span>
        <span class="kw">public</span> Matrix projection =        <span class="co">//  投影矩陣</span>
                 Matrix.<span class="fu">CreatePerspectiveFieldOfView</span>(    
                                  MathHelper.<span class="fu">PiOver4</span>,  <span class="co">// 視角 45度</span>
                                  <span class="fl">1.</span>333f, <span class="co">// 螢幕 寬高比</span>
                                  <span class="dv">1</span>,      <span class="co">// 最近的Z軸截點</span>
                                  <span class="dv">10000</span>);  <span class="co">// 最遠的Z軸截點 </span>

        <span class="kw">public</span> Vector3 FrontVector = <span class="kw">new</span> <span class="fu">Vector3</span>(<span class="dv">0</span>, <span class="dv">0</span>, -<span class="dv">1</span>); <span class="co">//相機的 往前向量</span>
        <span class="kw">public</span> Vector3 Position = <span class="kw">new</span> <span class="fu">Vector3</span>(<span class="fl">0.</span>0f, <span class="fl">2.</span>0f, <span class="fl">20.</span>0f); <span class="co">// 相機的位置</span>
        <span class="kw">public</span> <span class="dt">float</span> Yaw = <span class="fl">0.</span>0f, Pitch = <span class="fl">0.</span>0f, Roll = <span class="fl">0.</span>0f;
        <span class="kw">public</span> <span class="dt">float</span> YawDelta = <span class="fl">0.</span>2f, PitchDelta = <span class="fl">0.</span>2f, RollDelta = <span class="fl">0.</span>2f;
        <span class="kw">public</span> <span class="dt">float</span> MoveDelta = <span class="dv">200</span>;   <span class="co">// 前後走 的 增減量</span>

        <span class="kw">public</span> <span class="fu">Camera</span>(Game game)
            : <span class="kw">base</span>(game)
        {
            <span class="co">// TODO: Construct any child components here</span>

        }

        <span class="co">//更新 相機 的位置</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateCamera</span>(Vector3 Position, <span class="dt">float</span> Yaw, <span class="dt">float</span> Pitch, <span class="dt">float</span> Roll)
        {
            <span class="co">//攝影機一開始是 朝向 負 Z 軸 看著(0, 0, -1) 的 </span>
            Vector3 LookAt = Position + Vector3.<span class="fu">TransformNormal</span>(FrontVector,
                                            Matrix.<span class="fu">CreateFromYawPitchRoll</span>(Yaw, Pitch, Roll)); 

            <span class="co">// 根據 相機的位置 相機要看到的點 相機上方的向量 得到 視覺矩陣</span>
            view = Matrix.<span class="fu">CreateLookAt</span>(Position,  <span class="co">// 相機的位置</span>
                                       LookAt,    <span class="co">// 相機要看到的點</span>
                                       Vector3.<span class="fu">Up</span>); <span class="co">// 相機上方的向量</span>
        }

        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Initialize</span>()
        {
            <span class="kw">base</span>.<span class="fu">Initialize</span>();
        }

        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime)
        {
            <span class="co">// TODO: Add your update code here</span>
            <span class="dt">float</span> elapsedTime = (<span class="dt">float</span>) gameTime.<span class="fu">ElapsedGameTime</span>.<span class="fu">TotalSeconds</span>;

            KeyboardState newState;  <span class="co">// 宣告一個KeyboardState 結構的變數</span>
            newState = Keyboard.<span class="fu">GetState</span>();  <span class="co">//得到目前鍵盤每一個按鍵的狀況</span>
            <span class="kw">if</span> (newState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Right</span>)) Yaw -= YawDelta * elapsedTime; <span class="co">//右鍵按下</span>
            <span class="kw">if</span> (newState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Left</span>)) Yaw += YawDelta * elapsedTime;  <span class="co">//左鍵按下</span>
            <span class="kw">if</span> (newState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Up</span>)) Pitch += PitchDelta * elapsedTime;
            <span class="kw">if</span> (newState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Down</span>)) Pitch -= PitchDelta * elapsedTime;
            <span class="fu">UpdateCamera</span>(Position, Yaw, Pitch, Roll);

            <span class="kw">base</span>.<span class="fu">Update</span>(gameTime);
        }
    }</code></pre>
<h2 id="xna-的-3d-打飛碟遊戲"><a href="#xna-的-3d-打飛碟遊戲">XNA 的 3D 打飛碟遊戲</a></h2>
<ul>
<li>最簡單版本 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameMissileSound.zip">https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameMissileSound.zip</a></li>
<li>有碰撞偵測 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameWithCollision.zip">https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameWithCollision.zip</a></li>
<li>有爆炸效果 -- <a href="https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameParticle.zip">https://dl.dropbox.com/u/101584453/cs/code/3D_FighterGameParticle.zip</a></li>
</ul>
<p>程式碼：</p>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Audio</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Content</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">GamerServices</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Graphics</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Input</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Media</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Net</span>;
<span class="kw">using</span> Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Storage</span>;
<span class="kw">using</span> System.<span class="fu">Diagnostics</span>;


<span class="kw">namespace</span> _3D_FighterGame
{   
    <span class="kw">static</span> <span class="kw">class</span> Program
    {
        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// The main entry point for the application.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)
        {
            <span class="kw">using</span> (Game1 game = <span class="kw">new</span> <span class="fu">Game1</span>())
            {
                game.<span class="fu">Run</span>();
            }
        }
    }    
    
    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
    <span class="co">/// This is the main type for your game</span>
    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
    <span class="kw">public</span> <span class="kw">class</span> Game1 : Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">Game</span>
    {
        GraphicsDeviceManager graphics;
        SpriteBatch spriteBatch;
        GameObject launcherBase = <span class="kw">new</span> <span class="fu">GameObject</span>();
        GameObject launcherHead = <span class="kw">new</span> <span class="fu">GameObject</span>();
        Model enemyModel = <span class="kw">null</span>, missileModel = <span class="kw">null</span>;
        List&lt;GameObject&gt; enemies = <span class="kw">new</span> List&lt;GameObject&gt;();
        List&lt;GameObject&gt; missiles = <span class="kw">new</span> List&lt;GameObject&gt;();
        Camera camera = <span class="kw">null</span>;
        Random random = <span class="kw">new</span> <span class="fu">Random</span>(<span class="dv">7</span>);
        SoundEffect explodeSound = <span class="kw">null</span>, fireMissileSound = <span class="kw">null</span>;

        GamePadState previousState;
<span class="kw">#if</span> !XBOX
        KeyboardState previousKeyboardState;
<span class="kw">#endif</span>

        <span class="kw">public</span> <span class="fu">Game1</span>()
        {
            graphics = <span class="kw">new</span> <span class="fu">GraphicsDeviceManager</span>(<span class="kw">this</span>);
            Content.<span class="fu">RootDirectory</span> = <span class="st">&quot;Content&quot;</span>;
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// Allows the game to perform any initialization it needs to before starting to run.</span>
        <span class="co">/// This is where it can query for any required services and load any non-graphic</span>
        <span class="co">/// related content.  Calling base.Initialize will enumerate through any components</span>
        <span class="co">/// and initialize them as well.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Initialize</span>()
        {
            <span class="co">// TODO: Add your initialization logic here</span>
            camera = <span class="kw">new</span> <span class="fu">Camera</span>(<span class="kw">this</span>);
            <span class="kw">this</span>.<span class="fu">Components</span>.<span class="fu">Add</span>(camera);

            <span class="kw">base</span>.<span class="fu">Initialize</span>();
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// LoadContent will be called once per game and is the place to load</span>
        <span class="co">/// all of your content.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">LoadContent</span>()
        {
            <span class="co">// Create a new SpriteBatch, which can be used to draw textures.</span>
            spriteBatch = <span class="kw">new</span> <span class="fu">SpriteBatch</span>(GraphicsDevice);

            <span class="co">// TODO: use this.Content to load your game content here</span>
            camera = <span class="kw">new</span> <span class="fu">Camera</span>(<span class="kw">this</span>);

            launcherBase.<span class="fu">model</span> = Content.<span class="fu">Load</span>&lt;Model&gt;(<span class="st">&quot;Models</span><span class="ch">\\</span><span class="st">launcher_base&quot;</span>);
            launcherBase.<span class="fu">scale</span> = <span class="fl">0.</span>1f;
            launcherBase.<span class="fu">position</span> = <span class="kw">new</span> <span class="fu">Vector3</span>(<span class="fl">0.</span>0f, <span class="fl">0.</span>0f, -<span class="fl">10.</span>0f);

<span class="co">//            launcherHead.model = Content.Load&lt;Model&gt;(&quot;Models\\launcher_head&quot;);</span>
<span class="co">//            launcherHead.scale = 0.2f;</span>
<span class="co">//            launcherHead.position = launcherBase.position + new Vector3(0.0f, 20.0f, -120.0f);</span>

            enemyModel = Content.<span class="fu">Load</span>&lt;Model&gt;(<span class="st">&quot;Models</span><span class="ch">\\</span><span class="st">enemy&quot;</span>);
            missileModel = Content.<span class="fu">Load</span>&lt;Model&gt;(<span class="st">&quot;Models</span><span class="ch">\\</span><span class="st">missile&quot;</span>);
            explodeSound = Content.<span class="fu">Load</span>&lt;SoundEffect&gt;(<span class="st">&quot;Sound</span><span class="ch">\\</span><span class="st">explosion&quot;</span>);
            fireMissileSound = Content.<span class="fu">Load</span>&lt;SoundEffect&gt;(<span class="st">&quot;Sound</span><span class="ch">\\</span><span class="st">missilelaunch&quot;</span>);
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// UnloadContent will be called once per game and is the place to unload</span>
        <span class="co">/// all content.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">UnloadContent</span>()
        {
            <span class="co">// TODO: Unload any non ContentManager content here</span>
        }

        <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">newEnemy</span>()
        {
            GameObject e = <span class="kw">new</span> <span class="fu">GameObject</span>();
            e.<span class="fu">model</span> = enemyModel;
            e.<span class="fu">position</span> = <span class="kw">new</span> <span class="fu">Vector3</span>(random.<span class="fu">Next</span>(-<span class="dv">5</span>, <span class="dv">5</span>) * <span class="fl">50.</span>0f, random.<span class="fu">Next</span>(-<span class="dv">5</span>, <span class="dv">5</span>) * <span class="fl">50.</span>0f, -<span class="fl">2000.</span>0f);
            e.<span class="fu">velocity</span> = <span class="kw">new</span> <span class="fu">Vector3</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">2.</span>0f);
            e.<span class="fu">scale</span> = <span class="fl">0.</span>03f;
            enemies.<span class="fu">Add</span>(e);
        }

        <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">newMissile</span>()
        {
            Matrix rotationMatrix = Matrix.<span class="fu">CreateFromYawPitchRoll</span>(camera.<span class="fu">Yaw</span>, camera.<span class="fu">Pitch</span>, camera.<span class="fu">Roll</span>);
            
            GameObject m = <span class="kw">new</span> <span class="fu">GameObject</span>();
            m.<span class="fu">model</span> = missileModel;
            m.<span class="fu">position</span> = launcherBase.<span class="fu">position</span> + Vector3.<span class="fu">Transform</span>(Vector3.<span class="fu">Forward</span> * <span class="dv">10</span>, rotationMatrix);
            m.<span class="fu">scale</span> = <span class="fl">10.</span>0f;
            <span class="co">// m.velocity = new Vector3(0, 0, -10.0f);</span>
            m.<span class="fu">velocity</span> = Vector3.<span class="fu">Transform</span>(Vector3.<span class="fu">Forward</span> * <span class="dv">10</span>, rotationMatrix);
            missiles.<span class="fu">Add</span>(m);
            fireMissileSound.<span class="fu">Play</span>();
        }

        <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">getLuncherBasePosition</span>()
        {
            Matrix rotationMatrix = Matrix.<span class="fu">CreateFromYawPitchRoll</span>(camera.<span class="fu">Yaw</span>, camera.<span class="fu">Pitch</span>, camera.<span class="fu">Roll</span>);
            launcherBase.<span class="fu">position</span> = camera.<span class="fu">Position</span> + Vector3.<span class="fu">Transform</span>(Vector3.<span class="fu">Forward</span> * <span class="dv">50</span>, rotationMatrix); <span class="co">//  + Vector3.Down * 10</span>
            launcherBase.<span class="fu">rotation</span>.<span class="fu">Y</span> = camera.<span class="fu">Yaw</span>;
            launcherBase.<span class="fu">rotation</span>.<span class="fu">X</span> = camera.<span class="fu">Pitch</span>;
            launcherBase.<span class="fu">rotation</span>.<span class="fu">Z</span> = camera.<span class="fu">Roll</span>;
<span class="co">//            Trace.WriteLine(launcherBase.position);</span>
        }

        <span class="dt">double</span> lastEnemyDelay = <span class="fl">0.</span>0f;
        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// Allows the game to run logic such as updating the world,</span>
        <span class="co">/// checking for collisions, gathering input, and playing audio.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">&quot;gameTime&quot;</span><span class="kw">&gt;</span><span class="co">Provides a snapshot of timing values.</span><span class="kw">&lt;/param&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime)
        {
            <span class="co">// Allows the game to exit</span>
            <span class="kw">if</span> (GamePad.<span class="fu">GetState</span>(PlayerIndex.<span class="fu">One</span>).<span class="fu">Buttons</span>.<span class="fu">Back</span> == ButtonState.<span class="fu">Pressed</span>)
                <span class="kw">this</span>.<span class="fu">Exit</span>();

            <span class="fu">getLuncherBasePosition</span>();

            KeyboardState keyboardState = Keyboard.<span class="fu">GetState</span>();  <span class="co">//得到目前鍵盤每一個按鍵的狀況</span>
            <span class="kw">if</span> (keyboardState.<span class="fu">IsKeyDown</span>(Keys.<span class="fu">Space</span>) &amp;&amp; previousKeyboardState.<span class="fu">IsKeyUp</span>(Keys.<span class="fu">Space</span>))
            {
                <span class="fu">newMissile</span>();
            }

            <span class="dt">double</span> elapsedTime = gameTime.<span class="fu">ElapsedGameTime</span>.<span class="fu">TotalSeconds</span>;
            lastEnemyDelay += elapsedTime;
            <span class="kw">if</span> (lastEnemyDelay &gt;= <span class="dv">1</span>)
            {
                <span class="kw">if</span> (enemies.<span class="fu">Count</span> &lt; <span class="dv">10</span>)
                {
                    <span class="fu">newEnemy</span>();
                    lastEnemyDelay = <span class="fl">0.</span>0f;
                }
            }

            GameObject[] eList = enemies.<span class="fu">ToArray</span>();
            <span class="kw">foreach</span> (GameObject e <span class="kw">in</span> eList) 
            {
                <span class="kw">if</span> (e.<span class="fu">position</span>.<span class="fu">Z</span> &gt;= <span class="dv">0</span>)
                    enemies.<span class="fu">Remove</span>(e);
                <span class="kw">else</span>
                    e.<span class="fu">position</span> += e.<span class="fu">velocity</span>;
            }

            GameObject[] mList = missiles.<span class="fu">ToArray</span>();
            <span class="kw">foreach</span> (GameObject m <span class="kw">in</span> mList)
            {
                <span class="kw">if</span> (m.<span class="fu">position</span>.<span class="fu">Z</span> &lt;= -<span class="dv">3000</span>)
                    missiles.<span class="fu">Remove</span>(m);
                <span class="kw">else</span>
                    m.<span class="fu">position</span> += m.<span class="fu">velocity</span>;
            }

            <span class="co">// TODO: Add your update logic here</span>
            camera.<span class="fu">Update</span>(gameTime);

            previousKeyboardState = keyboardState;

            <span class="kw">base</span>.<span class="fu">Update</span>(gameTime);
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// This is called when the game should draw itself.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">&quot;gameTime&quot;</span><span class="kw">&gt;</span><span class="co">Provides a snapshot of timing values.</span><span class="kw">&lt;/param&gt;</span>
        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Draw</span>(GameTime gameTime)
        {
            GraphicsDevice.<span class="fu">Clear</span>(Color.<span class="fu">CornflowerBlue</span>);
            <span class="co">// TODO: Add your drawing code here</span>
            <span class="fu">DrawGameObject</span>(launcherBase);
<span class="co">//          DrawGameObject(launcherHead);</span>
            <span class="kw">foreach</span> (GameObject e <span class="kw">in</span> enemies)
                <span class="fu">DrawGameObject</span>(e);
            <span class="kw">foreach</span> (GameObject m <span class="kw">in</span> missiles)
                <span class="fu">DrawGameObject</span>(m);

            <span class="kw">base</span>.<span class="fu">Draw</span>(gameTime);
        }

        <span class="dt">void</span> <span class="fu">DrawGameObject</span>(GameObject gameobject)
        {
            <span class="kw">foreach</span> (ModelMesh mesh <span class="kw">in</span> gameobject.<span class="fu">model</span>.<span class="fu">Meshes</span>)
            {
                <span class="kw">foreach</span> (BasicEffect effect <span class="kw">in</span> mesh.<span class="fu">Effects</span>)
                {
                    effect.<span class="fu">EnableDefaultLighting</span>();
                    effect.<span class="fu">PreferPerPixelLighting</span> = <span class="kw">true</span>;

                    effect.<span class="fu">World</span> =
                        Matrix.<span class="fu">CreateFromYawPitchRoll</span>(
                        gameobject.<span class="fu">rotation</span>.<span class="fu">Y</span>,
                        gameobject.<span class="fu">rotation</span>.<span class="fu">X</span>,
                        gameobject.<span class="fu">rotation</span>.<span class="fu">Z</span>) *

                        Matrix.<span class="fu">CreateScale</span>(gameobject.<span class="fu">scale</span>) *

                        Matrix.<span class="fu">CreateTranslation</span>(gameobject.<span class="fu">position</span>);

                    effect.<span class="fu">Projection</span> = camera.<span class="fu">projection</span>;
                    effect.<span class="fu">View</span> = camera.<span class="fu">view</span>;
                }
                mesh.<span class="fu">Draw</span>();
            }
        }
    }

    <span class="kw">class</span> GameObject
    {
        <span class="kw">public</span> Model model = <span class="kw">null</span>;
        <span class="kw">public</span> Vector3 position = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> Vector3 rotation = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> <span class="dt">float</span> scale = <span class="fl">1.</span>0f;
        <span class="kw">public</span> Vector3 velocity = Vector3.<span class="fu">Zero</span>;
        <span class="kw">public</span> <span class="dt">bool</span> alive = <span class="kw">false</span>;
    }
    
    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
    <span class="co">/// This is a game component that implements IUpdateable.</span>
    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
    <span class="kw">public</span> <span class="kw">class</span> GameComponent_Grid : Microsoft.<span class="fu">Xna</span>.<span class="fu">Framework</span>.<span class="fu">DrawableGameComponent</span>
    {
        <span class="kw">public</span> <span class="dt">int</span> gridSize = <span class="dv">12</span>; <span class="co">// 每邊有 幾格</span>
        <span class="kw">public</span> <span class="dt">float</span> gridScale = <span class="fl">1.</span>0f; <span class="co">// 每格 的 寬</span>
        <span class="kw">public</span> Color gridColor = <span class="kw">new</span> <span class="fu">Color</span>(<span class="bn">0xFF</span>, <span class="bn">0xFF</span>, <span class="bn">0xFF</span>, <span class="bn">0xFF</span>);   <span class="co">// 格線 的顏色 內定是黑色</span>

        VertexBuffer vertexBuffer; <span class="co">// 頂點緩衝區</span>
        VertexDeclaration vertexDeclaration; <span class="co">// 頂點格式 (每個頂點 包含什麼內容)</span>
        BasicEffect effect; <span class="co">// 產出時會用到的 效果</span>
        <span class="dt">int</span> vertexCount;  <span class="co">// 頂點 數目</span>
        GraphicsDevice device; <span class="co">//繪圖設備</span>

        <span class="kw">public</span> Matrix world = Matrix.<span class="fu">Identity</span>; <span class="co">// 世界 觀測 投影 矩陣</span>

        <span class="kw">public</span> Matrix view = Matrix.<span class="fu">CreateLookAt</span>(<span class="kw">new</span> <span class="fu">Vector3</span>(<span class="fl">0.</span>0f, <span class="fl">20.</span>0f, <span class="fl">20.</span>0f),
                                                      Vector3.<span class="fu">Zero</span>,
                                                      Vector3.<span class="fu">Up</span>);

        <span class="kw">public</span> Matrix projection = Matrix.<span class="fu">CreatePerspectiveFieldOfView</span>(
                                                 MathHelper.<span class="fu">ToRadians</span>(<span class="fl">45.</span>0f),
                                                 <span class="fl">1.</span>333f, <span class="fl">1.</span>0f, <span class="fl">10000.</span>0f);

        <span class="kw">public</span> <span class="fu">GameComponent_Grid</span>(Game game)
            : <span class="kw">base</span>(game)
        {
            <span class="co">// TODO: Construct any child components here</span>
            <span class="kw">this</span>.<span class="fu">device</span> = game.<span class="fu">GraphicsDevice</span>;
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// Allows the game component to perform any initialization it needs to before starting</span>
        <span class="co">/// to run.  This is where it can query for any required services and load content.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Initialize</span>()
        {
            <span class="co">// TODO: Add your initialization code here</span>
            effect = <span class="kw">new</span> <span class="fu">BasicEffect</span>(device, <span class="kw">null</span>); <span class="co">// 效果</span>

            vertexCount = (gridSize + <span class="dv">1</span>) * <span class="dv">4</span>; <span class="co">// 每邊的頂點數 比 每邊的格數 多一，共有四個邊</span>

            <span class="co">// 每個頂點 包含 位置 和 顏色 ，先空出 vertexCount 個 頂點</span>
            VertexPositionColor[] vertices = <span class="kw">new</span> VertexPositionColor[vertexCount];

            <span class="dt">float</span> length = (<span class="dt">float</span>)gridSize * gridScale; <span class="co">// 邊長 等於 格數 乘以 格寬</span>
            <span class="dt">float</span> halfLength = length * <span class="fl">0.</span>5f;  <span class="co">// 半邊長 因為是要 以原點為中心 左右 各半</span>

            <span class="dt">int</span> index = <span class="dv">0</span>; <span class="co">// 頂點 索引</span>

            <span class="co">// 定義頂點位置  頂都是 躺在 X Z 平面上</span>
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= gridSize; ++i)
            {
                vertices[index++] = <span class="kw">new</span> <span class="fu">VertexPositionColor</span>(
                    <span class="kw">new</span> <span class="fu">Vector3</span>(-halfLength, <span class="fl">0.</span>0f, i * gridScale - halfLength),
                    gridColor); <span class="co">// 左邊的頂點</span>

                vertices[index++] = <span class="kw">new</span> <span class="fu">VertexPositionColor</span>(
                    <span class="kw">new</span> <span class="fu">Vector3</span>(halfLength, <span class="fl">0.</span>0f, i * gridScale - halfLength),
                    gridColor); <span class="co">// 右邊的頂點</span>

                vertices[index++] = <span class="kw">new</span> <span class="fu">VertexPositionColor</span>(
                    <span class="kw">new</span> <span class="fu">Vector3</span>(i * gridScale - halfLength, <span class="fl">0.</span>0f, -halfLength),
                    gridColor); <span class="co">// 上緣的頂點</span>

                vertices[index++] = <span class="kw">new</span> <span class="fu">VertexPositionColor</span>(
                    <span class="kw">new</span> <span class="fu">Vector3</span>(i * gridScale - halfLength, <span class="fl">0.</span>0f, halfLength),
                    gridColor); <span class="co">// 下緣的頂點</span>
            }

            <span class="co">// 建立 頂點緩衝區</span>
            vertexBuffer = <span class="kw">new</span> <span class="fu">VertexBuffer</span>(device, vertexCount *  VertexPositionColor.<span class="fu">SizeInBytes</span>,
                                             BufferUsage.<span class="fu">WriteOnly</span>);
            <span class="co">// 將 頂點資料 複製入 頂點緩衝區 內</span>
            vertexBuffer.<span class="fu">SetData</span>&lt;VertexPositionColor&gt;(vertices);

            <span class="co">// 頂點格式</span>
            vertexDeclaration = <span class="kw">new</span> <span class="fu">VertexDeclaration</span>(device, VertexPositionColor.<span class="fu">VertexElements</span>);

            <span class="kw">base</span>.<span class="fu">Initialize</span>();
        }

        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
        <span class="co">/// Allows the game component to update itself.</span>
        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">&quot;gameTime&quot;</span><span class="kw">&gt;</span><span class="co">Provides a snapshot of timing values.</span><span class="kw">&lt;/param&gt;</span>
        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Update</span>(GameTime gameTime)
        {
            <span class="co">// TODO: Add your update code here</span>

            <span class="kw">base</span>.<span class="fu">Update</span>(gameTime);
        }

        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Draw</span>(GameTime gameTime)
        {
            
            <span class="co">// 效果 三大矩陣 設定</span>
<span class="co">//            effect.World = world;</span>
<span class="co">//            effect.View = view;</span>
<span class="co">//            effect.Projection = projection;</span>

            effect.<span class="fu">VertexColorEnabled</span> = <span class="kw">true</span>;  <span class="co">// 使用 頂點顏色 效果</span>

            device.<span class="fu">VertexDeclaration</span> = vertexDeclaration; <span class="co">// 頂點格式</span>
            device.<span class="fu">Vertices</span>[<span class="dv">0</span>].<span class="fu">SetSource</span>(vertexBuffer, <span class="dv">0</span>, VertexPositionColor.<span class="fu">SizeInBytes</span>); <span class="co">// 頂點來源</span>

            effect.<span class="fu">Begin</span>(); <span class="co">// 效果 開始</span>

            <span class="kw">foreach</span> (EffectPass CurrentPass <span class="kw">in</span> effect.<span class="fu">CurrentTechnique</span>.<span class="fu">Passes</span>)
            {
                CurrentPass.<span class="fu">Begin</span>();
                device.<span class="fu">DrawPrimitives</span>(PrimitiveType.<span class="fu">LineList</span>, <span class="dv">0</span>, vertexCount / <span class="dv">2</span>); <span class="co">// 兩兩畫線 所以只有 vertexCount/2 條線</span>
                CurrentPass.<span class="fu">End</span>();
            }
            effect.<span class="fu">End</span>();
        }
    }    
}</code></pre>
<h2 id="從-xna-到-unity3d"><a href="#從-xna-到-unity3d">從 XNA 到 Unity3D</a></h2>
<p>雖然 XNA 已經是成熟的技術，但是卻不支援像 Window Form 或 WPF 這樣所示即所得的開發方式，還好現在已經有一款稱為 Unity 遊戲開發軟體，可以讓您用所視即所得的方式開發 3D 的遊戲程式。Unity 是一款強大的工業級跨平台遊戲引擎 （Win PC, XBox, PS, Wii，Android......)，具有很棒的視覺化開發環境，並且支援 C# 與 JavaScript 等開發語言，並且有免費版可以下載。</p>
<ul>
<li>Unity 官網 -- <a href="http://unity3d.com/">http://unity3d.com/</a></li>
</ul>
<p>目前也已經有一些中文書介紹 Unity 的程式設計，以下是這些書的網址：</p>
<ul>
<li>全民做遊戲-Unity跨平台遊戲開發寶典 -- <a href="http://www.books.com.tw/exep/prod/booksfile.php?item=0010537427">http://www.books.com.tw/exep/prod/booksfile.php?item=0010537427</a></li>
<li>Unity 3D遊戲開發設計實務 -- <a href="http://www.books.com.tw/exep/prod/booksfile.php?item=0010551893">http://www.books.com.tw/exep/prod/booksfile.php?item=0010551893</a></li>
<li>Unity 3D遊戲開發設計學院 -- <a href="http://www.books.com.tw/exep/prod/booksfile.php?item=0010464868">http://www.books.com.tw/exep/prod/booksfile.php?item=0010464868</a></li>
<li>遊戲工作室指導手冊：快速學會四種Unity遊戲設計(附光碟) -- <a href="http://www.books.com.tw/exep/prod/booksfile.php?item=0010570704">http://www.books.com.tw/exep/prod/booksfile.php?item=0010570704</a></li>
</ul>
<h2 id="參考文獻-8"><a href="#參考文獻-8">參考文獻</a></h2>
<ul>
<li>二維動畫圖 (Sprites) -- <a href="http://www.sprites-inc.co.uk/files/X/">http://www.sprites-inc.co.uk/files/X/</a></li>
<li>聲音效果 -- <a href="http://www.ilovewavs.com/Effects/Music/Music.htm">http://www.ilovewavs.com/Effects/Music/Music.htm</a></li>
<li>聲音效果 -- <a href="http://www.ilovewaves.com/">http://www.ilovewaves.com/</a></li>
<li>網路資源</li>
<li>XNA 官方網站 - <a href="http://creators.xna.com/">http://creators.xna.com/</a>
<ul>
<li>包含 Getting Start, Tutorial, Samples, Starter Kits, Articles.</li>
</ul></li>
<li>Stormcode 的 XNA BLOG -- <a href="http://www.stromcode.com/category/xna/">http://www.stromcode.com/category/xna/</a></li>
<li>XNA+OGRE 的 BLOG -- <a href="http://blog.yam.com/xnaOgre">http://blog.yam.com/xnaOgre</a></li>
<li>Reimer's XNA Tutorial -- <a href="http://www.riemers.net/eng/Tutorials/XNA/Csharp/series1.php">http://www.riemers.net/eng/Tutorials/XNA/Csharp/series1.php</a></li>
<li>XNA 的粒子效果範例 -- <a href="http://creators.xna.com/en-US/sample/particle3d">http://creators.xna.com/en-US/sample/particle3d</a></li>
<li>如何將 Blender 模型匯出給 XNA 使用 -- <a href="http://forums.xna.com/forums/t/4614.aspx">http://forums.xna.com/forums/t/4614.aspx</a></li>
<li>如何將 Blender 的動作匯出給 XNA 使用 -- <a href="http://www.stromcode.com/2008/03/16/modeling-for-xna-with-blender-part-iv/">http://www.stromcode.com/2008/03/16/modeling-for-xna-with-blender-part-iv/</a></li>
<li>Papervision3D - 五分鐘上手 (Flash 的 3D 遊戲引擎）-- <a href="http://blog.ring.idv.tw/comment.ser?i=194">http://blog.ring.idv.tw/comment.ser?i=194</a></li>
<li>2D/3D 遊戲程式設計入門 ─ 使用XNA3.0與C#(附光碟), 作者：鄞永傳、何振揚, 出版社：文魁, 出版日期：2009年02月06日, 語言：繁體中文 ISBN：9789866482120
<ul>
<li><a href="http://www.books.com.tw/exep/prod/booksfile.php?item=0010426322">http://www.books.com.tw/exep/prod/booksfile.php?item=0010426322</a></li>
</ul></li>
<li>XNA Creator Club Online, Getting Start -- <a href="http://creators.xna.com/en-US/education/gettingstarted">http://creators.xna.com/en-US/education/gettingstarted</a></li>
</ul>
<h1 id="c-程式設計結語"><a href="#c-程式設計結語">C# 程式設計：結語</a></h1>
<p>雖然我們已經介紹了有關 C# 的基本語法、命令列程式、視窗程式、Thread、網路程式、甚至是 XNA 遊戲程式等等，但仍然無法完整的涵蓋 C# 的所有面向，像是 ASP.NET 的網頁程式，Silverlight (類似 Flash) 的網頁應用、以及新一代的視窗 WPF 等等，都是我們沒有介紹到的主題，對於這些領域，只好請讀者自行查看相關的書籍。</p>
<p>事實上、C# 可以說是微軟的主力語言，因此所有的微軟技術幾乎都可以用 C# 進行存取與使用，這讓 C# 在微軟平台上幾乎可以做所有的事情，特別是在 .NET 平台上。而且 C# 也可以進行微軟系統呼叫，因此從 C# 出發幾乎可以深入整個微軟的 Windows 作業系統，這是本書無法更深入探討的主題。</p>
<p>但本書已經盡可能的涵蓋了筆者認為重要的部份，未來、如果有任何新的主題，筆者隨時會在補上，希望這樣的一本書能對讀者有所幫助。</p>
<h1 id="附錄教學錄影"><a href="#附錄教學錄影">附錄：教學錄影</a></h1>
<table>
<thead>
<tr class="header">
<th align="left">主題</th>
<th align="left">教學影片</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">第 1 章. <a href="csharp.html">簡介與開發環境</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 安裝與課程規定</td>
<td align="left"><a href="http://youtu.be/MtCx-T71_bg">http://youtu.be/MtCx-T71_bg</a></td>
</tr>
<tr class="odd">
<td align="left">─ 開發環境使用</td>
<td align="left"><a href="http://youtu.be/_9rEEWE3lXQ">http://youtu.be/_9rEEWE3lXQ</a></td>
</tr>
<tr class="even">
<td align="left">─ 控制項巡禮</td>
<td align="left"><a href="http://youtu.be/e5366D_ngAA">http://youtu.be/e5366D_ngAA</a></td>
</tr>
<tr class="odd">
<td align="left">─ 命令列 Hello 程式</td>
<td align="left"><a href="http://youtu.be/WcN_Rzw1eac">http://youtu.be/WcN_Rzw1eac</a></td>
</tr>
<tr class="even">
<td align="left">─ 命令列編譯器 csc</td>
<td align="left"><a href="http://youtu.be/biz51oMWRKk">http://youtu.be/biz51oMWRKk</a></td>
</tr>
<tr class="odd">
<td align="left">第 2 章. <a href="varexp.html">變數與運算式</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 基本型態宣告與觀察</td>
<td align="left"><a href="http://youtu.be/T81pMd32tMY">http://youtu.be/T81pMd32tMY</a></td>
</tr>
<tr class="odd">
<td align="left">─ 基本運算操作</td>
<td align="left"><a href="http://youtu.be/yMOJjz7VmaE">http://youtu.be/yMOJjz7VmaE</a></td>
</tr>
<tr class="even">
<td align="left">─ 運算式家庭作業</td>
<td align="left"><a href="http://youtu.be/JTUTdZjLBxI">http://youtu.be/JTUTdZjLBxI</a></td>
</tr>
<tr class="odd">
<td align="left">第 3 章. <a href="ifloop.html">流程控制</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ if 語法</td>
<td align="left"><a href="http://youtu.be/qM1DpkVqEkQ">http://youtu.be/qM1DpkVqEkQ</a></td>
</tr>
<tr class="odd">
<td align="left">─ for, while 迴圈</td>
<td align="left"><a href="http://youtu.be/Wk-RZvjgG2o">http://youtu.be/Wk-RZvjgG2o</a></td>
</tr>
<tr class="even">
<td align="left">第 4 章. <a href="array.html">陣列</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">─ 陣列與迴圈</td>
<td align="left"><a href="http://youtu.be/CoduSbHPKME">http://youtu.be/CoduSbHPKME</a></td>
</tr>
<tr class="even">
<td align="left">第 5 章. <a href="function.html">函數</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">- 函數的呼叫</td>
<td align="left"><a href="http://youtu.be/dnkKId0ZO1c">http://youtu.be/dnkKId0ZO1c</a></td>
</tr>
<tr class="even">
<td align="left">第 6 章. <a href="object.html">物件導向</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">─ 封裝</td>
<td align="left"><a href="http://youtu.be/HLNAbXHSQHs">http://youtu.be/HLNAbXHSQHs</a></td>
</tr>
<tr class="even">
<td align="left">─ 建構函數</td>
<td align="left"><a href="http://youtu.be/HLNAbXHSQHs">http://youtu.be/HLNAbXHSQHs</a></td>
</tr>
<tr class="odd">
<td align="left">─ 繼承 1</td>
<td align="left"><a href="http://youtu.be/pNkvMXp28AE">http://youtu.be/pNkvMXp28AE</a></td>
</tr>
<tr class="even">
<td align="left">─ 繼承 2</td>
<td align="left"><a href="http://youtu.be/GKxxE3UdGms">http://youtu.be/GKxxE3UdGms</a></td>
</tr>
<tr class="odd">
<td align="left">─ 多型</td>
<td align="left"><a href="http://youtu.be/G1QQyXEpSCk">http://youtu.be/G1QQyXEpSCk</a></td>
</tr>
<tr class="even">
<td align="left">─ 件導向練習題講解</td>
<td align="left"><a href="http://youtu.be/Om50P0T_aVU">http://youtu.be/Om50P0T_aVU</a></td>
</tr>
<tr class="odd">
<td align="left">第 7 章. <a href="exception.html">例外處理</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 錯誤處理</td>
<td align="left"><a href="http://youtu.be/7bCefu8BB00">http://youtu.be/7bCefu8BB00</a></td>
</tr>
<tr class="odd">
<td align="left">第 8 章. <a href="file.html">檔案處理</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 檔案處理</td>
<td align="left"><a href="http://youtu.be/3EyPcAddd70">http://youtu.be/3EyPcAddd70</a></td>
</tr>
<tr class="odd">
<td align="left">第 9 章. <a href="datastructure.html">資料結構</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ Array 與 List 物件的使用</td>
<td align="left"><a href="http://youtu.be/EHSGtKpRprI">http://youtu.be/EHSGtKpRprI</a></td>
</tr>
<tr class="odd">
<td align="left">─ HashTable 與 Dictionary 物件的使用</td>
<td align="left"><a href="http://youtu.be/hYH-npRmmKM">http://youtu.be/hYH-npRmmKM</a></td>
</tr>
<tr class="even">
<td align="left">第 10 章. <a href="regexp.html">正規表達式</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">第 11 章. <a href="thread.html">作業系統與 Thread</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 線程與死結</td>
<td align="left"><a href="http://youtu.be/O1b31Cc9bfw">http://youtu.be/O1b31Cc9bfw</a></td>
</tr>
<tr class="odd">
<td align="left">第 12 章. <a href="window.html">視窗程式簡介</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 按鈕範例與視窗專案的結構</td>
<td align="left"><a href="http://youtu.be/Vhk1SsZTTVk">http://youtu.be/Vhk1SsZTTVk</a></td>
</tr>
<tr class="odd">
<td align="left">─ 視窗程式設計簡介1</td>
<td align="left"><a href="http://youtu.be/MtCx-T71_bg">http://youtu.be/MtCx-T71_bg</a></td>
</tr>
<tr class="even">
<td align="left">─ 視窗程式設計簡介2</td>
<td align="left"><a href="http://youtu.be/_9rEEWE3lXQ">http://youtu.be/_9rEEWE3lXQ</a></td>
</tr>
<tr class="odd">
<td align="left">─ 視窗控制項巡禮</td>
<td align="left"><a href="http://youtu.be/e5366D_ngAA">http://youtu.be/e5366D_ngAA</a></td>
</tr>
<tr class="even">
<td align="left">─ 文字型計算機</td>
<td align="left"><a href="http://youtu.be/bJ-fANUuRcU">http://youtu.be/bJ-fANUuRcU</a></td>
</tr>
<tr class="odd">
<td align="left">─ 字典查詢程式</td>
<td align="left"><a href="http://youtu.be/yS3G-H_hrFU">http://youtu.be/yS3G-H_hrFU</a></td>
</tr>
<tr class="even">
<td align="left">─ 將小字典擴充為小翻譯系統</td>
<td align="left"><a href="http://youtu.be/_sFsTo41PXs">http://youtu.be/_sFsTo41PXs</a></td>
</tr>
<tr class="odd">
<td align="left">第 13 章. <a href="timer.html">時間驅動</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 時間驅動的邏輯</td>
<td align="left"><a href="http://youtu.be/X0m8heWQrvM">http://youtu.be/X0m8heWQrvM</a></td>
</tr>
<tr class="odd">
<td align="left">─ 設計短跑用碼表</td>
<td align="left"><a href="http://youtu.be/BAT8UsY__mU">http://youtu.be/BAT8UsY__mU</a></td>
</tr>
<tr class="even">
<td align="left">─ Timer 與碼錶</td>
<td align="left"><a href="http://youtu.be/UA0rizekLow">http://youtu.be/UA0rizekLow</a></td>
</tr>
<tr class="odd">
<td align="left">─ Timer 與小時鐘</td>
<td align="left"><a href="http://youtu.be/NJ6B5-vO_88">http://youtu.be/NJ6B5-vO_88</a></td>
</tr>
<tr class="even">
<td align="left">─ Timer 與移動球</td>
<td align="left"><a href="http://youtu.be/6Gs4MPzt6q4">http://youtu.be/6Gs4MPzt6q4</a></td>
</tr>
<tr class="odd">
<td align="left">第 14 章. <a href="editor.html">設計文字編輯器</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 文字編輯器</td>
<td align="left"><a href="http://youtu.be/xz5sKvZjLZI">http://youtu.be/xz5sKvZjLZI</a></td>
</tr>
<tr class="odd">
<td align="left">第 15 章. <a href="graphics.html">畫圖功能</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 畫圖功能示範</td>
<td align="left"><a href="http://youtu.be/8aAql8R4WSg">http://youtu.be/8aAql8R4WSg</a></td>
</tr>
<tr class="odd">
<td align="left">─ 小畫板</td>
<td align="left"><a href="http://youtu.be/iD044JD3BI4">http://youtu.be/iD044JD3BI4</a></td>
</tr>
<tr class="even">
<td align="left">─ 繪圖並存檔</td>
<td align="left"><a href="http://youtu.be/wjpHUdPqdwc">http://youtu.be/wjpHUdPqdwc</a></td>
</tr>
<tr class="odd">
<td align="left">─ 抓取螢幕畫面</td>
<td align="left"><a href="http://youtu.be/7qxv64yZCyE">http://youtu.be/7qxv64yZCyE</a></td>
</tr>
<tr class="even">
<td align="left">─ 電子白板的設計</td>
<td align="left"><a href="http://youtu.be/yqPR9IYD_6s">http://youtu.be/yqPR9IYD_6s</a></td>
</tr>
<tr class="odd">
<td align="left">第 16 章. <a href="gridview.html">DataGridView 與 ListView 元件</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ DataGridView 元件的使用</td>
<td align="left"><a href="http://youtu.be/XzsZRqLAi30">http://youtu.be/XzsZRqLAi30</a></td>
</tr>
<tr class="odd">
<td align="left">─ 製作賣紅茶的 POS 系統</td>
<td align="left"><a href="http://youtu.be/XX0wHhvkkiE">http://youtu.be/XX0wHhvkkiE</a></td>
</tr>
<tr class="even">
<td align="left">第 17 章. <a href="net.html">網路程式設計</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">─ 網路 UDP 程式設計</td>
<td align="left"><a href="http://youtu.be/DxdfeURkNzU">http://youtu.be/DxdfeURkNzU</a></td>
</tr>
<tr class="even">
<td align="left">第 18 章. <a href="udp.html">UDP 程式設計</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">─ 網路 UDP 程式設計</td>
<td align="left"><a href="http://youtu.be/DxdfeURkNzU">http://youtu.be/DxdfeURkNzU</a></td>
</tr>
<tr class="even">
<td align="left">第 19 章. <a href="tcp.html">TCP 程式設計</a></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">─ 單向 TCP 訊息傳遞程式</td>
<td align="left"><a href="http://youtu.be/Zc1NjR2v-5k">http://youtu.be/Zc1NjR2v-5k</a></td>
</tr>
<tr class="even">
<td align="left">─ 雙向 P2P 命令列聊天室</td>
<td align="left"><a href="http://youtu.be/W5HG9DtC6EI">http://youtu.be/W5HG9DtC6EI</a></td>
</tr>
<tr class="odd">
<td align="left">─ 多人視窗版聊天室</td>
<td align="left"><a href="http://youtu.be/lgojk1BOMsk">http://youtu.be/lgojk1BOMsk</a></td>
</tr>
<tr class="even">
<td align="left">─ 多人視窗版聊天室(程式碼解析)</td>
<td align="left"><a href="http://youtu.be/xRzh0yZ3rqw">http://youtu.be/xRzh0yZ3rqw</a></td>
</tr>
<tr class="odd">
<td align="left">第 20 章. <a href="http.html">HTTP 程式設計 (1) – Server</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ HTTP 協定與 HelloServer 的實作</td>
<td align="left"><a href="http://youtu.be/0pniFEvdjcc">http://youtu.be/0pniFEvdjcc</a></td>
</tr>
<tr class="odd">
<td align="left">─ 傳回超連結的 HelloServer</td>
<td align="left"><a href="http://youtu.be/KGbZ6nQrATY">http://youtu.be/KGbZ6nQrATY</a></td>
</tr>
<tr class="even">
<td align="left">─ 設計簡易的 WebServer</td>
<td align="left"><a href="http://youtu.be/QoqpaBAxPwQ">http://youtu.be/QoqpaBAxPwQ</a></td>
</tr>
<tr class="odd">
<td align="left">第 21 章. <a href="web.html">HTTP 程式設計 (2) – Client</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 單一網頁下載 (UrlDownloader)</td>
<td align="left"><a href="http://youtu.be/eICPT158cxc">http://youtu.be/eICPT158cxc</a></td>
</tr>
<tr class="odd">
<td align="left">─ Crawler 網路爬蟲</td>
<td align="left"><a href="http://youtu.be/Ytl19GjnhMo">http://youtu.be/Ytl19GjnhMo</a></td>
</tr>
<tr class="even">
<td align="left">─ 瀏覽器元件的控制</td>
<td align="left"><a href="http://youtu.be/3mRW1_Usv6k">http://youtu.be/3mRW1_Usv6k</a></td>
</tr>
<tr class="odd">
<td align="left">第 22 章. <a href="game.html">XNA 遊戲引擎</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">─ 打飛碟遊戲</td>
<td align="left"><a href="http://youtu.be/DMPl0x__dMg">http://youtu.be/DMPl0x__dMg</a></td>
</tr>
<tr class="odd">
<td align="left">第 23 章. <a href="end.html">結語</a></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="footer">
<a href="http://ccckmit.wikidot.com">陳鍾誠</a>衍生自<a href="http://zh.wikipedia.org/">維基百科</a>之作品：採用 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/ ">創作共用：姓名標示、相同方式分享</a> <a href="license.html">授權</a>
</div>
</body>
</html>
